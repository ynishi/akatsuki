# ğŸ¤– AGENT.md: Akatsuki é–‹ç™ºæ†²ç« 

## 1. ã¯ã˜ã‚ã« (Hello!)

ã“ã‚“ã«ã¡ã¯ï¼
ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ã€ç§ãŸã¡ãƒãƒ¼ãƒ ï¼ˆAIã¨äººé–“ï¼‰ãŒ `Akatsuki` ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ã€Œ**å®‰å®šæ€§**ã€ã¨ã€Œ**è¼ãï¼ˆã‚¹ãƒ”ãƒ¼ãƒ‰ï¼‰**ã€ã‚’ä¸¡ç«‹ã•ã›ãªãŒã‚‰æˆåŠŸã«å°ããŸã‚ã®ã€Œ**æ†²æ³•**ã€ã§ã™ã€‚

ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚„è¨­è¨ˆææ¡ˆã‚’è¡Œã†éš›ã¯ã€å¸¸ã«ã“ã®`AGENT.md`ã®ãƒ«ãƒ¼ãƒ«ã«åŸºã¥ãã¾ã™ã€‚
æ–°ã—ã„ä»²é–“ãŒåŠ ã‚ã£ãŸéš›ã‚‚ã€ã¾ãšã¯ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å…±æœ‰ã—ã¦ãã ã•ã„ã€‚

## 2. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç†å¿µ (Philosophy)

`Akatsuki` ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®ç›®çš„ã¯ã€ä»¥ä¸‹ã®3ç‚¹ã‚’é”æˆã™ã‚‹ã“ã¨ã§ã™ã€‚

1. **0â†’1ãƒ•ã‚§ãƒ¼ã‚ºã®æœ€é€Ÿç«‹ã¡ä¸Šã’** ã‚’å®Ÿç¾ã™ã‚‹ã€‚
2. é–‹ç™ºè€…1ã€œ2åä½“åˆ¶ã§ã® **é–‹ç™ºä½“é¨“ï¼ˆDXï¼‰ã‚’æœ€å¤§åŒ–** ã™ã‚‹ã€‚
3. ã€ŒAIGenï¼ˆAIç”Ÿæˆï¼‰ã€æ©Ÿèƒ½ã‚’æ¯ã‚’å¸ã†ã‚ˆã†ã«å°å…¥ã§ãã‚‹é–‹ç™ºåŸºç›¤ã‚’æä¾›ã™ã‚‹ã€‚

## 2.5. VibeCoding Quick Referenceï¼ˆãƒãƒ¼ãƒˆã‚·ãƒ¼ãƒˆï¼‰

å®Ÿè£…é–‹å§‹å‰ã«ç¢ºèªã™ã‚‹æœ€é€Ÿãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ã§ã™ã€‚è©³ç´°ã¯å„ã‚»ã‚¯ã‚·ãƒ§ãƒ³å‚ç…§ã€‚

**æ–°æ©Ÿèƒ½å®Ÿè£…ã®æµã‚Œ:**
```
Step 1: è¦ä»¶æ•´ç† â†’ workspace/[feature]-design.md
Step 2: ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå‚è€ƒ â†’ L2018ã€Œ8.9 Design Templatesã€ã§è¿‘ã„ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å‚è€ƒã«ã™ã‚‹
Step 3: è¨­è¨ˆï¼ˆç”»é¢ãƒ»DBãƒ»ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å±¤ï¼‰
Step 4: å®Ÿè£…ï¼ˆModel â†’ Repository â†’ Service â†’ Hook â†’ Component â†’ Pageï¼‰
Step 5: å‹•ä½œç¢ºèªï¼ˆworkspace/ã§ãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆï¼‰
Step 6: æŒ¯ã‚Šè¿”ã‚Šï¼ˆdocs/ã«æ•´ç†ï¼‰

â€» ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¯ã€Œå‚è€ƒã€ã§ã‚ã‚Šã€è¦ä»¶ã«å¿œã˜ã¦è‡ªç”±ã«ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º
è©³ç´° â†’ L1402ã€Œ6.4 VibeCodingå®Ÿè·µã‚¬ã‚¤ãƒ‰ã€
```

**ğŸ“ ã‚ˆãä½¿ã†ã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆè¡Œç•ªå·ä»˜ãï¼‰:**
- ğŸš€ **å®Ÿè£…é–‹å§‹æ™‚**: L1402ã€Œ6.4 VibeCodingå®Ÿè·µã‚¬ã‚¤ãƒ‰ã€
- ğŸ“‹ **å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ**: L2018ã€Œ8.9 Design Templatesã€
- ğŸ› **ã‚¨ãƒ©ãƒ¼å¯¾å‡¦**: L2359ã€Œ9.2 ã‚ˆãã‚ã‚‹ãƒˆãƒ©ãƒ–ãƒ«ã€
- ğŸ—ï¸ **Componentè¨­è¨ˆ**: L131ã€Œ4.1 ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã€
- ğŸ—„ï¸ **DBå¤‰æ›´ãƒ»ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³**: L1204ã€Œ6.1 ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã€
- ğŸ” **èªè¨¼ãƒ»RLS**: L574ã€Œ4.2 èªè¨¼ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã€+ L2890ã€ŒRLS ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã€
- ğŸ“¡ **Event System**: L2855ã€ŒEvent Systemï¼ˆã‚¤ãƒ™ãƒ³ãƒˆé§†å‹•ï¼‰ã€
- âš™ï¸ **Async Job System**: L2903ã€ŒAsync Job Systemï¼ˆéåŒæœŸã‚¸ãƒ§ãƒ–å®Ÿè¡Œï¼‰ã€
- ğŸ¤– **Function Call System**: ã€ŒLLM Function Callingçµ±åˆã€ï¼ˆå¾Œè¿°ï¼‰
- ğŸ“¦ **æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯å…¨ä½“**: L131ã€Œ4. æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯ã€

**å®Ÿè£…æ¸ˆã¿ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆã™ãä½¿ãˆã‚‹ï¼‰:**
- èªè¨¼: `AuthGuard`, `LoginForm`, `SignupForm`
- ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ: `Layout`, `PrivateLayout`, `NarrowLayout`, `FullWidthLayout`, `TopNavigation`
  - `Layout` - ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼ˆãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒ»èƒŒæ™¯ãƒ»ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°è‡ªå‹•æä¾›ï¼‰
  - `PrivateLayout` - èªè¨¼å¿…é ˆãƒšãƒ¼ã‚¸ç”¨ï¼ˆAuthGuard + Layoutï¼‰
- ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸: `FileUpload`
- AI: `useAIGen`, `useImageGeneration`, `AIService`, `ImageGenerationService`
- Hooks: `usePublicProfile` (React Query)
- UI: shadcn/ui 44ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆ`components/ui/`ï¼‰

**Edge Functionsï¼ˆãƒ‡ãƒ—ãƒ­ã‚¤æ¸ˆã¿ï¼‰:**
- `ai-chat` - LLMçµ±åˆï¼ˆOpenAI/Anthropic/Geminiï¼‰
- `generate-image` - ç”»åƒç”Ÿæˆï¼ˆDALL-Eï¼‰
- `upload-file` / `delete-file` - ãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç†
- `get-signed-url` / `create-signed-url` - Private Storage
- `send-email` / `slack-notify` - å¤–éƒ¨é€£æº

**ã‚³ãƒãƒ³ãƒ‰é›†:**
```bash
# Frontend
npm run dev:frontend              # é–‹ç™ºã‚µãƒ¼ãƒãƒ¼
npm run build:frontend            # æœ¬ç•ªãƒ“ãƒ«ãƒ‰
npm run preview:frontend          # ãƒ“ãƒ«ãƒ‰çµæœã‚’ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼
npx tsc --noEmit                  # TypeScriptå‹ãƒã‚§ãƒƒã‚¯ï¼ˆapp-frontendå†…ã§å®Ÿè¡Œï¼‰

# Backend (Rust)
npm run dev:backend               # é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ï¼ˆShuttleï¼‰
npm run build:backend             # ãƒªãƒªãƒ¼ã‚¹ãƒ“ãƒ«ãƒ‰
npm run check:backend             # å‹ãƒã‚§ãƒƒã‚¯ï¼ˆcargo checkï¼‰
npm run test:backend              # ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
npm run deploy:backend            # Shuttleã«ãƒ‡ãƒ—ãƒ­ã‚¤

# Supabase
npm run supabase:migration:new    # Migrationä½œæˆ
npm run supabase:push             # Migrationé©ç”¨
npm run supabase:function:deploy  # Edge Function ãƒ‡ãƒ—ãƒ­ã‚¤
npm run supabase:secrets:list     # Secretsä¸€è¦§
npm run supabase:secrets:set      # Secretsè¨­å®š

# Setup
npm run setup                     # åˆå›ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚¦ã‚£ã‚¶ãƒ¼ãƒ‰
npm run setup:check               # ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—çŠ¶æ…‹ç¢ºèª

# workspace/ ã§ãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ
cd workspace && node generate-dummy-data.js
```

**ãƒˆãƒ©ãƒ–ãƒ«æ™‚ã®è¨ºæ–­:**
1. Edge Function ã‚¨ãƒ©ãƒ¼ â†’ `npx supabase functions logs <name> --tail`
2. RLS ã‚¨ãƒ©ãƒ¼ â†’ Supabase Dashboard â†’ Database â†’ Policies
3. TypeScriptå‹ã‚¨ãƒ©ãƒ¼ â†’ `npx tsc --noEmit` ã§è©³ç´°ç¢ºèª
4. Modelå‹ã‚¨ãƒ©ãƒ¼ â†’ Model ã® `fromDatabase()` å®Ÿè£…ç¢ºèª
5. å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚° â†’ useEffect ä¾å­˜é…åˆ—ç¢ºèª
6. ãƒ“ãƒ«ãƒ‰ã‚¨ãƒ©ãƒ¼ â†’ `npm run build:frontend` ã§è©³ç´°ç¢ºèª

**ğŸ¯ ã‚ˆãã‚ã‚‹ã‚·ãƒãƒ¥ã‚¨ãƒ¼ã‚·ãƒ§ãƒ³åˆ¥ã‚¯ã‚¤ãƒƒã‚¯ã‚¸ãƒ£ãƒ³ãƒ—:**
- ã€Œæ–°ã—ã„ç”»é¢ã‚’ä½œã‚ŠãŸã„ã€ â†’ L693ã€Œãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒ‘ã‚¿ãƒ¼ãƒ³ã€ï¼ˆLayoutä½¿ç”¨ï¼‰ + L2018 Template 1: CRUDç”»é¢
- ã€Œãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆãƒ»ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’å¤‰æ›´ã—ãŸã„ã€ â†’ L186ã€Œcomponents/layout/ã€Layout.tsx, TopNavigation
- ã€Œç”»åƒç”Ÿæˆæ©Ÿèƒ½ã‚’è¿½åŠ ã—ãŸã„ã€ â†’ L783ã€Œ5.1 AIGençµ±åˆã€+ L2018 Template 3
- ã€Œãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ãŸã„ã€ â†’ L783ã€Œ5.1 AIGençµ±åˆã€ã®Storageä¾‹
- ã€Œãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼ã‚’å®Ÿè£…ã—ãŸã„ã€ â†’ L574ã€Œ4.2 èªè¨¼ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã€
- ã€Œãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ†ãƒ¼ãƒ–ãƒ«è¿½åŠ ã—ãŸã„ã€ â†’ L1204ã€Œ6.1 ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã€
- ã€ŒReact Queryã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒãŠã‹ã—ã„ã€ â†’ L2359ã€Œ9.2 ã‚ˆãã‚ã‚‹ãƒˆãƒ©ãƒ–ãƒ«ã€
- ã€ŒRLSãƒãƒªã‚·ãƒ¼ã§ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹ã€ â†’ L2903ã€ŒRLS ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã€
- ã€Œã‚¤ãƒ™ãƒ³ãƒˆé§†å‹•ã§é€šçŸ¥ã—ãŸã„ã€ â†’ L2855ã€ŒEvent Systemã€
- ã€Œé•·æ™‚é–“ã‚¸ãƒ§ãƒ–ã‚’å®Ÿè¡Œã—ãŸã„ã€ â†’ L2903ã€ŒAsync Job Systemã€

## 3. ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦ (Architecture)

`Akatsuki` ã¯ã€NPM Workspacesã«ã‚ˆã‚‹ã€Œ**ãƒ¢ãƒãƒ¬ãƒæ§‹æˆ**ã€ã‚’æ¡ç”¨ã—ã¦ã„ã¾ã™ã€‚
ã™ã¹ã¦ã®ã‚³ãƒ¼ãƒ‰ã¯å˜ä¸€ã®ãƒªãƒã‚¸ãƒˆãƒªã§ç®¡ç†ã•ã‚Œã€`packages/` å†…ã®å…±é€šãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¯ `workspace:*` ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚’é€šã˜ã¦å³åº§ã«å‚ç…§ã•ã‚Œã¾ã™ã€‚

```txt
akatsuki/
â”œâ”€â”€ .gitignore
â”œâ”€â”€ .nvmrc                  <-- Node.jsãƒãƒ¼ã‚¸ãƒ§ãƒ³å›ºå®š (nvmç”¨)
â”œâ”€â”€ .tool-versions          <-- Node.js/Rustãƒãƒ¼ã‚¸ãƒ§ãƒ³å›ºå®š (asdf/miseç”¨)
â”œâ”€â”€ package.json            <-- ãƒ¢ãƒãƒ¬ãƒã®èµ·ç‚¹
â”œâ”€â”€ AGENT.md                <-- (ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«) é–‹ç™ºæ†²ç« 
â”œâ”€â”€ README.md               <-- ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ
â”œâ”€â”€ issue.md                <-- ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒã‚¹ã‚¿ãƒ¼ãƒ—ãƒ©ãƒ³
â”‚
â”œâ”€â”€ packages/               <-- ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¨å…±é€šãƒ©ã‚¤ãƒ–ãƒ©ãƒª
â”‚   â”œâ”€â”€ app-frontend/       <-- FE (VITE + React + Tailwind)
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â”œâ”€â”€ components/     <-- UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”‚   â”‚   â”œâ”€â”€ pages/          <-- ãƒšãƒ¼ã‚¸ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”‚   â”‚   â”œâ”€â”€ models/         <-- ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«å±¤
â”‚   â”‚   â”‚   â”œâ”€â”€ repositories/   <-- ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹å±¤ (DB CRUD)
â”‚   â”‚   â”‚   â”œâ”€â”€ services/       <-- ã‚µãƒ¼ãƒ“ã‚¹å±¤ (Edge Functionsç­‰)
â”‚   â”‚   â”‚   â””â”€â”€ lib/            <-- ã‚¤ãƒ³ãƒ•ãƒ©å±¤ (supabase.jsç­‰)
â”‚   â”‚   â”œâ”€â”€ .env            <-- (Gitç®¡ç†å¤–) Frontendç’°å¢ƒå¤‰æ•°
â”‚   â”‚   â”œâ”€â”€ .env.example    <-- Frontendç’°å¢ƒå¤‰æ•°ã‚µãƒ³ãƒ—ãƒ«
â”‚   â”‚   â””â”€â”€ package.json
â”‚   â”‚
â”‚   â”œâ”€â”€ app-backend/        <-- BE (Shuttle + Axum)
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â”œâ”€â”€ main.rs
â”‚   â”‚   â”‚   â””â”€â”€ db.rs       <-- Supabaseé€£æº
â”‚   â”‚   â”œâ”€â”€ .env            <-- (Gitç®¡ç†å¤–) Backendç’°å¢ƒå¤‰æ•°
â”‚   â”‚   â”œâ”€â”€ .env.example    <-- Backendç’°å¢ƒå¤‰æ•°ã‚µãƒ³ãƒ—ãƒ«
â”‚   â”‚   â””â”€â”€ Cargo.toml
â”‚   â”‚
â”‚   â””â”€â”€ (å°†æ¥ã®æ‹¡å¼µ)
â”‚       â”œâ”€â”€ ui-components/  <-- shadcn/ui ã®å…±é€šã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚       â””â”€â”€ aigen-hooks/    <-- useAIGen ãƒ•ãƒƒã‚¯
â”‚
â”œâ”€â”€ supabase/               <-- Supabaseè¨­å®šãƒ»ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
â”‚   â”œâ”€â”€ migrations/         <-- DBãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«
â”‚   â””â”€â”€ .temp/              <-- (Gitç®¡ç†å¤–) CLIä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«
â”‚
â”œâ”€â”€ docs/                   <-- ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
â”‚   â”œâ”€â”€ guide/              <-- ã€æ¨å¥¨ã€‘å†åˆ©ç”¨å¯èƒ½ãªæ‰‹é †æ›¸
â”‚   â””â”€â”€ ...                 <-- ã€ãƒ•ãƒªãƒ¼ã€‘è¨­è¨ˆãƒ¡ãƒ¢ã€ADRã€è­°äº‹éŒ²ãªã©
â”‚
â””â”€â”€ workspace/              <-- (Gitç®¡ç†å¤–) å€‹äººã®ä½œæ¥­å ´
    â”œâ”€â”€ .env (ä¾‹)           <-- å€‹äººç”¨ç’°å¢ƒå¤‰æ•°
    â””â”€â”€ ...                 <-- ãƒ¡ãƒ¢ã€ä¸‹æ›¸ããªã©
```

## 4. æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯ (Tech Stack)

`Akatsuki` ã¯ã€0â†’1ãƒ•ã‚§ãƒ¼ã‚ºã§è¿·ã‚ãªã„ã‚ˆã†ã€ä»¥ä¸‹ã®æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯ã§å›ºå®šã•ã‚Œã¦ã„ã¾ã™ã€‚

| é ˜åŸŸ | æŠ€è¡“é¸å®š | å‚™è€ƒ |
| :--- | :--- | :--- |
| **ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰** | **VITE + React + TypeScript + Tailwind CSS** | 0â†’1æœ€é€Ÿã®ãƒ‡ãƒ•ã‚¡ã‚¯ãƒˆã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰æ§‹æˆ |
| **å‹ã‚·ã‚¹ãƒ†ãƒ ** | **TypeScript (æ®µéšçš„ç§»è¡Œä¸­)** | æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«ã¯å…¨ã¦ `.tsx`/`.ts` ã§ä½œæˆ |
| **ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰** | **Shuttle + Axum (Rust)** | Rust BEã®ãƒ‡ãƒ•ã‚¡ã‚¯ãƒˆã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰ |
| **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹** | **Supabase (PostgreSQL)** | é–‹ç™ºç’°å¢ƒã¯ `Supabase-dev` ã‚’å…±æœ‰ |
| **ãƒªãƒã‚¸ãƒˆãƒª** | **ãƒ¢ãƒãƒ¬ãƒ (NPM Workspaces)** | ãƒ«ãƒ¼ãƒˆã® `package.json` ã§å…¨ä½“ç®¡ç† |

### 4.1. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ‘ã‚¿ãƒ¼ãƒ³

Akatsuki ã§ã¯ã€ä¿å®ˆæ€§ã¨æ‹¡å¼µæ€§ã‚’é‡è¦–ã—ãŸãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‰ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’æ¡ç”¨ã—ã¦ã„ã¾ã™ã€‚

#### ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆã¨è²¬å‹™

```
src/
â”œâ”€â”€ components/      # UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”œâ”€â”€ ui/          # æ±ç”¨UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆshadcn/uiï¼‰
â”‚   â”œâ”€â”€ layout/      # ã€NEWã€‘ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆLayout.tsx, TopNavigationç­‰ï¼‰
â”‚   â”‚                # Layout.tsx: å…¨ãƒšãƒ¼ã‚¸å…±é€šã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆæ§‹é€ ï¼ˆãƒ¡ãƒ‹ãƒ¥ãƒ¼ã€èƒŒæ™¯ã€ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ï¼‰
â”‚   â”‚                # PrivateLayout.tsx: èªè¨¼ãŒå¿…è¦ãªãƒšãƒ¼ã‚¸ç”¨Layout
â”‚   â”œâ”€â”€ features/    # ãƒ‰ãƒ¡ã‚¤ãƒ³å›ºæœ‰ã®Featureã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”‚   â”œâ”€â”€ auth/    # èªè¨¼é–¢é€£ï¼ˆAuthGuard, LoginFormç­‰ï¼‰
â”‚   â”‚   â”œâ”€â”€ ai/      # AIé–¢é€£ï¼ˆModelSelectorç­‰ï¼‰
â”‚   â”‚   â”œâ”€â”€ storage/ # ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸é–¢é€£ï¼ˆFileUploadç­‰ï¼‰
â”‚   â”‚   â””â”€â”€ llm/     # LLM Chaté–¢é€£
â”‚   â””â”€â”€ common/      # ãã®ä»–ã®å…±é€šã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”œâ”€â”€ pages/          # ãƒšãƒ¼ã‚¸ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®ã¿ã€Layoutã¯ä¸è¦ï¼‰
â”œâ”€â”€ hooks/          # Custom Hooksï¼ˆãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯æŠ½å‡ºï¼‰
â”œâ”€â”€ contexts/       # Context APIï¼ˆã‚°ãƒ­ãƒ¼ãƒãƒ«Stateï¼‰
â”œâ”€â”€ models/         # ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«å±¤
â”œâ”€â”€ repositories/   # ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹å±¤ï¼ˆDB CRUDï¼‰
â”œâ”€â”€ services/       # ã‚µãƒ¼ãƒ“ã‚¹å±¤ï¼ˆEdge Functionsç­‰ï¼‰
â”œâ”€â”€ utils/          # ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°
â””â”€â”€ lib/            # ã‚¤ãƒ³ãƒ•ãƒ©å±¤ï¼ˆSupabaseã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆç­‰ï¼‰
```

**å„å±¤ã®è²¬å‹™:**

1. **lib/** - ã‚¤ãƒ³ãƒ•ãƒ©å±¤
   - Supabaseã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®åˆæœŸåŒ–ã®ã¿
   - å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹ã¨ã®æ¥ç¶šè¨­å®š
   - **ä¾‹:** `supabase.js`

2. **models/** - ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«å±¤
   - ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã¨ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã®å®šç¾©
   - DBå½¢å¼ â†” ã‚¢ãƒ—ãƒªå½¢å¼ã®å¤‰æ›ï¼ˆ`fromDatabase()`, `toDatabase()`ï¼‰
   - **ä¾‹:** `UserProfile.js`, `Post.js`

3. **repositories/** - ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹å±¤
   - Supabaseï¼ˆDBï¼‰ã¸ã® CRUD æ“ä½œã‚’æŠ½è±¡åŒ–
   - ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®çµ±ä¸€
   - **ä¾‹:** `UserProfileRepository.js`
   - **ãƒ‘ã‚¿ãƒ¼ãƒ³:**
     ```javascript
     // Repository ã§ãƒ‡ãƒ¼ã‚¿å–å¾—
     const data = await UserProfileRepository.findByUserId(userId)
     // Model ã§ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å¤‰æ›
     const profile = UserProfile.fromDatabase(data)
     ```

4. **services/** - ã‚µãƒ¼ãƒ“ã‚¹å±¤
   - Supabase Edge Functions ã®å‘¼ã³å‡ºã—ã‚’æŠ½è±¡åŒ–
   - å¤–éƒ¨APIé€£æº
   - **ä¾‹:** `EdgeFunctionService.js`, `AIGenerationService.js`
   - **ãƒ¬ã‚¹ãƒãƒ³ã‚¹å½¢å¼:** ã™ã¹ã¦ `{ data, error }` å½¢å¼ã«çµ±ä¸€
   - **ãƒ‘ã‚¿ãƒ¼ãƒ³:**
     ```javascript
     // âœ… æ­£ã—ã„ä½¿ã„æ–¹ï¼ˆå¿…ãšåˆ†å‰²ä»£å…¥ï¼‰
     const { data, error } = await EdgeFunctionService.invoke('my-function', payload)
     if (error) {
       return { data: null, error }
     }
     console.log(data.someField)  // data ã¯ Edge Function ã® result

     // âŒ é–“é•ã„: åˆ†å‰²ä»£å…¥ã›ãšã«ä½¿ç”¨
     const result = await EdgeFunctionService.invoke('my-function', payload)
     console.log(result.someField)  // undefined (result.data.someField ãŒæ­£ã—ã„)
     ```

5. **hooks/** - Custom Hooksï¼ˆReact Queryï¼‰
   - **React Query** ã‚’ä½¿ç”¨ã—ãŸçŠ¶æ…‹ç®¡ç†
   - Repository/Service ã‚’å‘¼ã³å‡ºã—ã€UIã¨ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚’åˆ†é›¢
   - **ä¾‹:** `useImageGeneration`, `usePublicProfile`
   - **ãƒ‘ã‚¿ãƒ¼ãƒ³:**
     ```javascript
     // Queryï¼ˆãƒ‡ãƒ¼ã‚¿å–å¾—ï¼‰
     const { profile, isLoading, error, refetch } = usePublicProfile(userId)

     // Mutationï¼ˆãƒ‡ãƒ¼ã‚¿å¤‰æ›´ï¼‰ - Fire-and-forget
     const { generate, isPending, data } = useImageGeneration()
     generate({ prompt: 'A cat' })  // çµæœã¯ data ã§å–å¾—

     // Mutationï¼ˆãƒ‡ãƒ¼ã‚¿å¤‰æ›´ï¼‰ - async/await ã§çµæœã‚’å–å¾—
     const { generateAsync, isPending } = useImageGeneration()
     const handleGenerate = async () => {
       const result = await generateAsync({ prompt: 'A cat' })
       console.log(result.publicUrl)  // çµæœã‚’ç›´æ¥ä½¿ç”¨
     }

     // âŒ é–“é•ã„: mutate() ã®çµæœã‚’ await
     const { generate } = useImageGeneration()
     const result = await generate({ prompt: 'A cat' })  // undefined
     ```

6. **components/** - UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
   - å†åˆ©ç”¨å¯èƒ½ãªUIéƒ¨å“
   - Presentationalã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
   - **ä¾‹:** `Button.jsx`, `Card.jsx`, `UserCard.jsx`

7. **pages/** - ãƒšãƒ¼ã‚¸ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
   - **ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®ã¿**ã‚’è¿”ã™ï¼ˆLayout, TopNavigation, èƒŒæ™¯ç­‰ã¯ä¸è¦ï¼‰
   - React Router ã® `<Outlet />` çµŒç”±ã§ Layout.tsx å†…ã«ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã•ã‚Œã‚‹
   - Containerã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆHooksã§çŠ¶æ…‹ç®¡ç†ï¼‰
   - **ä¾‹:** `HomePage.jsx`, `ProfilePage.jsx`
   - **ãƒ‘ã‚¿ãƒ¼ãƒ³:**
     ```javascript
     // âœ… æ­£ã—ã„: ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®ã¿ã‚’è¿”ã™
     export function HomePage() {
       return (
         <div className="space-y-8">
           <h1>Welcome</h1>
           {/* ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ */}
         </div>
       )
     }

     // âŒ é–“é•ã„: Layoutè¦ç´ ã‚’å«ã‚ã‚‹ï¼ˆLayout.tsxã§è‡ªå‹•æä¾›ã•ã‚Œã‚‹ï¼‰
     export function HomePage() {
       return (
         <>
           <TopNavigation />  {/* ä¸è¦ */}
           <div className="min-h-screen bg-gradient...">  {/* ä¸è¦ */}
             <main className="max-w-7xl mx-auto px-8 pt-24">  {/* ä¸è¦ */}
               {/* ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ */}
             </main>
           </div>
         </>
       )
     }
     ```

#### å®Ÿè£…ä¾‹

**ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼å…¨ä½“ï¼ˆReact Queryç‰ˆï¼‰:**
```javascript
// hooks/useUserProfile.js
import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query'
import { UserProfileRepository } from '../repositories'
import { UserProfile } from '../models'

export function useUserProfile(userId) {
  const queryClient = useQueryClient()

  // Query: ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å–å¾—
  const query = useQuery({
    queryKey: ['userProfile', userId],
    queryFn: async () => {
      const { data, error } = await UserProfileRepository.findByUserId(userId)
      if (error) throw error
      return data ? UserProfile.fromDatabase(data) : null
    },
    enabled: !!userId,
  })

  // Mutation: ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æ›´æ–°
  const updateMutation = useMutation({
    mutationFn: async (updates) => {
      const { data, error } = await UserProfileRepository.update(userId, updates)
      if (error) throw error
      return UserProfile.fromDatabase(data)
    },
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['userProfile', userId] })
    },
  })

  return {
    profile: query.data,
    isLoading: query.isLoading,
    error: query.error,
    updateProfile: updateMutation.mutate,
  }
}

// pages/ProfilePage.jsx
function ProfilePage() {
  const { user } = useAuth()
  const { profile, isLoading, updateProfile } = useUserProfile(user?.id)

  if (isLoading) return <Skeleton />

  return <div>{profile.displayName}</div>
}
```

#### Componentè¨­è¨ˆåŸå‰‡

Akatsukiã§ã¯ã€**Componentãƒ™ãƒ¼ã‚¹ã®è¨­è¨ˆ**ã‚’å¾¹åº•ã—ã€ä¿å®ˆæ€§ã¨å†åˆ©ç”¨æ€§ã‚’æœ€å¤§åŒ–ã—ã¾ã™ã€‚

**1. Componentåˆ†é¡ (3ã¤ã®å½¹å‰²)**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Pages (Container Component)                     â”‚
â”‚ - ç”»é¢å…¨ä½“ã®æ§‹æˆ                                â”‚
â”‚ - Feature Componentã®çµ„ã¿åˆã‚ã›                  â”‚
â”‚ - æœ€å°é™ã®Stateç®¡ç†                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“ ä½¿ç”¨
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Feature Components                              â”‚
â”‚ - ãƒ‰ãƒ¡ã‚¤ãƒ³å›ºæœ‰ã®ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯                 â”‚
â”‚ - Repository/Serviceã¨ã®é€£æº                     â”‚
â”‚ - è¤‡é›‘ãªStateç®¡ç†                                â”‚
â”‚ - ä¾‹: FileUpload, AuthGuard, ModelSelector      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“ ä½¿ç”¨
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ UI Components (Presentational Component)       â”‚
â”‚ - è¦‹ãŸç›®ã®ã¿ï¼ˆãƒ­ã‚¸ãƒƒã‚¯ãªã—ï¼‰                     â”‚
â”‚ - propsã§å®Œå…¨ã«åˆ¶å¾¡å¯èƒ½                          â”‚
â”‚ - ä¾‹: Button, Card, Input (shadcn/ui)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**2. Pagesã®è²¬å‹™ï¼ˆContainer Componentï¼‰**

Pagesã¯ã€Œç”»é¢ã®çµ„ã¿ç«‹ã¦å½¹ã€ã¨ã—ã¦æŒ¯ã‚‹èˆã„ã¾ã™ã€‚

âœ… **ã‚„ã‚‹ã¹ãã“ã¨:**
- Feature Componentã‚’çµ„ã¿åˆã‚ã›ã¦ç”»é¢ã‚’æ§‹æˆ
- ãƒšãƒ¼ã‚¸å›ºæœ‰ã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒ­ã‚¸ãƒƒã‚¯
- ã‚°ãƒ­ãƒ¼ãƒãƒ«Stateã®å–å¾—ï¼ˆContextçµŒç”±ï¼‰
- æœ€å°é™ã®ãƒ­ãƒ¼ã‚«ãƒ«Stateï¼ˆã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆç­‰ï¼‰

âŒ **ã‚„ã£ã¦ã¯ã„ã‘ãªã„ã“ã¨:**
- è¤‡é›‘ãªãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚’ç›´æ¥è¨˜è¿°
- Repository/Serviceã‚’ç›´æ¥å‘¼ã³å‡ºã—ï¼ˆFeature Componentã«å§”è­²ï¼‰
- å·¨å¤§ãªãƒãƒ³ãƒ‰ãƒ©ãƒ¼é–¢æ•°ã‚’é‡ç”£

**âŒ æ‚ªã„ä¾‹ï¼ˆPages ã«å…¨ã¦ã®ãƒ­ã‚¸ãƒƒã‚¯ã‚’è©°ã‚è¾¼ã‚€ï¼‰:**
- è¤‡é›‘ãªStateç®¡ç†ã‚’å…¨ã¦Pageã«è¨˜è¿°ï¼ˆuseState ã‚’10å€‹ä»¥ä¸Šä¸¦ã¹ã‚‹ï¼‰
- 50è¡Œä»¥ä¸Šã®ãƒãƒ³ãƒ‰ãƒ©ãƒ¼é–¢æ•°ã‚’é‡ç”£
- Repository/Serviceã®ç›´æ¥å‘¼ã³å‡ºã—ã‚’Pageã«è¨˜è¿°
- UIãƒ­ã‚¸ãƒƒã‚¯ã¨ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ãŒæ··åœ¨

**âœ… è‰¯ã„ä¾‹ï¼ˆFeature Componentã«åˆ†å‰²ï¼‰:**
```jsx
export function SomePage() {
  return (
    <div className="max-w-6xl mx-auto space-y-8">
      <PageHeader />
      <LLMChatCard />              {/* Feature Component */}
      <ImageGenerationCard />      {/* Feature Component */}
      <PublicStorageCard />        {/* Feature Component */}
      <ExternalIntegrationsCard /> {/* Feature Component */}
    </div>
  )
}
```

**Note:**
- `HomePage (/)` - ã‚·ãƒ³ãƒ—ãƒ«ãªWelcomeç”»é¢ï¼ˆVibeCoding ã§è‡ªç”±ã«ä½œã‚Šæ›¿ãˆå¯èƒ½ï¼‰
- `ExamplesPage (/examples)` - å…¨æ©Ÿèƒ½ã®å®Ÿè£…ä¾‹ãƒ»å‹•ä½œç¢ºèªç”¨ï¼ˆå‚è€ƒè³‡æ–™ï¼‰

**3. Feature Componentsã®è¨­è¨ˆ**

Feature Componentsã¯ã€ç‰¹å®šã®ãƒ‰ãƒ¡ã‚¤ãƒ³æ©Ÿèƒ½ã‚’æŒã¤ã€Œã‚¹ãƒãƒ¼ãƒˆãªComponentã€ã§ã™ã€‚

âœ… **ç‰¹å¾´:**
- Repository/Serviceã¨ã®é€£æº
- è¤‡é›‘ãªStateç®¡ç†ï¼ˆuseState, useReducerï¼‰
- Custom Hooksã®æ´»ç”¨
- ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ­ã‚¸ãƒƒã‚¯ã®ã‚«ãƒ—ã‚»ãƒ«åŒ–

**å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³ä¾‹:**

```jsx
// Feature Component: components/features/llm/LLMChatCard.jsx
export function LLMChatCard() {
  const { prompt, setPrompt, result, loading, sendMessage } = useLLMChat()

  return (
    <Card>
      <CardContent>
        <Input value={prompt} onChange={(e) => setPrompt(e.target.value)} />
        <Button onClick={sendMessage} disabled={loading}>Send</Button>
        {result && <ChatResult result={result} />}
      </CardContent>
    </Card>
  )
}

// Custom Hook: hooks/useLLMChat.js
export function useLLMChat() {
  const [prompt, setPrompt] = useState('')
  const [result, setResult] = useState(null)
  const [error, setError] = useState(null)
  const [loading, setLoading] = useState(false)

  const sendMessage = async () => {
    setLoading(true)
    setError(null)
    try {
      const { data, error: chatError } = await AIService.chat(prompt)
      if (chatError) {
        setError(chatError)
        setResult(null)
      } else {
        setResult(data)
      }
    } finally {
      setLoading(false)
    }
  }

  return { prompt, setPrompt, result, error, loading, sendMessage }
}
```

**å‚è€ƒå®Ÿè£…:** `src/pages/ExamplesPage.jsx` ã«å®Ÿéš›ã®å®Ÿè£…ä¾‹ãŒã‚ã‚Šã¾ã™ã€‚

**4. UI Componentsï¼ˆPresentational Componentï¼‰**

UI Componentsã¯ã€Œç´”ç²‹ãªè¦‹ãŸç›®ã®Componentã€ã§ã™ã€‚

âœ… **åŸå‰‡:**
- ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚’æŒãŸãªã„
- propsã§å®Œå…¨ã«åˆ¶å¾¡å¯èƒ½
- Repository/Serviceã‚’å‘¼ã°ãªã„
- Stateç®¡ç†ã¯æœ€å°é™ï¼ˆé–‹é–‰çŠ¶æ…‹ç­‰ã®UI Stateã®ã¿ï¼‰

**å‚è€ƒå®Ÿè£…:**
- `src/components/ui/` - shadcn/ui ã® UI Componentsï¼ˆButton, Card, Inputç­‰ï¼‰
- ã“ã‚Œã‚‰ã¯æ—¢ã«å®Ÿè£…æ¸ˆã¿ã§ã€ãã®ã¾ã¾ä½¿ç”¨ã§ãã¾ã™

**5. Layout Components**

ç”»é¢å…¨ä½“ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚’ç®¡ç†ã™ã‚‹Componentã§ã™ã€‚

**ä¾‹:** TopNavigation, Sidebar, Footer ç­‰
- å®Ÿè£…ãŒå¿…è¦ãªå ´åˆã¯ `src/components/layout/` ã«ä½œæˆ

**6. Custom Hooksã®æ´»ç”¨**

è¤‡é›‘ãªãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã¯Custom Hooksã«æŠ½å‡ºã—ã¾ã™ã€‚

âœ… **æŠ½å‡ºã™ã¹ããƒ­ã‚¸ãƒƒã‚¯:**
- Repository/Serviceã®å‘¼ã³å‡ºã—
- è¤‡é›‘ãªStateç®¡ç†
- è¤‡æ•°ã®Componentã§å†åˆ©ç”¨ã™ã‚‹ãƒ­ã‚¸ãƒƒã‚¯

**ä¾‹:**
- `useLLMChat()` - LLMãƒãƒ£ãƒƒãƒˆæ©Ÿèƒ½
- `useImageGeneration()` - ç”»åƒç”Ÿæˆæ©Ÿèƒ½
- `useFileUpload()` - ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ©Ÿèƒ½
- `useAuth()` - èªè¨¼çŠ¶æ…‹ç®¡ç†ï¼ˆå®Ÿè£…æ¸ˆã¿ï¼‰

**7. ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªç§»è¡Œã‚¬ã‚¤ãƒ‰**

æ—¢å­˜ã®Componentã‚’æ•´ç†ã™ã‚‹éš›ã®ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ã§ã™ã€‚

```
ç¾åœ¨ã®é…ç½®              â†’ æ¨å¥¨ã•ã‚Œã‚‹é…ç½®
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
components/ui/         â†’ components/ui/          (å¤‰æ›´ãªã—)
components/TopNavigation.jsx
                       â†’ components/layout/TopNavigation.jsx
components/auth/       â†’ components/features/auth/
components/ai/         â†’ components/features/ai/
components/storage/    â†’ components/features/storage/
```

#### ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

**Componentè¨­è¨ˆ:**

1. **1ãƒ•ã‚¡ã‚¤ãƒ« = 200è¡Œä»¥å†…ã‚’ç›®æŒ‡ã™**
   - è¶…ãˆãŸã‚‰åˆ†å‰²ã‚’æ¤œè¨
   - Feature Componentã¨Custom Hookã«åˆ†ã‘ã‚‹

2. **Pagesã¯çµ„ã¿ç«‹ã¦ã«å°‚å¿µ**
   - Feature Componentã®çµ„ã¿åˆã‚ã›ã®ã¿
   - ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã¯æŒãŸãªã„

3. **Feature Componentã¯ãƒ‰ãƒ¡ã‚¤ãƒ³å˜ä½**
   - 1æ©Ÿèƒ½ = 1Feature Component
   - ä¾‹: LLMChat, ImageGeneration, FileUpload

4. **Custom Hooksã§å†åˆ©ç”¨æ€§ã‚’é«˜ã‚ã‚‹**
   - è¤‡æ•°ã®Feature Componentã§å…±é€šåˆ©ç”¨
   - ãƒ†ã‚¹ãƒˆå®¹æ˜“æ€§ã®å‘ä¸Š

5. **propsã®ãƒã‚±ãƒ„ãƒªãƒ¬ãƒ¼ã‚’é¿ã‘ã‚‹**
   - 3éšå±¤ä»¥ä¸Šã®propsæ¸¡ã—ã¯Context APIã‚’æ¤œè¨
   - ã‚°ãƒ­ãƒ¼ãƒãƒ«Stateã¯Contextã«é›†ç´„

#### Componentåˆ†å‰²ã®åˆ¤æ–­åŸºæº–ï¼ˆThe 200-Line Ruleï¼‰

è¤‡é›‘åŒ–ã—ãŸComponentã‚’é©åˆ‡ãªã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§åˆ†å‰²ã™ã‚‹ã“ã¨ã§ã€ä¿å®ˆæ€§ã‚’ç¶­æŒã—ã¾ã™ã€‚

**åˆ†å‰²ã™ã¹ãã‚¿ã‚¤ãƒŸãƒ³ã‚°:**

1. **200è¡Œã‚’è¶…ãˆãŸ** â†’ Feature Component + Custom Hook ã«åˆ†å‰²
2. **useState ãŒ5å€‹ä»¥ä¸Š** â†’ Custom Hook ã«æŠ½å‡º
3. **åŒã˜ãƒ­ã‚¸ãƒƒã‚¯ã‚’2ç®‡æ‰€ã§ä½¿ã£ãŸ** â†’ Custom HookåŒ–
4. **ãƒãƒ³ãƒ‰ãƒ©ãƒ¼é–¢æ•°ãŒ50è¡Œè¶…ãˆ** â†’ Serviceå±¤ ã¾ãŸã¯ Custom Hook ã¸

**åˆ†å‰²ä¸è¦ãªã‚±ãƒ¼ã‚¹:**
- åˆå›å®Ÿè£…æ™‚ï¼ˆã¾ãšå‹•ã‹ã™ã€å¾Œã§ãƒªãƒ•ã‚¡ã‚¯ã‚¿ï¼‰
- 100è¡Œä»¥ä¸‹ã®ã‚·ãƒ³ãƒ—ãƒ«ãªComponent
- 1å›ã—ã‹ä½¿ã‚ãªã„ãƒ­ã‚¸ãƒƒã‚¯

**ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ä¾‹:**

```jsx
// âŒ æ‚ªã„ä¾‹: 300è¡Œã®Componentã€useState x8ã€è¤‡é›‘ãªãƒãƒ³ãƒ‰ãƒ©ãƒ¼
function HeavyComponent() {
  const [state1, setState1] = useState()
  const [state2, setState2] = useState()
  // ... 8å€‹ã®state

  const handleComplexLogic = () => {
    // 50è¡Œã®å‡¦ç†...
  }

  return (/* 200è¡Œã®JSX */)
}

// âœ… è‰¯ã„ä¾‹: Custom Hookã«åˆ†å‰²
function useComplexLogic() {
  const [state1, setState1] = useState()
  const [state2, setState2] = useState()
  // ...

  const handleComplexLogic = () => {
    // 50è¡Œã®å‡¦ç†...
  }

  return { state1, state2, handleComplexLogic }
}

function CleanComponent() {
  const logic = useComplexLogic()

  return (/* 50è¡Œã®ã‚·ãƒ³ãƒ—ãƒ«ãªJSX */)
}
```

**ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹:**

1. **lib/supabase.js ã¯è‚¥å¤§åŒ–ã•ã›ãªã„**
   - ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆåˆæœŸåŒ–ã®ã¿ã«å°‚å¿µ
   - ãƒ†ãƒ¼ãƒ–ãƒ«æ“ä½œã¯ Repository ã¸
   - Edge Functions å‘¼ã³å‡ºã—ã¯ Service ã¸

2. **Model ã¯å¸¸ã«ä½¿ã†**
   - DBãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’ç›´æ¥ä½¿ã‚ãšã€å¿…ãš Model çµŒç”±ã§å¤‰æ›
   - `fromDatabase()` ã¨ `toDatabase()` ã‚’å¿…ãšå®Ÿè£…

3. **Repository ã¯ãƒ†ãƒ¼ãƒ–ãƒ«å˜ä½**
   - 1ãƒ†ãƒ¼ãƒ–ãƒ« = 1Repository
   - ä¾‹: `profiles` ãƒ†ãƒ¼ãƒ–ãƒ« â†’ `UserProfileRepository`

4. **Service ã¯æ©Ÿèƒ½å˜ä½**
   - Edge Functions ã®ãƒ©ãƒƒãƒ‘ãƒ¼
   - å¤–éƒ¨APIé€£æº

### 4.2. TypeScript

Akatsukiã¯TypeScriptã‚’æ¡ç”¨ã—ã¦ã„ã¾ã™ã€‚ä¸€éƒ¨æ—¢å­˜ã®JSXãƒ•ã‚¡ã‚¤ãƒ«ã‚‚å®Ÿè¡Œå¯èƒ½ã«ãªã£ã¦ã„ã¾ã™ã€‚

- ğŸ”„ æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«ã¯å…¨ã¦ `.tsx` / `.ts` ã§ä½œæˆ

#### å‹å®šç¾©ã®ä½¿ã„æ–¹

- å‹å®šç¾©ã¯typesã«ã¾ã¨ã‚ã¦å®šç¾©ã—ã¦ã„ã¾ã™ã€‚`src/types/index.ts`
- ä»¥ä¸‹ã®ä¾‹ã®ã‚ˆã†ã«ä½¿ç”¨å¯èƒ½ã§ã™ã€‚

**ä¾‹ï¼š Edge Functionå‘¼ã³å‡ºã—:**
```typescript
import type { EdgeFunctionResponse, AIChatResponse } from '@/types'

const { data, error }: EdgeFunctionResponse<AIChatResponse> =
  await EdgeFunctionService.invoke('ai-chat', { message: 'Hello' })

if (error) {
  console.error(error.message)  // TypeScriptãŒå‹ãƒã‚§ãƒƒã‚¯
  return
}

#### ä¸»ãªå‹å®šç¾©ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
* EdgeFunction é–¢é€£
* Async Job é–¢é€£

#### å‚è€ƒè³‡æ–™

- å‹å®šç¾©ä¸€è¦§: `src/types/index.ts`
- ä½¿ç”¨ä¾‹ã¨ã‚¬ã‚¤ãƒ‰: `src/types/README.md`
- ãƒ†ã‚¹ãƒˆã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ: `/type-test` (é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ã§ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½)

### 4.3. èªè¨¼ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ (Authentication)

Akatsuki ã§ã¯ã€Supabase Auth ã‚’ä½¿ç”¨ã—ãŸå…¬é–‹/éå…¬é–‹ãƒšãƒ¼ã‚¸æ··åœ¨å‹ã®èªè¨¼ã‚·ã‚¹ãƒ†ãƒ ã‚’æ¨™æº–å®Ÿè£…ã—ã¦ã„ã¾ã™ã€‚

#### èªè¨¼ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆ

```
src/
â”œâ”€â”€ contexts/
â”‚   â””â”€â”€ AuthContext.jsx       # èªè¨¼çŠ¶æ…‹ç®¡ç†ï¼ˆContext APIï¼‰
â”œâ”€â”€ components/
â”‚   â””â”€â”€ auth/
â”‚       â”œâ”€â”€ AuthGuard.jsx     # Private ãƒ«ãƒ¼ãƒˆä¿è­·ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚       â”œâ”€â”€ LoginForm.jsx     # ãƒ­ã‚°ã‚¤ãƒ³ãƒ•ã‚©ãƒ¼ãƒ 
â”‚       â””â”€â”€ SignupForm.jsx    # ã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—ãƒ•ã‚©ãƒ¼ãƒ 
â”œâ”€â”€ pages/
â”‚   â”œâ”€â”€ LoginPage.jsx         # ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸
â”‚   â”œâ”€â”€ SignupPage.jsx        # ã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—ãƒšãƒ¼ã‚¸
â”‚   â”œâ”€â”€ AdminDashboard.jsx    # ç®¡ç†ç”»é¢ï¼ˆPrivateï¼‰
â”‚   â””â”€â”€ HomePage.jsx          # å…¬é–‹ãƒšãƒ¼ã‚¸ï¼ˆPublicï¼‰
â””â”€â”€ App.jsx                   # ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°è¨­å®š
```

#### ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒ‘ã‚¿ãƒ¼ãƒ³

**Layout.tsx ã‚’ä½¿ã£ãŸéšå±¤åŒ–ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°:**

Akatsukiã§ã¯ã€`Layout.tsx` ã«ã‚ˆã‚Šå…¨ãƒšãƒ¼ã‚¸å…±é€šã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼ˆTopNavigationã€èƒŒæ™¯ã€ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ï¼‰ã‚’è‡ªå‹•æä¾›ã—ã¾ã™ã€‚

```javascript
// App.jsx
import { Layout } from './components/layout/Layout'
import { PrivateLayout } from './components/layout/PrivateLayout'

<BrowserRouter>
  <AuthProvider>
    <Routes>
      {/* Public Routes - Layout ã§è‡ªå‹•çš„ã«ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒ»èƒŒæ™¯ãŒæä¾›ã•ã‚Œã‚‹ */}
      <Route element={<Layout />}>
        <Route path="/" element={<HomePage />} />
        <Route path="/login" element={<LoginPage />} />
        <Route path="/signup" element={<SignupPage />} />
      </Route>

      {/* Private Routes - PrivateLayout ã§èªè¨¼ãƒã‚§ãƒƒã‚¯ + Layout */}
      <Route element={<PrivateLayout />}>
        <Route path="/admin" element={<AdminDashboard />} />
        <Route path="/character-generator" element={<CharacterGeneratorPage />} />
      </Route>
    </Routes>
  </AuthProvider>
</BrowserRouter>
```

**Layoutãƒãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³:**
```javascript
// Layout.tsx - ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼ˆmax-w-7xlï¼‰
<Route element={<Layout />}>
  <Route path="/dashboard" element={<DashboardPage />} />
</Route>

// NarrowLayout - ç‹­ã„ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ç”¨ï¼ˆmax-w-4xlï¼‰
<Route element={<NarrowLayout />}>
  <Route path="/article" element={<ArticlePage />} />
</Route>

// FullWidthLayout - å…¨å¹…ï¼ˆw-fullï¼‰
<Route element={<FullWidthLayout />}>
  <Route path="/canvas" element={<CanvasPage />} />
</Route>
```

**PrivateLayout ã®ä»•çµ„ã¿:**
```javascript
// PrivateLayout.tsx
export function PrivateLayout() {
  return (
    <AuthGuard>  {/* èªè¨¼ãƒã‚§ãƒƒã‚¯ */}
      <Layout />   {/* èªè¨¼OKãªã‚‰é€šå¸¸Layout */}
    </AuthGuard>
  )
}
```

#### èªè¨¼æ©Ÿèƒ½

**AuthContext ãŒæä¾›ã™ã‚‹æ©Ÿèƒ½:**
- `user` - ç¾åœ¨ã®ãƒ­ã‚°ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±
- `session` - Supabase ã‚»ãƒƒã‚·ãƒ§ãƒ³æƒ…å ±
- `loading` - èªè¨¼çŠ¶æ…‹ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°
- `signUp(email, password, metadata)` - Email/Password ã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—
- `signIn(email, password)` - Email/Password ãƒ­ã‚°ã‚¤ãƒ³
- `signInWithMagicLink(email)` - Magic Link ãƒ­ã‚°ã‚¤ãƒ³
- `signInWithOAuth(provider)` - OAuth ãƒ­ã‚°ã‚¤ãƒ³ï¼ˆGoogle, GitHub ç­‰ï¼‰
- `signOut()` - ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
- `resetPassword(email)` - ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆãƒ¡ãƒ¼ãƒ«é€ä¿¡
- `updatePassword(newPassword)` - ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰æ›´æ–°

**OAuth ãƒ­ã‚°ã‚¤ãƒ³:**
```javascript
// LoginForm.jsx ã«å®Ÿè£…æ¸ˆã¿
<Button onClick={() => signInWithOAuth('google')}>
  Google ã§ãƒ­ã‚°ã‚¤ãƒ³
</Button>
<Button onClick={() => signInWithOAuth('github')}>
  GitHub ã§ãƒ­ã‚°ã‚¤ãƒ³
</Button>
```

**ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã‚‹ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼:**
- Google, GitHub, GitLab, Bitbucket
- Azure, Facebook, Twitter, Discord
- Slack, Apple ãªã©

**OAuth è¨­å®šï¼ˆSupabase Dashboardï¼‰:**
1. Authentication â†’ Providers
2. ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã‚’æœ‰åŠ¹åŒ–
3. Client ID / Client Secret ã‚’è¨­å®š

**ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆãƒ•ãƒ­ãƒ¼:**
1. `/forgot-password` - ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹å…¥åŠ› â†’ ãƒªã‚»ãƒƒãƒˆãƒ¡ãƒ¼ãƒ«é€ä¿¡
2. `/reset-password` - æ–°ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å…¥åŠ›ï¼ˆãƒ¡ãƒ¼ãƒ«ã®ãƒªãƒ³ã‚¯ã‹ã‚‰ï¼‰

**ä½¿ç”¨ä¾‹:**
```javascript
import { useAuth } from '../contexts/AuthContext'

function MyComponent() {
  const { user, signIn, signOut } = useAuth()

  const handleLogin = async () => {
    const { error } = await signIn(email, password)
    if (error) console.error(error)
  }

  return (
    <div>
      {user ? (
        <button onClick={signOut}>ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
      ) : (
        <button onClick={handleLogin}>ãƒ­ã‚°ã‚¤ãƒ³</button>
      )}
    </div>
  )
}
```

#### AuthGuard ã®å‹•ä½œ

1. **ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ä¸­**: ã‚¹ãƒ”ãƒŠãƒ¼ã‚’è¡¨ç¤ºï¼ˆãƒ•ãƒ©ãƒƒã‚·ãƒ¥é˜²æ­¢ï¼‰
2. **æœªãƒ­ã‚°ã‚¤ãƒ³**: `/login` ã¸ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
3. **ãƒ­ã‚°ã‚¤ãƒ³æ¸ˆã¿**: å­ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’è¡¨ç¤º

```javascript
// ä½¿ç”¨ä¾‹
<Route
  path="/admin/*"
  element={
    <AuthGuard>
      <AdminLayout />
    </AuthGuard>
  }
/>
```

#### ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

1. **AuthProvider ã¯ App ã®æœ€ä¸Šä½ã«é…ç½®**
   ```javascript
   <BrowserRouter>
     <AuthProvider>
       <Routes>...</Routes>
     </AuthProvider>
   </BrowserRouter>
   ```

2. **Public/Private ã‚’æ˜ç¢ºã«åˆ†é›¢**
   - Public: /, /login, /signup, /about ãªã©
   - Private: /admin/*, /dashboard/*, /settings/* ãªã©

3. **ãƒ­ã‚°ã‚¤ãƒ³å¾Œã®ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ**
   ```javascript
   const { signIn } = useAuth()
   const navigate = useNavigate()

   const handleLogin = async () => {
     const { error } = await signIn(email, password)
     if (!error) navigate('/admin')
   }
   ```

4. **RLSï¼ˆRow Level Securityï¼‰ã¨é€£æº**
   - Supabase ã® RLS ãŒæœ‰åŠ¹ãªå ´åˆã€èªè¨¼æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã¿ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½
   - Repository ã§ã® CRUD æ“ä½œã¯è‡ªå‹•çš„ã«èªè¨¼çŠ¶æ…‹ã‚’ä½¿ç”¨

5. **Profile è‡ªå‹•ä½œæˆï¼ˆDatabase Triggerï¼‰**
   - ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²æ™‚ã«è‡ªå‹•çš„ã« `profiles` ãƒ¬ã‚³ãƒ¼ãƒ‰ãŒä½œæˆã•ã‚Œã‚‹
   - `auth.users` ã¸ã® INSERT å¾Œã€Trigger ãŒç™ºç«
   - metadata ã‹ã‚‰ `username`, `display_name` ã‚’å–å¾—ï¼ˆæœªæŒ‡å®šæ™‚ã¯ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã®ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ä½¿ç”¨ï¼‰
   - username ã®é‡è¤‡æ™‚ã¯è‡ªå‹•çš„ã« user_id ã‚’ä»˜ä¸ã—ã¦ä¸€æ„æ€§ã‚’ç¢ºä¿

   **Trigger ã®ä»•çµ„ã¿:**
   1. SignupForm ã§ metadata ã« `username`, `display_name` ã‚’æŒ‡å®š
   2. `auth.users` ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆ
   3. Trigger ç™ºç« (`handle_new_user()`)
   4. `profiles` ãƒ†ãƒ¼ãƒ–ãƒ«ã«è‡ªå‹•ä½œæˆï¼ˆusername é‡è¤‡æ™‚ã¯ user_id ã‚’ä»˜ä¸ï¼‰

   **ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³:** `20251029090845_add_profile_creation_trigger.sql`

6. **ãƒ­ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ï¼ˆRole-Based Access Controlï¼‰**
   - profiles ãƒ†ãƒ¼ãƒ–ãƒ«ã« role ã‚«ãƒ©ãƒ ã‚’è¿½åŠ 
   - ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ­ãƒ¼ãƒ«: `user`
   - åˆ©ç”¨å¯èƒ½ãªãƒ­ãƒ¼ãƒ«: `user`, `admin`, `moderator`

   **AuthContext ã§ãƒ­ãƒ¼ãƒ«åˆ¤å®š:**
   ```javascript
   const { profile, isAdmin, isModerator } = useAuth()

   // ç®¡ç†è€…ã®ã¿ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½
   if (isAdmin) {
     // ç®¡ç†è€…æ©Ÿèƒ½
   }

   // ãƒ¢ãƒ‡ãƒ¬ãƒ¼ã‚¿ãƒ¼ä»¥ä¸Šã§ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½
   if (isModerator) {
     // ãƒ¢ãƒ‡ãƒ¬ãƒ¼ã‚¿ãƒ¼æ©Ÿèƒ½
   }

   // ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‹ã‚‰ç›´æ¥åˆ¤å®š
   if (profile?.isAdmin()) {
     // ç®¡ç†è€…æ©Ÿèƒ½
   }
   ```

   **ãƒ­ãƒ¼ãƒ«è¨­å®šï¼ˆã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—æ™‚ï¼‰:**
   ```javascript
   // metadata ã§ role ã‚’æŒ‡å®š
   signUp(email, password, {
     username: 'admin_user',
     display_name: 'Admin User',
     role: 'admin'  // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ 'user'
   })
   ```

   **ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³:**
   - `20251029093327_add_role_to_profiles.sql`
   - CHECK åˆ¶ç´„ã§ 'user', 'admin', 'moderator' ã®ã¿è¨±å¯
   - Trigger ãŒè‡ªå‹•çš„ã« metadata ã‹ã‚‰ role ã‚’å–å¾—

## 5. ä¸»è¦æ©Ÿèƒ½ (Key Features)

ã“ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¯ã€AIé–‹ç™ºã‚’åŠ é€Ÿã™ã‚‹ãŸã‚ã®åŸºç›¤ã‚’æ¨™æº–æ­è¼‰ã—ã¦ã„ã¾ã™ã€‚

### 5.1. AIGen (AI Generation) çµ±åˆåŸºç›¤

Akatsuki ã§ã¯ã€è¤‡æ•°ã®AIãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ï¼ˆOpenAI, Anthropic, Geminiï¼‰ã‚’çµ±ä¸€çš„ã«æ‰±ãˆã‚‹åŸºç›¤ã‚’æ¨™æº–æ­è¼‰ã—ã¦ã„ã¾ã™ã€‚

#### Frontendå®Ÿè£…ï¼ˆå®Ÿè£…æ¸ˆã¿ï¼‰

**useAIGen ãƒ•ãƒƒã‚¯ï¼ˆæ±ç”¨AIæ“ä½œï¼‰:**
```javascript
import { useAIGen } from '@/hooks/useAIGen'

function MyComponent() {
  const { chat, generateImage, loading, error } = useAIGen('openai')

  // ãƒãƒ£ãƒƒãƒˆ
  const response = await chat('ã“ã‚“ã«ã¡ã¯')

  // ç”»åƒç”Ÿæˆï¼ˆæ±ç”¨ï¼‰
  const image = await generateImage('çŒ«ã®çµµ')
}
```

**useImageGeneration ãƒ•ãƒƒã‚¯ï¼ˆç”»åƒç”Ÿæˆç‰¹åŒ–ï¼‰:**

**3ã¤ã®ãƒ¢ãƒ¼ãƒ‰ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ„å›³ã‚’è¡¨ç¾ã€ã‚¤ãƒ³ãƒ•ãƒ©éä¾å­˜ï¼‰:**

| Mode | èª¬æ˜ | ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | ã‚µãƒãƒ¼ãƒˆProvider |
|------|------|------------|------------------|
| **text-to-image** | ãƒ†ã‚­ã‚¹ãƒˆã‹ã‚‰ç”»åƒç”Ÿæˆ | prompt: å¿…é ˆ | DALL-E 3, DALL-E 2, Gemini |
| **variation** | æ—¢å­˜ç”»åƒã®è‡ªå‹•ãƒãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³ | prompt: ä¸è¦<br>image_url: å¿…é ˆ | DALL-E 2, Gemini |
| **edit** | ç”»åƒã‚’ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã§ç·¨é›† | prompt: å¿…é ˆ<br>image_url: å¿…é ˆ | Gemini ã®ã¿ |

**é‡è¦ãªè¨­è¨ˆæ€æƒ³:**
- âœ… **Mode = ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ„å›³**ï¼ˆã‚¤ãƒ³ãƒ•ãƒ©çŸ¥è­˜ã‚’æ¼æ´©ã•ã›ãªã„ï¼‰
- âœ… **Provider/Model = ã‚ªãƒ—ã‚·ãƒ§ãƒ³**ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã§å‹•ä½œã€ç‰¹å®šProviderä½¿ç”¨æ™‚ã®ã¿æŒ‡å®šï¼‰
- âœ… **Storage è‡ªå‹•ä¿å­˜** - Public/Private ã‚’é¸æŠå¯èƒ½ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: publicï¼‰
- âš ï¸ **DALL-E 3 éã‚µãƒãƒ¼ãƒˆæ©Ÿèƒ½**: variation, editï¼ˆDALL-E 2ã‚’è‡ªå‹•é¸æŠï¼‰
- âš ï¸ **Gemini éã‚µãƒãƒ¼ãƒˆæ©Ÿèƒ½**: ãªã—ï¼ˆå…¨ãƒ¢ãƒ¼ãƒ‰å¯¾å¿œï¼‰

```javascript
import { useImageGeneration } from '@/hooks/useImageGeneration'

function MyComponent() {
  const {
    generate,
    generateVariation,
    generateEdit,
    loading,
    error,
    result,
  } = useImageGeneration()

  // 1. Text-to-Imageï¼ˆé€šå¸¸ç”Ÿæˆï¼‰
  const handleTextToImage = async () => {
    const image = await generate({
      prompt: 'å¯æ„›ã„çŒ«ãŒæ¯›ç³¸ã§éŠã‚“ã§ã„ã‚‹',
      // provider: 'dalle' (ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§å‹•ä½œ)
      quality: 'hd',
      size: '1024x1024',
      style: 'vivid',
      storage: 'public',  // ã¾ãŸã¯ 'private'
    })
    console.log(image.publicUrl) // æ’ä¹…çš„ãªå…¬é–‹URL
  }

  // 2. Variationï¼ˆè‡ªå‹•ãƒãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³ç”Ÿæˆã€ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆä¸è¦ï¼‰
  const handleVariation = async (existingImageUrl) => {
    const variation = await generateVariation(existingImageUrl, {
      // provider: 'dalle' (ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§å‹•ä½œ)
    })
  }

  // 3. Editï¼ˆç”»åƒã‚’ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã§ç·¨é›†ã€Gemini ã®ã¿ï¼‰
  const handleEdit = async (imageUrl) => {
    const edited = await generateEdit(
      imageUrl,
      'Add a wizard hat to the cat',  // ç·¨é›†æŒ‡ç¤º
      {
        // provider: 'gemini' (è‡ªå‹•çš„ã« Gemini ã‚’ä½¿ç”¨)
      }
    )
  }

  return (
    <div>
      <button onClick={handleTextToImage} disabled={loading}>
        ç”»åƒç”Ÿæˆ
      </button>
      {result && <img src={result.publicUrl} alt="Generated" />}
    </div>
  )
}
```

**Provideråˆ¥æ©Ÿèƒ½å¯¾å¿œè¡¨ï¼ˆå‚è€ƒæƒ…å ±ï¼‰:**
| æ©Ÿèƒ½ | DALL-E 3 | DALL-E 2 | Gemini 2.5 Flash |
|------|----------|----------|------------------|
| Text-to-Image | âœ… HD/Vivid | âœ… Standard | âœ… |
| Variation | âŒ | âœ… | âœ… |
| Edit | âŒ | âŒ | âœ… |
| ã‚µã‚¤ã‚º | 1024Â² / 1792Ã—1024 / 1024Ã—1792 | 1024Â² / 512Â² / 256Â² | Gemini ä¾å­˜ |

æ³¨: Provider ã®åˆ¶ç´„ã¯ Hook/Service ãŒè‡ªå‹•çš„ã«å¸åã—ã¾ã™ã€‚Mode ã¨ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®ã¿ã‚’æ„è­˜ã—ã¦ãã ã•ã„ã€‚

**ModelSelector ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ:**
```javascript
import { ModelSelector } from '@/components/ai/ModelSelector'

function MyComponent() {
  const [modelId, setModelId] = useState(null)

  return (
    <ModelSelector
      value={modelId}
      onChange={setModelId}
      // Visionå¯¾å¿œãƒ¢ãƒ‡ãƒ«ã®ã¿è¡¨ç¤º
      filters={{ supportsImageInput: true }}
    />
  )
}
```

**å®Ÿè£…æ¸ˆã¿æ©Ÿèƒ½:**
- `useAIGen` - ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼åˆ‡ã‚Šæ›¿ãˆå¯èƒ½ãªAIãƒ•ãƒƒã‚¯
  - `chat()` - ãƒãƒ£ãƒƒãƒˆè£œå®Œ
  - `chatStream()` - ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ãƒãƒ£ãƒƒãƒˆ
  - `generateImage()` - ç”»åƒç”Ÿæˆ
  - `editImage()` - ç”»åƒç·¨é›†
  - `embed()` - åŸ‹ã‚è¾¼ã¿ç”Ÿæˆ
- `AIService` - ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼çµ±åˆå±¤ï¼ˆOpenAI, Anthropic, Geminiå¯¾å¿œï¼‰
- `AIModel` - ãƒ¢ãƒ‡ãƒ«å®šç¾©ï¼ˆDBç®¡ç†ï¼‰
- `AIModelRepository` - ãƒ¢ãƒ‡ãƒ«æƒ…å ±å–å¾—ï¼ˆSupabaseï¼‰
- `ModelSelector` - UIãƒ¢ãƒ‡ãƒ«é¸æŠã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆshadcn/uiï¼‰

**Supabase Edge Functions:**
- `ai-chat` - AIãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼çµ±ä¸€ãƒãƒ£ãƒƒãƒˆã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆï¼ˆãƒãƒ«ãƒãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼å¯¾å¿œã€ã‚¯ã‚©ãƒ¼ã‚¿ç®¡ç†ï¼‰
- `generate-image` - AIç”»åƒç”Ÿæˆã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆï¼ˆDALL-E, Geminiå¯¾å¿œï¼‰

#### Akatsukiçµ±ä¸€ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ãƒ‘ã‚¿ãƒ¼ãƒ³

Supabase Edge Functions ã§å…±é€šçš„ã«ä½¿ç”¨ã™ã‚‹çµ±ä¸€ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã‚’æä¾›ã—ã¦ã„ã¾ã™ã€‚

**å®Ÿè£…å ´æ‰€:**
- `supabase/functions/_shared/handler.ts` - çµ±ä¸€ãƒãƒ³ãƒ‰ãƒ©ãƒ¼æœ¬ä½“
- `supabase/functions/_shared/api_types.ts` - ãƒ¬ã‚¹ãƒãƒ³ã‚¹å‹å®šç¾©
- `supabase/functions/_shared/repository.ts` - BaseRepository
- `supabase/functions/_shared/repositories/` - Repositoryå®Ÿè£…

**2ç¨®é¡ã®ãƒãƒ³ãƒ‰ãƒ©ãƒ¼:**

1. **`createAkatsukiHandler`** - ãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘APIï¼ˆèªè¨¼å¿…é ˆï¼‰
   ```typescript
   import { createAkatsukiHandler } from '../_shared/handler.ts'

   Deno.serve(async (req) => {
     return createAkatsukiHandler<Input, Output>(req, {
       inputSchema: InputSchema,  // Zodã‚¹ã‚­ãƒ¼ãƒ
       requireAuth: true,

       logic: async ({ input, userClient, adminClient, repos }) => {
         // userClient: RLSæœ‰åŠ¹ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼è‡ªèº«ã®ãƒ‡ãƒ¼ã‚¿ã®ã¿ï¼‰
         const { data: { user } } = await userClient.auth.getUser()

         // adminClientçµŒç”±ã®Repos: RLSãƒã‚¤ãƒ‘ã‚¹ï¼ˆUsageç­‰ã®æ”¹ã–ã‚“é˜²æ­¢ï¼‰
         await repos.userQuota.incrementUsage(quotaId)

         return { message: 'Success' }
       }
     })
   })
   ```

2. **`createSystemHandler`** - ã‚·ã‚¹ãƒ†ãƒ å†…éƒ¨APIï¼ˆWebhookç­‰ã€èªè¨¼ä¸è¦ï¼‰
   ```typescript
   import { createSystemHandler } from '../_shared/handler.ts'

   Deno.serve(async (req) => {
     return createSystemHandler<Input, Output>(req, {
       inputSchema: InputSchema,

       logic: async ({ input, adminClient, repos }) => {
         // adminClient: RLSãƒã‚¤ãƒ‘ã‚¹ï¼ˆå…¨ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ï¼‰
         await repos.userQuota.create({ ... })

         return { received: true }
       }
     })
   })
   ```

**è¨­è¨ˆã®æ„å›³:**
- **èªè¨¼**: ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ãƒ¬ãƒ™ãƒ«ã§è‡ªå‹•ãƒã‚§ãƒƒã‚¯
- **ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆåˆ†é›¢**:
  - `userClient` (RLSæœ‰åŠ¹) - ãƒ¦ãƒ¼ã‚¶ãƒ¼è‡ªèº«ã®ãƒ‡ãƒ¼ã‚¿ã®ã¿æ“ä½œ
  - `adminClient` (RLSãƒã‚¤ãƒ‘ã‚¹) - Usageç­‰ã®æ”¹ã–ã‚“é˜²æ­¢
- **çµ±ä¸€ãƒ¬ã‚¹ãƒãƒ³ã‚¹**: `AkatsukiResponse<T>` å½¢å¼ã§çµ±ä¸€
- **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**: çµ±ä¸€ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã§è‡ªå‹•å‡¦ç†ï¼ˆCORSã€ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ç­‰ï¼‰

**åˆ©ç”¨ä¾‹:**
- `supabase/functions/ai-chat/index.ts` - LLM APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
- `supabase/functions/generate-image/index.ts` - ç”»åƒç”Ÿæˆã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

#### Backendå®Ÿè£…ï¼ˆAxumï¼‰

**ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆé››å½¢:**
  - `packages/app-backend/src/main.rs` ã«ä»¥ä¸‹ã®3ã¤ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆé››å½¢ã‚’å®Ÿè£…æ¸ˆã¿ï¼š
    1. **ç”»åƒç”Ÿæˆ (Text-to-Image):** `/api/aigen/text-to-image`
    2. **Img2Img (Image-to-Image):** `/api/aigen/image-to-image`
    3. **Agentå®Ÿè¡Œ (LLMã‚¿ã‚¹ã‚¯):** `/api/aigen/agent-execute`
  - Supabase (PostgreSQL) é€£æºåŸºç›¤ï¼ˆ`src/db.rs`ï¼‰

### 5.2. Webæ¤œç´¢çµ±åˆ (Web Search Integration)

Akatsuki ã§ã¯ã€AIçµ±åˆå‹Webæ¤œç´¢æ©Ÿèƒ½ã‚’æ¨™æº–æ­è¼‰ã—ã¦ã„ã¾ã™ã€‚2ã¤ã®ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã‹ã‚‰é¸æŠå¯èƒ½ã§ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ã‚³ã‚¹ãƒ‘æœ€é«˜ã®Gemini Googleæ¤œç´¢ã§ã™ã€‚

#### å¯¾å¿œãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼

| Provider | ç‰¹å¾´ | æ–™é‡‘ | ãŠã™ã™ã‚ç”¨é€” |
|----------|------|------|-------------|
| **Gemini Googleæ¤œç´¢** (ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ) | Googleæ¤œç´¢çµ±åˆã€è‡ªå‹•åˆ¤æ–­ã€å¼•ç”¨æƒ…å ± | Geminiæ–™é‡‘ã®ã¿ï¼ˆæ¤œç´¢è¿½åŠ æ–™é‡‘ãªã—ï¼‰ | æ±ç”¨Webæ¤œç´¢ã€æœ€æ–°æƒ…å ±å–å¾— |
| **Tavily AI Search** | AIç‰¹åŒ–ã€æ§‹é€ åŒ–ãƒ‡ãƒ¼ã‚¿ | $5/æœˆï¼ˆ1000reqï¼‰ | å°‚é–€çš„ãªæ¤œç´¢ã€è¤‡æ•°LLMåˆ©ç”¨æ™‚ |

**æ¨å¥¨**: Geminiåˆ©ç”¨æ™‚ã¯Googleæ¤œç´¢ãŒåœ§å€’çš„ã«ã‚³ã‚¹ãƒ‘è‰¯ã„ï¼ˆè¿½åŠ æ–™é‡‘ãªã—ï¼‰

#### Frontendå®Ÿè£…

**WebSearchServiceï¼ˆåŸºæœ¬ï¼‰:**
```javascript
import { WebSearchService } from '@/services/WebSearchService'

// Gemini Googleæ¤œç´¢ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰
const { data, error } = await WebSearchService.search('AIã‚¢ãƒ¼ãƒˆ æœ€æ–°å‹•å‘')
console.log(data.answer)        // AIã®å›ç­”
console.log(data.results)       // å¼•ç”¨å…ƒURL
console.log(data.searchQueries) // å®Ÿè¡Œã•ã‚ŒãŸæ¤œç´¢ã‚¯ã‚¨ãƒª

// Tavily AI Searchï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
const { data, error } = await WebSearchService.search('React hooks', {
  provider: 'tavily',
  numResults: 5
})
console.log(data.answer)   // Tavilyã®è¦ç´„
console.log(data.results)  // æ¤œç´¢çµæœé…åˆ—
```

**useWebSearch ãƒ•ãƒƒã‚¯ï¼ˆReact Queryï¼‰:**
```javascript
import { useWebSearch } from '@/hooks/useWebSearch'

function MyComponent() {
  const { searchAsync, isPending, data } = useWebSearch()

  const handleSearch = async () => {
    const result = await searchAsync({
      query: '2024å¹´ã®AIç”»åƒç”Ÿæˆã®æœ€æ–°å‹•å‘ã‚’æ•™ãˆã¦',
      provider: 'gemini',  // ã¾ãŸã¯ 'tavily'
      numResults: 10
    })
    console.log(result.answer)        // AIã®å›ç­”
    console.log(result.sources)       // æƒ…å ±æº
    console.log(result.searchQueries) // æ¤œç´¢ã‚¯ã‚¨ãƒªï¼ˆGeminiã®ã¿ï¼‰
  }

  return (
    <div>
      <button onClick={handleSearch} disabled={isPending}>
        Search
      </button>
      {data && (
        <div>
          <p>{data.answer}</p>
          {data.results.map((r, i) => (
            <a key={i} href={r.url}>{r.title}</a>
          ))}
        </div>
      )}
    </div>
  )
}
```

**WebSearchCard ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆå®Ÿè£…æ¸ˆã¿ï¼‰:**
```javascript
import { WebSearchCard } from '@/components/features/search/WebSearchCard'

function MyPage() {
  return <WebSearchCard />
  // ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼åˆ‡ã‚Šæ›¿ãˆUIä»˜ã
  // Gemini/Tavily ã‚’ã‚¿ãƒ–ã§é¸æŠå¯èƒ½
}
```

#### Supabase Edge Function

**å®Ÿè£…å ´æ‰€:**
- `supabase/functions/web-search/index.ts`

**ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿:**
```typescript
{
  query: string,              // æ¤œç´¢ã‚¯ã‚¨ãƒª
  num_results?: number,       // çµæœæ•°ï¼ˆ1-20ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 10ï¼‰
  provider?: 'gemini' | 'tavily'  // ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 'gemini'ï¼‰
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹:**
```typescript
{
  query: string,
  answer: string,             // AIç”Ÿæˆã®è¦ç´„/å›ç­”
  results: Array<{
    title: string,
    url: string,
    content: string,
    score?: number            // Tavilyã®ã¿
  }>,
  num_results: number,
  provider: 'gemini' | 'tavily',
  searchQueries?: string[]    // Geminiã®ã¿ï¼ˆå®Ÿè¡Œã•ã‚ŒãŸæ¤œç´¢ã‚¯ã‚¨ãƒªï¼‰
}
```

#### å®Ÿè£…æ¸ˆã¿æ©Ÿèƒ½

- `WebSearchService` - Webæ¤œç´¢çµ±ä¸€APIï¼ˆGemini/Tavilyå¯¾å¿œï¼‰
- `useWebSearch` - React Queryçµ±åˆãƒ•ãƒƒã‚¯
- `WebSearchCard` - ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼åˆ‡ã‚Šæ›¿ãˆUIä»˜ãã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
- `web-search` Edge Function - ãƒãƒ«ãƒãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼æ¤œç´¢ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

### 5.3. å¤–éƒ¨é€£æºçµ±åˆ (External Integrations)

Akatsuki ã§ã¯ã€ã‚ˆãä½¿ã†å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹é€£æºã®é››å½¢ã‚’æ¨™æº–æ­è¼‰ã—ã¦ã„ã¾ã™ã€‚

#### Slacké€šçŸ¥

**å®Ÿè£…å ´æ‰€:**
- `supabase/functions/slack-notify/index.ts`

**ç”¨é€”ä¾‹:**
- ã‚¨ãƒ©ãƒ¼é€šçŸ¥
- ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ©ãƒ¼ãƒˆ
- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°é€šçŸ¥
- ãƒ‡ãƒ—ãƒ­ã‚¤å®Œäº†é€šçŸ¥

**ä½¿ç”¨ä¾‹:**
```typescript
// å†…éƒ¨ã‚·ã‚¹ãƒ†ãƒ ã‹ã‚‰å‘¼ã³å‡ºã—ï¼ˆèªè¨¼ä¸è¦ï¼‰
await fetch('https://your-project.supabase.co/functions/v1/slack-notify', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    text: 'ãƒ‡ãƒ—ãƒ­ã‚¤ãŒå®Œäº†ã—ã¾ã—ãŸï¼',
    channel: '#notifications',
    attachments: [{
      color: 'good',
      title: 'Production Deploy',
      fields: [
        { title: 'Version', value: 'v1.2.3', short: true },
        { title: 'Status', value: 'âœ… Success', short: true },
      ]
    }]
  })
})
```

**ç’°å¢ƒå¤‰æ•°:**
- `SLACK_WEBHOOK_URL` - Slack Incoming Webhook URL

#### Emailé€ä¿¡

**å®Ÿè£…å ´æ‰€:**
- `supabase/functions/send-email/index.ts`

**ç”¨é€”ä¾‹:**
- ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆãƒ¡ãƒ¼ãƒ«
- ã‚¦ã‚§ãƒ«ã‚«ãƒ ãƒ¡ãƒ¼ãƒ«
- é€šçŸ¥ãƒ¡ãƒ¼ãƒ«
- ãƒ¬ãƒãƒ¼ãƒˆé€ä¿¡

**ä½¿ç”¨ä¾‹:**
```typescript
// å†…éƒ¨ã‚·ã‚¹ãƒ†ãƒ ã‹ã‚‰å‘¼ã³å‡ºã—ï¼ˆèªè¨¼ä¸è¦ï¼‰
await fetch('https://your-project.supabase.co/functions/v1/send-email', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    to: 'user@example.com',
    subject: 'Welcome to Akatsuki!',
    html: '<h1>Welcome!</h1><p>Thanks for signing up.</p>',
    metadata: {
      template: 'welcome',
      user_id: 'user-123'
    }
  })
})
```

**ç’°å¢ƒå¤‰æ•°:**
- `RESEND_API_KEY` - Resend API Key
- `EMAIL_FROM` - ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆé€ä¿¡å…ƒãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹

**ä½¿ç”¨ã‚µãƒ¼ãƒ“ã‚¹:**
- [Resend](https://resend.com/) - ã‚·ãƒ³ãƒ—ãƒ«ã§é–‹ç™ºè€…ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼ãªãƒ¡ãƒ¼ãƒ«é€ä¿¡ã‚µãƒ¼ãƒ“ã‚¹

#### æ‹¡å¼µæ–¹æ³•

æ–°ã—ã„å¤–éƒ¨é€£æºã‚’è¿½åŠ ã™ã‚‹å ´åˆ:
1. `supabase/functions/` ã«æ–°ã—ã„Functionä½œæˆï¼ˆä¾‹: `discord-notify`ï¼‰
2. `createSystemHandler` ã‚’ä½¿ç”¨ã—ã¦ãƒãƒ³ãƒ‰ãƒ©ãƒ¼å®Ÿè£…
3. ç’°å¢ƒå¤‰æ•°ã« Webhook URL ã‚„ API Key ã‚’è¨­å®š
4. ãƒ‡ãƒ—ãƒ­ã‚¤: `npm run supabase:function:deploy`

### 5.4. shadcn/ui ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ (å°†æ¥ã®æ‹¡å¼µ)

* `packages/ui-components/` ã« `shadcn/ui` ã®ä¸»è¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’å°å…¥äºˆå®š
* é–‹ç™ºè€…ã¯å³åº§ã«ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’åˆ©ç”¨ãƒ»ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºå¯èƒ½

## 6. é–‹ç™ºãƒ«ãƒ¼ãƒ« (Rules)

ã“ã“ãŒæœ€ã‚‚é‡è¦ã§ã™ã€‚ã€Œå®‰å®šæ€§ã€ã¨ã€Œã‚¹ãƒ”ãƒ¼ãƒ‰ã€ã‚’ç¶­æŒã™ã‚‹ãŸã‚ã€ä»¥ä¸‹ã®ãƒ«ãƒ¼ãƒ«ã‚’å¿…ãšéµå®ˆã—ã¦ãã ã•ã„ã€‚

### 6.1. ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ (Workflow)

#### DBé‹ç”¨ï¼ˆãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰
* **`Supabase-dev` ç’°å¢ƒã‚’å¿…ãšä½œæˆã—ã€ãƒãƒ¼ãƒ ã§å…±æœ‰ã—ã¾ã™ã€‚**
* **ãƒ­ãƒ¼ã‚«ãƒ«ã§ã®DBé–‹ç™ºã¯åŸå‰‡ç¦æ­¢**ã—ã€`Supabase-dev` ã¸ç›´æ¥å¤‰æ›´ã‚’åŠ ãˆã‚‹ãƒ•ãƒ­ãƒ¼ã‚’æ¡ç”¨ã—ã¾ã™ã€‚
* è©³ç´°ãªã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †ã¯ `README.md` ã®ã€Œ4. Supabase-dev ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã€ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

**ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æ‰‹é †:**
```bash
# 1. æ–°è¦ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ä½œæˆ
npm run supabase:migration:new create_users_table

# 2. supabase/migrations/ é…ä¸‹ã«SQLãƒ•ã‚¡ã‚¤ãƒ«ãŒç”Ÿæˆã•ã‚Œã‚‹

# 3. SQLã‚’è¨˜è¿°å¾Œã€Supabaseã«é©ç”¨
npm run supabase:push
```

#### Edge Functionsé‹ç”¨
* **Supabase Edge Functions** ã¯ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹é–¢æ•°ã¨ã—ã¦ã€APIå‡¦ç†ã‚„å¤–éƒ¨é€£æºã‚’å®Ÿè£…ã—ã¾ã™ã€‚
* Frontend ã® `services/` ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‹ã‚‰å‘¼ã³å‡ºã—ã¾ã™ã€‚

**Edge Functionsæ‰‹é †:**
```bash
# 1. æ–°è¦Functionä½œæˆ
npm run supabase:function:new my-function

# 2. supabase/functions/my-function/index.ts ã«ã‚³ãƒ¼ãƒ‰å®Ÿè£…

# 3. Supabaseã«ãƒ‡ãƒ—ãƒ­ã‚¤
npm run supabase:function:deploy my-function

# 4. ã™ã¹ã¦ã®Functionsã‚’ãƒ‡ãƒ—ãƒ­ã‚¤
npm run supabase:function:deploy
```

**Frontend ã‹ã‚‰ã®å‘¼ã³å‡ºã—:**
```javascript
// services/EdgeFunctionService.js ã«å€‹åˆ¥é–¢æ•°ã‚’è¿½åŠ 
export async function callMyFunction(payload) {
  return EdgeFunctionService.invoke('my-function', payload)
}

// ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‹ã‚‰ä½¿ç”¨
import { callMyFunction } from './services'
const result = await callMyFunction({ data: '...' })
```

#### é–‹ç™ºç”¨ãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ

å‹•ä½œç¢ºèªç”¨ã®ãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿ï¼ˆãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã€ç”»åƒã€æŠ•ç¨¿ç­‰ï¼‰ã¯ã€**`workspace/` ã«ä½¿ã„æ¨ã¦ã‚¹ã‚¯ãƒªãƒ—ãƒˆ**ã‚’ä½œæˆã—ã¦ç”Ÿæˆã—ã¾ã™ã€‚

**åŸºæœ¬æ–¹é‡:**
- Seed (seed.sql) = æœ¬å½“ã®åˆæœŸãƒ‡ãƒ¼ã‚¿ï¼ˆãƒã‚¹ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿ã€å›ºå®šãƒ‡ãƒ¼ã‚¿ï¼‰
- workspace/ ã‚¹ã‚¯ãƒªãƒ—ãƒˆ = é–‹ç™ºç”¨ã®ä¸€æ™‚çš„ãªãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿

**å®Ÿè£…ä¾‹:**

```javascript
// workspace/generate-dummy-data.js

// âš ï¸ Import Path ã®æ›¸ãæ–¹ï¼ˆç›¸å¯¾ãƒ‘ã‚¹ï¼‰
// workspace/ ã‹ã‚‰ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã¯ `../` ã§å‚ç…§
import { supabase } from '../packages/app-frontend/src/lib/supabase.js'
import { ImageGenerationService } from '../packages/app-frontend/src/services/ImageGenerationService.js'

async function generateDummyProfiles() {
  console.log('Generating dummy profiles with avatars...')

  for (let i = 0; i < 10; i++) {
    try {
      // 1. ç”»åƒç”Ÿæˆï¼ˆStorage + file_metadata ã«è‡ªå‹•ä¿å­˜ï¼‰
      const { data: avatar, error: genError } = await ImageGenerationService.generate({
        prompt: `Professional headshot of person ${i + 1}, studio lighting, neutral background`,
        quality: 'standard',
      })

      if (genError) {
        console.error(`âœ— Failed to generate avatar: ${genError.message}`)
        continue
      }

      console.log(`âœ“ Generated avatar: ${avatar.id}`)

      // 2. profiles ãƒ†ãƒ¼ãƒ–ãƒ«ã«ç›´æ¥INSERT
      const { data, error } = await supabase
        .from('profiles')
        .insert({
          user_id: `dummy-user-${i + 1}`,
          username: `dummy${i + 1}`,
          display_name: `Dummy User ${i + 1}`,
          avatar_file_id: avatar.id,  // â† file_metadata ã® id
          bio: `This is a dummy profile for testing.`,
        })
        .select()
        .single()

      if (error) throw error

      console.log(`âœ“ Created profile: dummy${i + 1}`)

    } catch (error) {
      console.error(`âœ— Failed to create dummy${i + 1}:`, error.message)
    }
  }

  console.log('\nâœ¨ Done! Created 10 dummy profiles.')
}

// å®Ÿè¡Œ
generateDummyProfiles()
```

**å®Ÿè¡Œæ–¹æ³•:**

```bash
# workspace/ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç§»å‹•
cd workspace

# ã‚¹ã‚¯ãƒªãƒ—ãƒˆå®Ÿè¡Œ
node generate-dummy-data.js
```

**ãƒã‚¤ãƒ³ãƒˆ:**
- **import path ã¯ç›¸å¯¾ãƒ‘ã‚¹** - `../packages/app-frontend/src/...`
- **ImageGenerationService ã‚’æ´»ç”¨** - Edge FunctionçµŒç”±ã§ç”»åƒç”Ÿæˆ
- **file_id ã‚’å–å¾—** - Storage + file_metadata ã«è‡ªå‹•ä¿å­˜ã•ã‚Œã‚‹
- **Supabase Client ã§ç›´æ¥INSERT** - æ—¢å­˜ã®Repositoryã‚’ä½¿ã‚ãšè‡ªç”±ã«
- **workspace/ ã¯ Gitç®¡ç†å¤–** - ä½¿ã„æ¨ã¦ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’è‡ªç”±ã«æ›¸ã‘ã‚‹

**å¿œç”¨ä¾‹:**
- ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ: `supabase.from('projects').insert({ ... })`
- æŠ•ç¨¿ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ: `supabase.from('posts').insert({ ... })`
- ç”»åƒç”Ÿæˆã¨ç´ä»˜ã‘: `ImageGenerationService.generate()` â†’ `file_id` å–å¾—

**å‰Šé™¤æ–¹æ³•:**
- `supabase.from('profiles').delete().like('user_id', 'dummy-user-%')`
- é–¢é€£ãƒ‡ãƒ¼ã‚¿ã‚‚åŒæ§˜ã«å‰Šé™¤

#### ãƒ­ãƒ¼ã‚«ãƒ«å°‚ç”¨é ˜åŸŸ (`workspace/`)
* ãƒ«ãƒ¼ãƒˆã® `workspace/` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¯ **`.gitignore` ã•ã‚Œã¦ã„ã¾ã™**ã€‚
* å€‹äººã®ãƒ¡ãƒ¢ã€ä¸‹æ›¸ãã€ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒå¤‰æ•°ï¼ˆ`.env`ï¼‰ãªã©ã€ãƒªãƒã‚¸ãƒˆãƒªã«ã‚³ãƒŸãƒƒãƒˆã—ã¦ã¯ã„ã‘ãªã„ãƒ•ã‚¡ã‚¤ãƒ«ç½®ãå ´ã¨ã—ã¦ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚
* ç”¨é€”ä¾‹ï¼š
  - å€‹äººçš„ãªå®Ÿé¨“ã‚³ãƒ¼ãƒ‰
  - å¤–éƒ¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®èª¿æŸ»ç”¨ã‚¯ãƒ­ãƒ¼ãƒ³ï¼ˆèª­ã‚€ã ã‘ï¼‰
  - ãƒãƒ¼ãƒ å¤–éƒ¨ã®æ©Ÿå¯†æƒ…å ±

### 6.2. ç’°å¢ƒå¤‰æ•°ç®¡ç†

ç’°å¢ƒå¤‰æ•°ã¯ä»¥ä¸‹ã®å ´æ‰€ã«é…ç½®ã—ã¾ã™ï¼š

| å¯¾è±¡ | é…ç½®å ´æ‰€ | Gitç®¡ç† | ã‚µãƒ³ãƒ—ãƒ« |
| :--- | :--- | :--- | :--- |
| **Frontend** | `packages/app-frontend/.env` | âŒ Ignore | `.env.example` ã‚ã‚Š |
| **Backend** | `packages/app-backend/.env` | âŒ Ignore | `.env.example` ã‚ã‚Š |
| **å€‹äººç”¨** | `workspace/.env` | âŒ Ignore | - |

**é‡è¦:** `.env` ãƒ•ã‚¡ã‚¤ãƒ«ã¯çµ¶å¯¾ã«ã‚³ãƒŸãƒƒãƒˆã—ãªã„ã§ãã ã•ã„ã€‚`.env.example` ã‚’å…ƒã«å„è‡ªä½œæˆã—ã¾ã™ã€‚

### 6.3. ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç† (Version Control)

é–‹ç™ºç’°å¢ƒã®å·®ç•°ï¼ˆã€Œç§ã®ç’°å¢ƒã§ã¯å‹•ã‹ãªã„ã€ï¼‰ã‚’é˜²ããŸã‚ã€ä»¥ä¸‹ã®3ç‚¹ã‚’ãƒ«ãƒ¼ãƒˆã«é…ç½®ã—ã€ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’çµ±ä¸€ã—ã¾ã™ã€‚

1. **`.tool-versions`** (asdf, mise ãƒ¦ãƒ¼ã‚¶ãƒ¼ç”¨)
2. **`.nvmrc`** (nvm ãƒ¦ãƒ¼ã‚¶ãƒ¼ç”¨)
3. **`package.json` ã® `engines` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰** (npm/pnpm å®Ÿè¡Œæ™‚ã®ã‚¬ãƒ¼ãƒ‰ãƒ¬ãƒ¼ãƒ«)

**é–‹ç™ºé–‹å§‹æ™‚ã¯å¿…ãšãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ãƒ„ãƒ¼ãƒ«ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼š**
```bash
# nvmã®å ´åˆ
nvm use

# asdf/miseã®å ´åˆ
asdf install  # ã¾ãŸã¯ mise install
```

### 6.4. ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ãƒ»ãƒãƒªã‚·ãƒ¼ (Documentation)

æƒ…å ±ã¯ã€Œã‚³ãƒŸãƒƒãƒˆã™ã‚‹ã‚‚ã®ã€ã€Œã—ã¦ã¯ã„ã‘ãªã„ã‚‚ã®ã€ã«æ˜ç¢ºã«åˆ†é›¢ã—ã¾ã™ã€‚

| ãƒ•ã‚¡ã‚¤ãƒ«/ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª | å½¹å‰²ï¼ˆãªã«ã‚’ç½®ãã‹ï¼‰ | Gitç®¡ç† |
| :--- | :--- | :--- |
| **`README.md`** | ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦ãƒ»æœ€é€Ÿèµ·å‹•ï¼ˆQuick Startï¼‰ | â­•ï¸ Commit |
| **`AGENT.md`** | **(ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«)** è¨­è¨ˆæ€æƒ³ãƒ»ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ»ãƒ«ãƒ¼ãƒ« | â­•ï¸ Commit |
| **`issue.md`** | ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒã‚¹ã‚¿ãƒ¼ãƒ—ãƒ©ãƒ³ | â­•ï¸ Commit |
| **`docs/guide/`** | **ã€å¿…é ˆã€‘** å†åˆ©ç”¨å¯èƒ½ãªã€Œæ‰‹é †æ›¸ã€ (ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—, ãƒ‡ãƒ—ãƒ­ã‚¤ç­‰) | â­•ï¸ Commit |
| **`docs/`**(ãã®ä»–) | **ã€ãƒ•ãƒªãƒ¼ã‚¹ã‚¿ã‚¤ãƒ«ã€‘** è¨­è¨ˆãƒ¡ãƒ¢ã€ADRã€è­°äº‹éŒ²ãªã© | â­•ï¸ Commit |
| **`workspace/`** | **ã€å³ç¦ã€‘** å€‹äººã®ä½œæ¥­å ´ãƒ»ä¸‹æ›¸ã | âŒ **Ignore** |

**ãƒ«ãƒ¼ãƒ«:**
- ãƒãƒ¼ãƒ ã§å…±æœ‰ã™ã¹ãæƒ…å ±ã¯å¿…ãš `docs/` é…ä¸‹ã«ã‚³ãƒŸãƒƒãƒˆ
- å€‹äººçš„ãªãƒ¡ãƒ¢ã‚„å®Ÿé¨“ã¯ `workspace/` ã«é…ç½®
- ç’°å¢ƒå¤‰æ•°ã‚„ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã¯çµ¶å¯¾ã«ã‚³ãƒŸãƒƒãƒˆã—ãªã„

### 6.4. VibeCodingå®Ÿè·µã‚¬ã‚¤ãƒ‰

VibeCodingã§æ–°æ©Ÿèƒ½ã‚’å®Ÿè£…ã™ã‚‹éš›ã®å®Ÿè·µçš„ãªã‚¬ã‚¤ãƒ‰ã§ã™ã€‚

#### 6.4.1. QuickStart Checklistï¼ˆå®Ÿè£…é–‹å§‹å‰ã®1åˆ†ç¢ºèªï¼‰

æ–°æ©Ÿèƒ½å®Ÿè£…æ™‚ã¯ã€ä»¥ä¸‹ã®é †åºã§é€²ã‚ã‚‹ã¨æœ€é€Ÿã§ã™ã€‚

```
â–¡ Step 1: è¦ä»¶ã‚’æ•´ç†
   â†’ workspace/[feature-name]-design.md ã«ä¸‹æ›¸ã
   â†’ ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚„ã‚ŠãŸã„ã“ã¨
   

â–¡ Step 2: ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå‚è€ƒï¼ˆè‡ªç”±ã«è¨­è¨ˆï¼‰
   â†’ 8.9ã‚’è¦‹ã¦ã€è¿‘ã„ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æŠŠæ¡
   â†’ è¦ä»¶ã«åˆã‚ã›ã¦è‡ªç”±ã«ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºï¼ˆãã®ã¾ã¾é©ç”¨ã—ãªã„ï¼‰
   â†’ ExamplePage/AdminPageã§å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’èª¿æŸ»ã™ã‚‹

â–¡ Step 3: è¨­è¨ˆæ•´ç†
   â†’ ç”»é¢æ•°ãƒ»ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ï¼ˆ3-5ç”»é¢æ¨å¥¨ï¼‰
   â†’ DBè¨­è¨ˆï¼ˆMigration + RLSï¼‰
   â†’ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å±¤ï¼ˆModel â†’ Repository â†’ Service â†’ Hook â†’ Component â†’ Pageï¼‰

â–¡ Step 4: TodoWrite ã§ã‚¿ã‚¹ã‚¯ç®¡ç†é–‹å§‹
   â†’ Phaseåˆ†å‰²ã¯å†…éƒ¨ç®¡ç†ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¸ã®ä¸­é–“å ±å‘Šã¯ä¸è¦

â–¡ Step 5: è¨­è¨ˆã‚’ã‚‚ã¨ã«å®Ÿè£…
   â†’ è©°ã¾ã£ãŸã‚‰å ±å‘Šã€ãã‚Œä»¥å¤–ã¯é€²ã‚ã‚‹

â–¡ Step 6: å‹•ä½œç¢ºèª
   â†’ workspace/ ã§ãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ â†’ ç”»é¢ç¢ºèª

â–¡ Step 7: æŒ¯ã‚Šè¿”ã‚Šï¼ˆå®Œäº†å¾Œï¼‰
   â†’ docs/ ã«è¨­è¨ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ•´ç†
```

**å‚ç…§ã‚»ã‚¯ã‚·ãƒ§ãƒ³:**
- DBè¨­è¨ˆ â†’ 6.1ï¼ˆãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰
- Componentè¨­è¨ˆ â†’ 4.1ï¼ˆã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼‰
- ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ â†’ 8.9ï¼ˆVibeCoding Design Templatesï¼‰
- ãƒˆãƒ©ãƒ–ãƒ«å¯¾å¿œ â†’ 9.2ï¼ˆVibeCodingä¸­ã®ã‚ˆãã‚ã‚‹ãƒˆãƒ©ãƒ–ãƒ«ï¼‰

---

#### 6.4.2. å®Ÿè£…ã®é€²ã‚æ–¹ï¼ˆåŸºæœ¬å§¿å‹¢ï¼‰

**VibeCodingã®æœ¬è³ª: ã‚¹ãƒ”ãƒ¼ãƒ‰é‡è¦–ã€è¦ä»¶ã‚’å‹•ã‹ã™ã“ã¨ã‚’æœ€å„ªå…ˆ**

è¨­è¨ˆãƒ»æ–¹é‡ãŒå›ºã¾ã£ãŸã‚‰ã€AIã¯ãã‚Œã«å¾“ã£ã¦å®Ÿè£…ã‚’é€²ã‚ã¾ã™ã€‚

**å®Ÿè£…æ™‚ã®ãƒ«ãƒ¼ãƒ«:**

1. **Phaseåˆ†ã‘ã¯å†…éƒ¨ç®¡ç†ã§OK**
   - TodoWriteãƒ„ãƒ¼ãƒ«ã§Phaseã‚’ç®¡ç†
   - ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¸ã®ä¸­é–“å ±å‘Šã¯ä¸è¦

2. **ç›¸è«‡ãŒå¿…è¦ãªæ™‚ã®ã¿åœæ­¢**
   - æŠ€è¡“çš„ã«è©°ã¾ã£ãŸæ™‚
   - ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãªã©é‡è¦ãªè¨­è¨ˆåˆ¤æ–­ãŒå¿…è¦ãªæ™‚
   - ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ˜ç¤ºçš„ã«ã€Œç›¸è«‡ã—ã‚ˆã†ã€ã€Œè¨­è¨ˆã‚’ã—ã‚ˆã†ã€ãªã©ã¨è¨€ã£ãŸæ™‚
   - ãã‚Œä»¥å¤–ã¯åŸºæœ¬çš„ã«å®Ÿè£…ã‚’é€²ã‚ã‚‹

3. **å“è³ªã¯AGENT.mdã®ãƒ«ãƒ¼ãƒ«ã¨Exampleã§æ‹…ä¿**
   - Repository/Modelãƒ‘ã‚¿ãƒ¼ãƒ³å¾¹åº•
   - çµ±ä¸€ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ï¼ˆcreateAkatsukiHandlerï¼‰ä½¿ç”¨
   - RLSè¨­è¨ˆã‚’æœ€åˆã‹ã‚‰è€ƒæ…®
   - ExamplePageã‚„åˆæœŸå®Ÿè£…ã‚’å¿…ãšèª¿æŸ»

**âœ… è‰¯ã„ä¾‹:**
```
ãƒ¦ãƒ¼ã‚¶ãƒ¼: ã€Œã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ä½œæˆã‚¢ãƒ—ãƒªä½œã‚ã†ã€
AI:
  1. è¦ä»¶æ•´ç†ï¼ˆworkspace/ã«ä¸‹æ›¸ãï¼‰
  2. ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå‚è€ƒï¼ˆ8.9ã‚’è¦‹ã¦ã€è¿‘ã„ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æŠŠæ¡ï¼‰
  3. è‡ªç”±ã«è¨­è¨ˆï¼ˆè¦ä»¶ã«åˆã‚ã›ã¦ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºï¼‰
  4. TodoWrite ã§ã‚¿ã‚¹ã‚¯ä½œæˆ
  5. ä¸€æ°—ã«å®Ÿè£…ï¼ˆMigration â†’ Model â†’ Repository â†’ Component â†’ Pageï¼‰
  6. å‹•ä½œç¢ºèªï¼ˆworkspace/ã§ãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆï¼‰
  7. å®Œæˆå ±å‘Š

ï¼ˆPhase 1-7ã‚’å†…éƒ¨çš„ã«é€²ã‚ã‚‹ã€è©°ã¾ã‚‰ãªã‘ã‚Œã°å ±å‘Šä¸è¦ï¼‰

â€» ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¯ã€Œå‚è€ƒã€ã§ã‚ã‚Šã€ãã®ã¾ã¾é©ç”¨ã™ã‚‹ã‚‚ã®ã§ã¯ãªã„
â€» è¦ä»¶ã«å¿œã˜ã¦è‡ªç”±ã«ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã—ã¦è¨­è¨ˆã™ã‚‹
```

**âŒ NGä¾‹:**
```
AI: ã€ŒPhase 1ãŒå®Œäº†ã—ã¾ã—ãŸã€‚æ¬¡ã«é€²ã‚“ã§è‰¯ã„ã§ã™ã‹ï¼Ÿã€
AI: ã€ŒMigrationã‚’ä½œã‚Šã¾ã—ãŸã€‚ç¢ºèªã—ã¦ãã ã•ã„ã€‚ã€
AI: ã€Œæ¬¡ã¯Repositoryã‚’ä½œã‚Šã¾ã™ãŒã€ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿã€
â†’ ã“ã‚Œã‚‰ã¯ä¸è¦ã€‚ä¸€æ°—ã«é€²ã‚ã‚‹ã€‚
```

---

#### 6.4.3. è¨­è¨ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ

**è¨­è¨ˆæ•´ç†ã¯å¿…é ˆã§ã™**

æ–°æ©Ÿèƒ½ã‚’å®Ÿè£…ã™ã‚‹å‰ã«ã€ä»¥ä¸‹ã®é …ç›®ã‚’ `workspace/[feature-name]-design.md` ã«æ›¸ãå‡ºã—ã¾ã™ã€‚

```markdown
# [æ©Ÿèƒ½å] - è¨­è¨ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

## 1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æœ¬å½“ã®ãƒ‹ãƒ¼ã‚ºï¼ˆ3è¡Œã§ï¼‰
ã€WHY: ãªãœã“ã‚ŒãŒå¿…è¦ã‹ï¼Ÿã€‘
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè§£æ±ºã—ãŸã„èª²é¡Œãƒ»é”æˆã—ãŸã„ç›®æ¨™
- ä¾‹: ã€Œå‹é”ã¨ä¸€ç·’ã«éŠã¹ã‚‹ã€å¯æ„›ã„ã‚­ãƒ£ãƒ©ã‚’ä½œã‚ŠãŸã„ã€

ã€WHO: èª°ãŒä½¿ã†ã‹ï¼Ÿã€‘
- ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼åƒ
- ä¾‹: ã€Œ10-20ä»£ã®å¥³æ€§ã€ãƒ—ãƒªã‚¯ãƒ©ä¸–ä»£ã€

ã€WHAT: ä½•ã‚’æä¾›ã™ã‚‹ã‹ï¼Ÿã€‘
- ä½“é¨“ã¨ã—ã¦æä¾›ã™ã‚‹ä¾¡å€¤
- ä¾‹: ã€Œè‡ªåˆ†ã ã‘ã®ã‚­ãƒ£ãƒ©ã‚’ä½œã£ã¦ã€SNSã§ã‚·ã‚§ã‚¢ã§ãã‚‹æ¥½ã—ã•ã€

## 2. ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹å±•é–‹
ã€ãƒ¡ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼ï¼ˆãƒãƒƒãƒ”ãƒ¼ãƒ‘ã‚¹ï¼‰ã€‘
1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã‚¢ãƒ—ãƒªã‚’é–‹ã
2. ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‹ã‚‰å¥½ã¿ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚’é¸ã¶ï¼ˆ3-5ç¨®é¡ï¼‰
3. ãƒ‘ãƒ¼ãƒ„ã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºï¼ˆé«ªå‹ã€ç›®ã€æœãªã©ï¼‰
4. ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã§ç¢ºèªã—ãªãŒã‚‰å¾®èª¿æ•´
5. å®Œæˆã—ãŸã‚­ãƒ£ãƒ©ã‚’ä¿å­˜ãƒ»ã‚·ã‚§ã‚¢

ã€ã‚µãƒ–ãƒ•ãƒ­ãƒ¼ã€‘
- éå»ã«ä½œã£ãŸã‚­ãƒ£ãƒ©ã‚’è¦‹è¿”ã™ï¼ˆã‚®ãƒ£ãƒ©ãƒªãƒ¼ï¼‰
- å‹é”ã®ã‚­ãƒ£ãƒ©ã‚’è¦‹ã‚‹ï¼ˆã‚½ãƒ¼ã‚·ãƒ£ãƒ«æ©Ÿèƒ½ï¼‰
- ä½œã‚Šç›´ã™ï¼ˆç·¨é›†æ©Ÿèƒ½ï¼‰

ã€ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ã€‘
- åˆå›è¨ªå•æ™‚ã®ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«
- ãƒ­ã‚°ã‚¤ãƒ³ã›ãšã«è©¦ã™ï¼ˆã‚²ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰ï¼‰
- ä¿å­˜æ•°åˆ¶é™ï¼ˆç„¡æ–™ vs æœ‰æ–™ï¼‰

## 3. ç”»é¢æ§‹æˆï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“é‡è¦–ï¼‰
ã€ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã€‘
HomePage (/) â†’ TemplateSelectPage (/create/template) â†’ CustomizePage (/create/customize) â†’ GalleryPage (/gallery)

ã€å„ç”»é¢ã®ä½“é¨“è¨­è¨ˆã€‘
- HomePage: ãƒ¯ã‚¯ãƒ¯ã‚¯æ„Ÿã‚’å‡ºã™ï¼ˆéå»ä½œå“ã®ã‚«ãƒ«ãƒ¼ã‚»ãƒ«ã€CTAï¼‰
- TemplateSelect: è¦–è¦šçš„ã«é¸ã³ã‚„ã™ã„ï¼ˆå¤§ããªã‚µãƒ ãƒã‚¤ãƒ«ï¼‰
- Customize: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã€ã‚¹ãƒ†ãƒƒãƒ—å¼UI
- Gallery: ã‚°ãƒªãƒƒãƒ‰è¡¨ç¤ºã€ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼æ©Ÿèƒ½

ã€ASCII WireFrameï¼ˆä¾‹: CustomizePageï¼‰ã€‘
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [â† æˆ»ã‚‹]  ã‚¹ãƒ†ãƒƒãƒ— 2/3  [æ¬¡ã¸ â†’]   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚         â”‚   â”‚  ãƒ‘ãƒ¼ãƒ„é¸æŠ    â”‚  â”‚
â”‚   â”‚ Preview â”‚   â”‚  â—‹ é«ªå‹       â”‚  â”‚
â”‚   â”‚         â”‚   â”‚  â—‹ ç›®         â”‚  â”‚
â”‚   â”‚  ã‚­ãƒ£ãƒ© â”‚   â”‚  â—‹ æœ         â”‚  â”‚
â”‚   â”‚         â”‚   â”‚  [ã‚«ãƒ©ãƒ¼é¸æŠ] â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                     â”‚
â”‚   [ãƒªã‚»ãƒƒãƒˆ]         [ä¿å­˜ã—ã¦æ¬¡ã¸] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 4. DBè¨­è¨ˆ
- ãƒ†ãƒ¼ãƒ–ãƒ«å®šç¾©ï¼ˆSQLï¼‰
- RLS Policyè¨­è¨ˆï¼ˆå¿…é ˆï¼‰

## 5. ä½¿ç”¨ã™ã‚‹Akatsukiæ©Ÿèƒ½
- å®Ÿè£…æ¸ˆã¿: AIã€Storageã€Databaseç­‰ï¼ˆExamplePage/AdminPageã‚’å‚è€ƒï¼‰
- æ—¢å­˜ã®Edge Functions
- æ–°è¦ä½œæˆãŒå¿…è¦ãªæ©Ÿèƒ½

## 6. ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å±¤
- Models: XXX.jsï¼ˆæ–°è¦/å®Ÿè£…æ¸ˆã¿ï¼‰
- Repositories: XXXRepository.jsï¼ˆæ–°è¦/å®Ÿè£…æ¸ˆã¿ï¼‰
- Services: XXXService.jsï¼ˆæ–°è¦/å®Ÿè£…æ¸ˆã¿ï¼‰
- Hooks: useXXX.jsï¼ˆæ–°è¦/å®Ÿè£…æ¸ˆã¿ï¼‰
- Components: features/xxx/ï¼ˆæ–°è¦ï¼‰

## 7. å®Ÿè£…ã‚¹ãƒ†ãƒƒãƒ—
â–¡ Phase 1: Migrationä½œæˆ
â–¡ Phase 2: Model/Repositoryä½œæˆ
â–¡ Phase 3: Service/Hookä½œæˆ
â–¡ Phase 4: Feature Componentä½œæˆ
â–¡ Phase 5: Pageä½œæˆã€Routingè¨­å®š
â–¡ Phase 6: å‹•ä½œç¢ºèªï¼ˆãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆï¼‰

## 8. é‡è¦ãªè¨­è¨ˆåˆ¤æ–­
- ãªãœã“ã®è¨­è¨ˆã«ã—ãŸã‹ï¼ˆç°¡æ½”ã«ï¼‰
- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è€ƒæ…®äº‹é …
```

**ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼:**

1. **ä¸‹æ›¸ãä½œæˆ**: `workspace/[feature-name]-design.md` ã«ãƒ•ã‚¡ã‚¤ãƒ«ä¿å­˜
2. **ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç¢ºèª**: 8.9ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãŒä½¿ãˆã‚‹ã‹åˆ¤æ–­
3. **ã‚½ãƒ¼ã‚¹ãƒ»Exampleèª¿æŸ»ã—ã¦å®Ÿè£…è¨ˆç”»**: ExamplePage/AdminPageã€ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã®JSDocãªã©ã‚’èª¿ã¹ã¦ãƒ‡ã‚¶ã‚¤ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ›´æ–°
4. **å®Ÿè£…é–‹å§‹**: è¨­è¨ˆã‚’è¦‹ãªãŒã‚‰VibeCoding
5. **å®Œäº†å¾Œ**: å®Ÿè£…ä¸­ã®å¤‰æ›´ãªã©ã‚‚æ•´ç†ã—ã¦ `docs/design/` ã«ã‚³ãƒŸãƒƒãƒˆ

**ãƒã‚¤ãƒ³ãƒˆ:**
- âœ… **æœ€å°é™ã®æ•´ç†ã§é–‹å§‹** - æ©Ÿèƒ½çš„ãªå®Œç’§ã‚’æ±‚ã‚ãªã„ã€‚è¦‹æ „ãˆãŒè‰¯ãå‹•ãã‚‚ã®ã‚’
- âœ… **ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆæ´»ç”¨** - ã‚ˆãã‚ã‚‹ãƒ‘ã‚¿ãƒ¼ãƒ³ã¯8.9å‚ç…§
- âœ… **Exampleæ´»ç”¨** - è±Šå¯ŒãªExampleãŒã‚ã‚‹ã®ã§å‚ç…§ã—ã¦è»Šè¼ªã®å†ç™ºæ˜ã‚„ãƒãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é¿ã‘ã‚‹
- âœ… **RLSè¨­è¨ˆã‚’æœ€åˆã‹ã‚‰** - å¾Œä»˜ã‘ã¯ä¸æ•´åˆã®å…ƒ
- âœ… **workspace â†’ docs** - ä¸‹æ›¸ãâ†’ç¢ºå®šç‰ˆã®æµã‚Œ

---

#### 6.4.4. ã‚ˆãã‚ã‚‹è³ªå•ï¼ˆFAQï¼‰

**Q1: ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¯ã©ã†ä½¿ãˆã°è‰¯ã„ï¼Ÿ**

A: ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¯ã€Œãã®ã¾ã¾é©ç”¨ã€ã™ã‚‹ã‚‚ã®ã§ã¯ãªãã€ã€Œå‚è€ƒã€ã¨ã—ã¦æ´»ç”¨ã—ã¾ã™ã€‚
   - ã‚»ã‚¯ã‚·ãƒ§ãƒ³8.9ã€ŒVibeCoding Design Templatesã€ã‚’è¦‹ã¦ã€è¿‘ã„ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æŠŠæ¡
   - è¦ä»¶ã«å¿œã˜ã¦è‡ªç”±ã«ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã—ã¦è¨­è¨ˆ
   - Template 1ï¼ˆAIç”»åƒç”Ÿæˆï¼‰ã€Template 2ï¼ˆLLMãƒãƒ£ãƒƒãƒˆï¼‰ã€Template 3ï¼ˆãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç†ï¼‰ã€Template 4ï¼ˆãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ï¼‰
   - VibeCodingã¯ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚¨ãƒ³ã‚¸ãƒ³ã§ã¯ãªãã€è‡ªç”±åº¦ã®é«˜ã„è¨­è¨ˆãŒæœ¬è³ª

**Q2: å®Ÿè£…ä¸­ã«è©°ã¾ã£ãŸã‚‰ï¼Ÿ**

A: ã‚»ã‚¯ã‚·ãƒ§ãƒ³9.2ã€ŒVibeCodingä¸­ã®ã‚ˆãã‚ã‚‹ãƒˆãƒ©ãƒ–ãƒ«ã€ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚
   - Edge Function 500ã‚¨ãƒ©ãƒ¼
   - RLSã§ãƒ‡ãƒ¼ã‚¿å–å¾—ã§ããªã„
   - Repository/Modelã§å‹ã‚¨ãƒ©ãƒ¼
   - ãªã©ã€6ã¤ã®ã‚±ãƒ¼ã‚¹ã¨è§£æ±ºæ–¹æ³•ã‚’è¨˜è¼‰

**Q3: Componentåˆ†å‰²ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã¯ï¼Ÿ**

A: ã‚»ã‚¯ã‚·ãƒ§ãƒ³4.1ã€ŒComponentåˆ†å‰²ã®åˆ¤æ–­åŸºæº–ï¼ˆThe 200-Line Ruleï¼‰ã€ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚
   - 200è¡Œã‚’è¶…ãˆãŸã‚‰åˆ†å‰²
   - useState ãŒ5å€‹ä»¥ä¸Šã§åˆ†å‰²
   - ãƒãƒ³ãƒ‰ãƒ©ãƒ¼é–¢æ•°ãŒ50è¡Œè¶…ãˆã§åˆ†å‰²

**Q4: workspace/ ã«ä½•ã‚’ç½®ã‘ã°è‰¯ã„ï¼Ÿ**

A: ä»¥ä¸‹ã®ã‚‚ã®ã‚’è‡ªç”±ã«é…ç½®ã§ãã¾ã™ï¼ˆGitç®¡ç†å¤–ï¼‰ï¼š
   - è¨­è¨ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ä¸‹æ›¸ãï¼ˆ`[feature-name]-design.md`ï¼‰
   - ãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼ˆ`generate-dummy-data.js`ï¼‰
   - å€‹äººçš„ãªãƒ¡ãƒ¢ã€å®Ÿé¨“ã‚³ãƒ¼ãƒ‰
   - ç’°å¢ƒå¤‰æ•°ï¼ˆ`.env`ï¼‰

**Q5: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ç¢ºèªãŒå¿…è¦ãªã‚¿ã‚¤ãƒŸãƒ³ã‚°ã¯ï¼Ÿ**

A: ä»¥ä¸‹ã®å ´åˆã®ã¿åœæ­¢ã—ã¦ç¢ºèªï¼š
   - æŠ€è¡“çš„ã«è©°ã¾ã£ãŸæ™‚
   - ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãªã©é‡è¦ãªè¨­è¨ˆåˆ¤æ–­ãŒå¿…è¦ãªæ™‚
   - ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ˜ç¤ºçš„ã«ã€Œç›¸è«‡ã—ã‚ˆã†ã€ã€Œè¨­è¨ˆã‚’ã—ã‚ˆã†ã€ãªã©ã¨è¨€ã£ãŸæ™‚
   - ãã‚Œä»¥å¤–ã¯ä¸€æ°—ã«é€²ã‚ã‚‹

### 6.5. ãƒ©ã‚¤ãƒ–ãƒ©ãƒª (Lib) ç®¡ç†ãƒãƒªã‚·ãƒ¼

ä¾å­˜é–¢ä¿‚ã®ã‚¯ãƒªãƒ¼ãƒ³ã•ã‚’ä¿ã¡ã¾ã™ã€‚

#### 1. å†…éƒ¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒª (Monorepo Internal)

* **å¯¾è±¡:** ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå°‚ç”¨ã®å…±é€šã‚³ãƒ¼ãƒ‰ï¼ˆå°†æ¥å®Ÿè£…äºˆå®šã® `ui-components`, `aigen-hooks` ãªã©ï¼‰ã€‚
* **å ´æ‰€:** `packages/` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªé…ä¸‹ã€‚ï¼ˆGitç®¡ç†å¯¾è±¡ï¼‰
* **å‚ç…§:** `workspace:*` ã«ã‚ˆã‚‹ãƒ­ãƒ¼ã‚«ãƒ«å‚ç…§ã‚’**æ¨å¥¨**ã—ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚ŠAppã¨Libã®åŒæ™‚é–‹ç™ºãŒå¯èƒ½ã§ã™ã€‚

**ä¾‹ (package.json):**
```json
{
  "dependencies": {
    "ui-components": "workspace:*",
    "aigen-hooks": "workspace:*"
  }
}
```

#### 2. å¤–éƒ¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒª (Monorepo External)

* **å¯¾è±¡:** å€‹äººOSSãªã©ã€ç§ãŸã¡ãŒç®¡ç†ã™ã‚‹ãŒã€ã“ã®ãƒªãƒã‚¸ãƒˆãƒªã®**å¤–éƒ¨**ã«ã‚ã‚‹ã‚‚ã®ã€‚
* **å‚ç…§:** `npm link` ã‚„ `path:` æŒ‡å®šã«ã‚ˆã‚‹**ãƒ­ãƒ¼ã‚«ãƒ«ãƒ‘ã‚¹å‚ç…§ã¯åŸå‰‡ç¦æ­¢**ã—ã¾ã™ã€‚
* **ä¿®æ­£:** ä¿®æ­£ãŒå¿…è¦ãªå ´åˆã€**å…ƒã®ï¼ˆå¤–éƒ¨ï¼‰ãƒªãƒã‚¸ãƒˆãƒªå´ã‚’ã‚¯ãƒªãƒ¼ãƒ³ã«ä¿®æ­£ãƒ»Publish**ã—ã€`package.json`ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’æ›´æ–°ã—ã¦å¯¾å¿œã—ã¾ã™ã€‚

**âŒ ç¦æ­¢ä¾‹:**
```json
{
  "dependencies": {
    "llm-toolkit": "file:../../llm-toolkit"  // NG!
  }
}
```

**âœ… æ¨å¥¨ä¾‹:**
```json
{
  "dependencies": {
    "llm-toolkit": "^1.2.3"  // OK: å…¬é–‹ãƒãƒ¼ã‚¸ãƒ§ãƒ³æŒ‡å®š
  }
}
```

#### 3. `workspace/` ã¨ã‚³ãƒ¼ãƒ‰å‚ç…§

* å¤–éƒ¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ã‚³ãƒ¼ãƒ‰ã‚’ã€Œèª­ã‚€ãŸã‚ã€ã« `workspace/` ã¸ `git clone` ã™ã‚‹ã®ã¯ã€å€‹äººã®è‡ªç”±ã§ã™ã€‚ï¼ˆ`workspace/` ã¯ã‚³ãƒŸãƒƒãƒˆã•ã‚Œãªã„ãŸã‚ï¼‰
* ãŸã ã—ã€ãã‚Œã‚‰ã®ã‚³ãƒ¼ãƒ‰ã«**ä¾å­˜é–¢ä¿‚ã¨ã—ã¦ãƒªãƒ³ã‚¯ã™ã‚‹ã“ã¨ã¯å³ç¦**ã§ã™ã€‚

### 6.6. Gitã‚³ãƒŸãƒƒãƒˆãƒãƒªã‚·ãƒ¼

* **ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸:** ç°¡æ½”ã‹ã¤æ˜ç¢ºã«ï¼ˆä½•ã‚’å¤‰æ›´ã—ãŸã‹ï¼‰
* **`.gitignore`:** ä»¥ä¸‹ã¯å¿…ãšé™¤å¤–ã•ã‚Œã¦ã„ã¾ã™
  - ç’°å¢ƒå¤‰æ•°ãƒ•ã‚¡ã‚¤ãƒ« (`.env`, `.env.local`, `.env.*.local`)
  - ãƒ“ãƒ«ãƒ‰æˆæœç‰© (`target/`, `dist/`, `build/`)
  - å€‹äººä½œæ¥­å ´ (`workspace/`)
  - IDEè¨­å®šã€OSå›ºæœ‰ãƒ•ã‚¡ã‚¤ãƒ«

---

## 7. é–‹ç™ºã‚³ãƒãƒ³ãƒ‰ä¸€è¦§

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã‹ã‚‰å®Ÿè¡Œã§ãã‚‹ä¸»è¦ã‚³ãƒãƒ³ãƒ‰ï¼š

### Frontend
```bash
npm run dev:frontend      # é–‹ç™ºã‚µãƒ¼ãƒãƒ¼èµ·å‹•
npm run build:frontend    # ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³ãƒ“ãƒ«ãƒ‰
npm run preview:frontend  # ãƒ“ãƒ«ãƒ‰çµæœã®ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼
```

### Backend
```bash
npm run dev:backend       # Shuttle ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºã‚µãƒ¼ãƒãƒ¼èµ·å‹•
npm run check:backend     # ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ãƒã‚§ãƒƒã‚¯
npm run build:backend     # ãƒªãƒªãƒ¼ã‚¹ãƒ“ãƒ«ãƒ‰
npm run test:backend      # ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
npm run deploy:backend    # Shuttleã¸ãƒ‡ãƒ—ãƒ­ã‚¤
```

### Supabase
```bash
# ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
npm run supabase:link             # Supabaseãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ãƒªãƒ³ã‚¯
npm run supabase:migration:new    # æ–°è¦ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ä½œæˆ
npm run supabase:push             # ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³é©ç”¨

# Edge Functions
npm run supabase:function:new     # æ–°è¦Functionä½œæˆ
npm run supabase:function:deploy  # Functionãƒ‡ãƒ—ãƒ­ã‚¤
```

## 8. UIå®Ÿè£…ã®æ¨™æº–è¨­è¨ˆãƒ‘ã‚¿ãƒ¼ãƒ³

### VibeCoding ãƒ‡ã‚¶ã‚¤ãƒ³åŸå‰‡

Akatsukiã§ã¯ã€**è¦‹æ „ãˆã®è‰¯ã•**ã¨**ä½¿ã„ã‚„ã™ã•**ã‚’é‡è¦–ã—ãŸã€ŒãƒªãƒƒãƒãªUIã€ã‚’æ¨™æº–ã¨ã—ã¾ã™ã€‚

#### ãƒ‡ã‚¶ã‚¤ãƒ³ã‚¹ã‚¿ã‚¤ãƒ«

Akatsukiã¯ä»¥ä¸‹ã®ãƒ‡ã‚¶ã‚¤ãƒ³ã‚¹ã‚¿ã‚¤ãƒ«ã‚’æ¡ç”¨ã—ã¦ã„ã¾ã™ï¼š

1. **Glassmorphismï¼ˆã‚°ãƒ©ã‚¹ãƒ¢ãƒ¼ãƒ•ã‚£ã‚ºãƒ ï¼‰**
   - åŠé€æ˜ã®èƒŒæ™¯ (`bg-white/80`, `bg-black/60`)
   - backdrop-bluråŠ¹æœ (`backdrop-blur-md`, `backdrop-blur-lg`)
   - æŸ”ã‚‰ã‹ã„å½± (`shadow-lg`, `shadow-xl`)

2. **Gradient Designï¼ˆã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‡ã‚¶ã‚¤ãƒ³ï¼‰**
   - èƒŒæ™¯ãƒ»ãƒœã‚¿ãƒ³ãƒ»ãƒ†ã‚­ã‚¹ãƒˆã«ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å¤šç”¨
   - è¯ã‚„ã‹ã§å°è±¡çš„ãªãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«
   - `bg-gradient-to-r`, `bg-gradient-to-br`

3. **Soft UIï¼ˆã‚½ãƒ•ãƒˆUIï¼‰**
   - ä¸¸ã¿ã®ã‚ã‚‹è¦ç´  (`rounded-xl`, `rounded-3xl`)
   - æŸ”ã‚‰ã‹ã„å°è±¡
   - ä½™ç™½ã‚’ãŸã£ã·ã‚Šä½¿ç”¨

**Akatsuki Design Language: "Vibrant Soft UI"**
- è¯ã‚„ã‹ã•ã¨æŸ”ã‚‰ã‹ã•ã‚’ä¸¡ç«‹
- AIã‚¢ãƒ—ãƒªã«æœ€é©ãªè¦ªã—ã¿ã‚„ã™ã„ãƒ‡ã‚¶ã‚¤ãƒ³

#### ã‚«ãƒ©ãƒ¼ãƒ†ãƒ¼ãƒãƒãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³

ã‚¢ãƒ—ãƒªã®ã‚¸ãƒ£ãƒ³ãƒ«ã«å¿œã˜ã¦ã€è‰²å‘³ã‚’é¸æŠã§ãã¾ã™ã€‚

**1. ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼ˆAIã‚¢ãƒ—ãƒªå‘ã‘ï¼‰- ãƒ”ãƒ³ã‚¯/ãƒ‘ãƒ¼ãƒ—ãƒ«/ãƒ–ãƒ«ãƒ¼**
```css
/* èƒŒæ™¯ */
bg-gradient-to-br from-pink-100 via-purple-100 to-blue-100

/* ãƒ†ã‚­ã‚¹ãƒˆã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ */
bg-gradient-to-r from-pink-500 via-purple-500 to-blue-500 text-transparent bg-clip-text

/* ãƒœã‚¿ãƒ³ */
bg-gradient-to-r from-pink-500 to-purple-600

/* ã‚¢ã‚¯ã‚»ãƒ³ãƒˆã‚«ãƒ©ãƒ¼ */
border-pink-300, border-purple-300, text-purple-600
```

**2. ãƒ“ã‚¸ãƒã‚¹/ä¼æ¥­å‘ã‘ - ãƒ€ãƒ¼ã‚¯/ãƒ–ãƒ«ãƒ¼ãƒˆãƒ¼ãƒ³**
```css
/* èƒŒæ™¯ */
bg-gradient-to-br from-slate-900 via-blue-900 to-slate-800
bg-gradient-to-br from-slate-100 via-blue-50 to-slate-100  /* ãƒ©ã‚¤ãƒˆãƒ¢ãƒ¼ãƒ‰ */

/* ãƒ†ã‚­ã‚¹ãƒˆã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ */
bg-gradient-to-r from-blue-400 via-cyan-400 to-teal-400 text-transparent bg-clip-text

/* ãƒœã‚¿ãƒ³ */
bg-gradient-to-r from-blue-600 to-cyan-600

/* ã‚¢ã‚¯ã‚»ãƒ³ãƒˆã‚«ãƒ©ãƒ¼ */
border-blue-400, border-cyan-400, text-blue-600
```

**3. ãƒ˜ãƒ«ã‚¹ã‚±ã‚¢/ã‚¦ã‚§ãƒ«ãƒã‚¹ - ã‚°ãƒªãƒ¼ãƒ³/ãƒŸãƒ³ãƒˆ**
```css
/* èƒŒæ™¯ */
bg-gradient-to-br from-emerald-50 via-teal-50 to-cyan-50

/* ãƒ†ã‚­ã‚¹ãƒˆã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ */
bg-gradient-to-r from-emerald-500 via-teal-500 to-cyan-500 text-transparent bg-clip-text

/* ãƒœã‚¿ãƒ³ */
bg-gradient-to-r from-emerald-500 to-teal-600

/* ã‚¢ã‚¯ã‚»ãƒ³ãƒˆã‚«ãƒ©ãƒ¼ */
border-emerald-300, border-teal-300, text-emerald-600
```

**4. ã‚¨ãƒ³ã‚¿ãƒ¡/ã‚¯ãƒªã‚¨ã‚¤ãƒ†ã‚£ãƒ– - ã‚ªãƒ¬ãƒ³ã‚¸/ã‚¤ã‚¨ãƒ­ãƒ¼**
```css
/* èƒŒæ™¯ */
bg-gradient-to-br from-orange-100 via-yellow-100 to-pink-100

/* ãƒ†ã‚­ã‚¹ãƒˆã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ */
bg-gradient-to-r from-orange-500 via-yellow-500 to-pink-500 text-transparent bg-clip-text

/* ãƒœã‚¿ãƒ³ */
bg-gradient-to-r from-orange-500 to-pink-600

/* ã‚¢ã‚¯ã‚»ãƒ³ãƒˆã‚«ãƒ©ãƒ¼ */
border-orange-300, border-yellow-300, text-orange-600
```

**5. Eã‚³ãƒãƒ¼ã‚¹/ã‚·ãƒ§ãƒƒãƒ”ãƒ³ã‚° - ãƒ‘ãƒ¼ãƒ—ãƒ«/ãƒ”ãƒ³ã‚¯**
```css
/* èƒŒæ™¯ */
bg-gradient-to-br from-purple-100 via-pink-100 to-rose-100

/* ãƒ†ã‚­ã‚¹ãƒˆã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ */
bg-gradient-to-r from-purple-500 via-pink-500 to-rose-500 text-transparent bg-clip-text

/* ãƒœã‚¿ãƒ³ */
bg-gradient-to-r from-purple-500 to-pink-600

/* ã‚¢ã‚¯ã‚»ãƒ³ãƒˆã‚«ãƒ©ãƒ¼ */
border-purple-300, border-pink-300, text-purple-600
```

**6. ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰å¯¾å¿œ**
```css
/* èƒŒæ™¯ï¼ˆãƒ€ãƒ¼ã‚¯ï¼‰ */
bg-gradient-to-br from-gray-900 via-slate-800 to-gray-900

/* ãƒ†ã‚­ã‚¹ãƒˆã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆãƒ€ãƒ¼ã‚¯ï¼‰ */
bg-gradient-to-r from-pink-400 via-purple-400 to-blue-400 text-transparent bg-clip-text

/* ã‚«ãƒ¼ãƒ‰ï¼ˆãƒ€ãƒ¼ã‚¯ï¼‰ */
bg-slate-800/50 backdrop-blur-lg border border-slate-700

/* ãƒœã‚¿ãƒ³ï¼ˆãƒ€ãƒ¼ã‚¯ï¼‰ */
bg-gradient-to-r from-pink-600 to-purple-700
```

**ä½¿ã„åˆ†ã‘ã‚¬ã‚¤ãƒ‰:**
- ãƒ—ãƒªã‚¯ãƒ©/AIç”»åƒç”Ÿæˆ â†’ ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼ˆãƒ”ãƒ³ã‚¯/ãƒ‘ãƒ¼ãƒ—ãƒ«/ãƒ–ãƒ«ãƒ¼ï¼‰
- ãƒ“ã‚¸ãƒã‚¹ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ â†’ ãƒ“ã‚¸ãƒã‚¹å‘ã‘ï¼ˆãƒ€ãƒ¼ã‚¯/ãƒ–ãƒ«ãƒ¼ï¼‰
- ãƒ˜ãƒ«ã‚¹ã‚±ã‚¢ã‚¢ãƒ—ãƒª â†’ ã‚°ãƒªãƒ¼ãƒ³/ãƒŸãƒ³ãƒˆ
- éŸ³æ¥½/å‹•ç”»ã‚¢ãƒ—ãƒª â†’ ã‚ªãƒ¬ãƒ³ã‚¸/ã‚¤ã‚¨ãƒ­ãƒ¼
- ECã‚µã‚¤ãƒˆ â†’ ãƒ‘ãƒ¼ãƒ—ãƒ«/ãƒ”ãƒ³ã‚¯

#### ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«é‡è¦–ã®åŸå‰‡

âœ… **ã‚„ã‚‹ã¹ãã“ã¨:**
- **ç”»åƒã‚’ç©æ¥µçš„ã«ä½¿ã†** - ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ç”»åƒã€ç”Ÿæˆç”»åƒã€ã‚¢ã‚¤ã‚³ãƒ³ç”»åƒ
- **ã‚¢ã‚¤ã‚³ãƒ³ã‚’å¤šç”¨** - lucide-react ã§è¦–è¦šçš„ã«ã‚ã‹ã‚Šã‚„ã™ã
- **ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã§è¯ã‚„ã‹ã«** - èƒŒæ™¯ã€ãƒœã‚¿ãƒ³ã€ã‚«ãƒ¼ãƒ‰ã«é©ç”¨
- **ä¸¸ã¿ã®ã‚ã‚‹ãƒ‡ã‚¶ã‚¤ãƒ³** - `rounded-lg`, `rounded-xl`, `rounded-3xl`
- **ä½™ç™½ã‚’ãŸã£ã·ã‚Š** - `space-y-6`, `gap-4` ãªã©ã§è©°ã‚è¾¼ã¾ãªã„
- **CTAãƒœã‚¿ãƒ³ã¯å¤§ãã** - `size="lg"` ã¾ãŸã¯ `size="xl"`ã€ç›®ç«‹ã¤é…è‰²

âŒ **é¿ã‘ã‚‹ã¹ãã“ã¨:**
- ç™½é»’ã®ã‚·ãƒ³ãƒ—ãƒ«ã™ãã‚‹UI
- ãƒ†ã‚­ã‚¹ãƒˆã ã‘ã®ç¾…åˆ—
- å°ã•ãã¦ç›®ç«‹ãŸãªã„ãƒœã‚¿ãƒ³
- çµµæ–‡å­—ã®éåº¦ãªä½¿ç”¨ï¼ˆã‚¢ã‚¤ã‚³ãƒ³å„ªå…ˆï¼‰

#### å¿…é ˆè¦ä»¶
- **ç”»é¢æ•°:** æœ€ä½3ç”»é¢ä»¥ä¸Š
- **ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³:** ãƒˆãƒƒãƒ—ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒãƒ¼å¿…é ˆï¼ˆè¤‡é›‘ãªã‚¢ãƒ—ãƒªã¯å·¦ãƒšã‚¤ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚‚æ¤œè¨ï¼‰
- **ã‚¢ã‚¤ã‚³ãƒ³:** lucide-reactã®ã‚¢ã‚¤ã‚³ãƒ³å„ªå…ˆä½¿ç”¨ã€çµµæ–‡å­—ã¯è£…é£¾ã®ã¿
- **ãƒªãƒƒãƒUI:** shadcn/uiã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå¿…é ˆä½¿ç”¨
- **ãƒ‡ã‚¶ã‚¤ãƒ³:** ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã€ä¸¸ã¿ã®ã‚ã‚‹ã‚«ãƒ¼ãƒ‰
- **CTAãƒœã‚¿ãƒ³:** ãƒ¡ã‚¤ãƒ³ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆç”Ÿæˆã€ä¿å­˜ãªã©ï¼‰ã¯å¤§ããç›®ç«‹ãŸã›ã‚‹ï¼ˆsize="lg" or "xl"ï¼‰
- **ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–:** ãƒ¢ãƒã‚¤ãƒ«ãƒ»ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆãƒ»ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—å¯¾å¿œï¼ˆTailwindã®ãƒ–ãƒ¬ãƒ¼ã‚¯ãƒã‚¤ãƒ³ãƒˆæ´»ç”¨ï¼‰

### æ¨å¥¨ãƒ‡ã‚¶ã‚¤ãƒ³ãƒ‘ã‚¿ãƒ¼ãƒ³é›†

VibeCodingã§ã‚ˆãä½¿ã†å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³ã§ã™ã€‚

#### ä¸»è¦ãƒ‘ã‚¿ãƒ¼ãƒ³ä¸€è¦§

**1. Hero Sectionï¼ˆãƒ’ãƒ¼ãƒ­ãƒ¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼‰**
- ç”¨é€”: ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ã®ç¬¬ä¸€å°è±¡
- é‡è¦ã‚¯ãƒ©ã‚¹: `min-h-screen`, `bg-gradient-to-br`, `text-6xl`, `bg-clip-text`, `Button variant="gradient"`

**2. Feature Cardsï¼ˆæ©Ÿèƒ½ã‚«ãƒ¼ãƒ‰ï¼‰**
- ç”¨é€”: æ©Ÿèƒ½ç´¹ä»‹ã€ãƒ¡ãƒ‹ãƒ¥ãƒ¼é¸æŠ
- é‡è¦ã‚¯ãƒ©ã‚¹: `grid md:grid-cols-3`, `Card`, `hover:border-pink-300`, lucide-reactã‚¢ã‚¤ã‚³ãƒ³

**3. Image Galleryï¼ˆç”»åƒã‚®ãƒ£ãƒ©ãƒªãƒ¼ï¼‰**
- ç”¨é€”: ç”Ÿæˆç”»åƒã®è¡¨ç¤ºã€ä½œå“ä¸€è¦§
- é‡è¦ã‚¯ãƒ©ã‚¹: `grid grid-cols-2 md:grid-cols-3`, `group`, `hover:scale-105`, `hover:shadow-2xl`

**4. Step-by-Step UIï¼ˆã‚¹ãƒ†ãƒƒãƒ—å¼UIï¼‰**
- ç”¨é€”: è¤‡æ•°ã‚¹ãƒ†ãƒƒãƒ—ã®ä½œæˆãƒ•ãƒ­ãƒ¼
- é‡è¦ã‚¯ãƒ©ã‚¹: `Progress`, `useState(currentStep)`, æ¡ä»¶åˆ†å²ã§Stepè¡¨ç¤º

**5. Loading & Empty Statesï¼ˆãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãƒ»ç©ºçŠ¶æ…‹ï¼‰**
- ç”¨é€”: ãƒ‡ãƒ¼ã‚¿å–å¾—ä¸­ã€ãƒ‡ãƒ¼ã‚¿ãªã—
- é‡è¦ã‚¯ãƒ©ã‚¹: `animate-spin`, `flex items-center justify-center`, lucide-reactã‚¢ã‚¤ã‚³ãƒ³

**6. Image Upload Previewï¼ˆç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼‰**
- ç”¨é€”: ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ™‚ã®ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼
- é‡è¦ã‚¯ãƒ©ã‚¹: `relative`, `absolute top-2 right-2`, `rounded-xl shadow-lg`

**è©³ç´°ãªå®Ÿè£…ä¾‹:** `src/pages/ExamplesPage.jsx` ãŠã‚ˆã³ `src/pages/HomePage.jsx` ã‚’å‚ç…§

### æ¨å¥¨ã™ã‚‹è¦–è¦šè¦ç´ 

#### ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³é…è‰²ãƒ‘ã‚¿ãƒ¼ãƒ³

Akatsukiã§æ¨å¥¨ã™ã‚‹ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³é…è‰²ï¼š

```css
/* èƒŒæ™¯ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ */
bg-gradient-to-br from-pink-100 via-purple-100 to-blue-100     /* æ˜ã‚‹ã„ãƒ‘ã‚¹ãƒ†ãƒ« */
bg-gradient-to-br from-purple-50 via-pink-50 to-yellow-50      /* æŸ”ã‚‰ã‹ã„ */
bg-gradient-to-br from-blue-50 via-cyan-50 to-teal-50          /* ã‚¯ãƒ¼ãƒ«ç³» */

/* ãƒ†ã‚­ã‚¹ãƒˆã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ */
bg-gradient-to-r from-pink-500 via-purple-500 to-blue-500 text-transparent bg-clip-text

/* ãƒœã‚¿ãƒ³ãƒ»ã‚«ãƒ¼ãƒ‰ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ */
bg-gradient-to-r from-pink-500 to-purple-600                   /* Button variant="gradient" */
bg-gradient-to-r from-blue-500 to-cyan-600                     /* ã‚¯ãƒ¼ãƒ«ç³» */
bg-gradient-to-r from-orange-500 to-pink-600                   /* æš–è‰²ç³» */
```

#### ã‚¢ã‚¤ã‚³ãƒ³ã®ä½¿ã„æ–¹

**lucide-react ã®æ¨å¥¨ã‚¢ã‚¤ã‚³ãƒ³:**
- `Sparkles` - AIç”Ÿæˆã€ã‚­ãƒ©ã‚­ãƒ©åŠ¹æœ
- `Wand2` - é­”æ³•ã€å¤‰æ›
- `Image` - ç”»åƒé–¢é€£
- `Camera` - æ’®å½±ã€ã‚«ãƒ¡ãƒ©
- `Palette` - ã‚«ãƒ©ãƒ¼ã€ãƒ‡ã‚¶ã‚¤ãƒ³
- `Download` - ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
- `Upload` - ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
- `Heart` - ãŠæ°—ã«å…¥ã‚Š
- `Star` - è©•ä¾¡
- `Zap` - é«˜é€Ÿã€ãƒ‘ãƒ¯ãƒ¼

**ã‚¢ã‚¤ã‚³ãƒ³ã‚µã‚¤ã‚º:**
- å°: `w-4 h-4` (ãƒœã‚¿ãƒ³å†…)
- ä¸­: `w-6 h-6` (ã‚«ãƒ¼ãƒ‰å†…)
- å¤§: `w-8 h-8` (ãƒ¡ã‚¤ãƒ³è¦ç´ )
- ç‰¹å¤§: `w-12 h-12` (Hero Section)

#### ä¸¸ã¿ã®ãƒ¬ãƒ™ãƒ«

```css
rounded-md     /* å°: ãƒœã‚¿ãƒ³ã€ãƒãƒƒã‚¸ */
rounded-lg     /* ä¸­: ã‚«ãƒ¼ãƒ‰ã€å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ */
rounded-xl     /* å¤§: ãƒ¡ã‚¤ãƒ³ã‚«ãƒ¼ãƒ‰ã€ç”»åƒ */
rounded-2xl    /* ç‰¹å¤§: Feature Cards */
rounded-3xl    /* è¶…ç‰¹å¤§: Hero Section ã‚«ãƒ¼ãƒ‰ */
rounded-full   /* å††å½¢: ã‚¢ãƒã‚¿ãƒ¼ã€ã‚¢ã‚¤ã‚³ãƒ³ãƒœã‚¿ãƒ³ */
```

### åŸºæœ¬æ–¹é‡
ã€Œãƒ—ãƒªã‚¯ãƒ©é¢¨ã‚¢ãƒ—ãƒªã‚’ä½œã£ã¦ã€ã®ã‚ˆã†ãªæŒ‡ç¤ºã‚’å—ã‘ãŸéš›ã€ä»¥ä¸‹ã®æ¨™æº–è¨­è¨ˆã«å¾“ã£ã¦å®Ÿè£…ã—ã¾ã™ã€‚

### ã‚«ãƒ†ã‚´ãƒªåˆ¥æ¨™æº–è¨­è¨ˆ

#### ãƒ—ãƒªã‚¯ãƒ©ç³»ã‚¢ãƒ—ãƒª
**ç”»é¢æ•°:** 3-5ç”»é¢

**æ¨å¥¨ãƒ•ãƒ­ãƒ¼:**
```
ãƒ›ãƒ¼ãƒ  â†’ ã‚¹ãƒ†ãƒƒãƒ—å¼ä½œæˆ â†’ å†™çœŸç”Ÿæˆ â†’ ã‚®ãƒ£ãƒ©ãƒªãƒ¼
```

**ã‚µãƒ³ãƒ—ãƒ«æŒ‡ç¤º:**
> "ãƒ—ãƒªã‚¯ãƒ©é¢¨ã®ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã‚¹ã‚¿ã‚¸ã‚ªã‚’ä½œã£ã¦"

**å®Ÿè£…ã‚¤ãƒ¡ãƒ¼ã‚¸:**
- ãƒ›ãƒ¼ãƒ : 3ã¤ã®æ©Ÿèƒ½ã‚«ãƒ¼ãƒ‰ï¼ˆã‚¢ã‚¤ã‚³ãƒ³ä»˜ãï¼‰
- ä½œæˆãƒ•ãƒ­ãƒ¼: ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ + ã‚¹ãƒ†ãƒƒãƒ—å¼UIï¼ˆé«ªè‰²â†’ãƒ¡ã‚¤ã‚¯â†’ãƒãƒ¼ã‚ºï¼‰
- ç”Ÿæˆç”»é¢: ãƒ•ãƒ¬ãƒ¼ãƒ é¸æŠ + ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼é¸æŠ
- ã‚®ãƒ£ãƒ©ãƒªãƒ¼: ã‚°ãƒªãƒƒãƒ‰è¡¨ç¤ºï¼ˆ2åˆ— or 3åˆ—ï¼‰

**UIè¦ç´ :**
- ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³èƒŒæ™¯ï¼ˆãƒ”ãƒ³ã‚¯/ç´«/é’ï¼‰
- Buttonï¼ˆgradient variantï¼‰
- Cardï¼ˆrounded-3xlï¼‰
- Progressï¼ˆã‚¹ãƒ†ãƒƒãƒ—è¡¨ç¤ºï¼‰
- Badgeï¼ˆNEWã€äººæ°—è¡¨ç¤ºï¼‰

#### ãã®ä»–ã®ã‚«ãƒ†ã‚´ãƒª
ä»Šå¾Œã€å¿…è¦ã«å¿œã˜ã¦è¿½åŠ 

### 8.9. VibeCoding Design Templatesï¼ˆå®Ÿè£…ã®å‚è€ƒãƒ‘ã‚¿ãƒ¼ãƒ³é›†ï¼‰

ã‚ˆãã‚ã‚‹ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ã€**å®Ÿè£…æ¸ˆã¿ã®æ­£ç¢ºãªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå**ã§å‚è€ƒè³‡æ–™åŒ–ã—ã¾ã™ã€‚

**é‡è¦: ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®ä½¿ã„æ–¹**
- âš ï¸ **ãã®ã¾ã¾é©ç”¨ã™ã‚‹ã‚‚ã®ã§ã¯ãªã„** - WordPressã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¨ã¯é•ã†
- âœ… **å‚è€ƒã«ã—ã¦è‡ªç”±ã«è¨­è¨ˆ** - è¿‘ã„ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æŠŠæ¡ã—ã€è¦ä»¶ã«å¿œã˜ã¦ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º
- âœ… **å®Ÿè£…æ¸ˆã¿ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’æ´»ç”¨** - AuthGuard, useAIGen, FileUploadç­‰ã‚’å†åˆ©ç”¨
- âœ… **å‘½åè¦å‰‡ã«å¾“ã†** - Model, Repository, Serviceç­‰ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ç¶­æŒ

**VibeCodingã®æœ¬è³ª:**
- ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚¨ãƒ³ã‚¸ãƒ³ã§ã¯ãªãã€è‡ªç”±åº¦ã®é«˜ã„è¨­è¨ˆã‚’å®Ÿç¾
- Akatsukiã®åŸºç›¤ï¼ˆçµ±ä¸€ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã€Repository/Modelãƒ‘ã‚¿ãƒ¼ãƒ³ç­‰ï¼‰ã‚’æ´»ç”¨
- ã‚¹ãƒ”ãƒ¼ãƒ‰ã¨å“è³ªã‚’ä¸¡ç«‹

#### Template 1: AIç”»åƒç”Ÿæˆã‚¢ãƒ—ãƒªï¼ˆãƒ—ãƒªã‚¯ãƒ©ç³»ï¼‰

**ç”»é¢æ§‹æˆ:**
```
HomePage (/) â†’ CreationPage (/create) â†’ GalleryPage (/gallery)
```

**DBè¨­è¨ˆ:**
```sql
-- Migration
profiles                    -- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ï¼ˆå®Ÿè£…æ¸ˆã¿ï¼‰
file_metadata              -- ç”Ÿæˆç”»åƒï¼ˆå®Ÿè£…æ¸ˆã¿ï¼‰
user_quotas                -- ä½¿ç”¨åˆ¶é™ï¼ˆå®Ÿè£…æ¸ˆã¿ï¼‰
creation_templates         -- ä½œæˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆï¼ˆæ–°è¦ï¼‰
user_creations             -- ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆç‰©ï¼ˆæ–°è¦ï¼‰
```

**å®Ÿè£…ãƒ¬ã‚¤ãƒ¤ãƒ¼:**
```javascript
// Models (src/models/)
UserProfile.js             // å®Ÿè£…æ¸ˆã¿
CreationTemplate.js        // æ–°è¦ä½œæˆ

// Repositories (src/repositories/)
UserProfileRepository.js           // å®Ÿè£…æ¸ˆã¿
FileMetadataRepository.js          // å®Ÿè£…æ¸ˆã¿
CreationTemplateRepository.js      // æ–°è¦ä½œæˆ

// Services (src/services/)
ImageGenerationService.js  // å®Ÿè£…æ¸ˆã¿
PublicStorageService.js    // å®Ÿè£…æ¸ˆã¿

// Hooks (src/hooks/)
useAIGen.js                // å®Ÿè£…æ¸ˆã¿
useImageGeneration.js      // æ–°è¦ä½œæˆï¼ˆuseAIGenãƒ™ãƒ¼ã‚¹ï¼‰

// Components (src/components/)
components/auth/AuthGuard.jsx          // å®Ÿè£…æ¸ˆã¿
components/layout/TopNavigation.jsx    // å®Ÿè£…æ¸ˆã¿
components/storage/FileUpload.jsx      // å®Ÿè£…æ¸ˆã¿
components/features/creation/CreationFlow.jsx      // æ–°è¦
components/features/creation/TemplateSelector.jsx  // æ–°è¦
components/features/gallery/ImageGallery.jsx       // æ–°è¦

// UI Components (shadcn/ui - å®Ÿè£…æ¸ˆã¿)
components/ui/card.jsx
components/ui/button.jsx
components/ui/progress.jsx
components/ui/badge.jsx
components/ui/skeleton.jsx
```

**Edge Functions:**
```
generate-image             // å®Ÿè£…æ¸ˆã¿
upload-file                // å®Ÿè£…æ¸ˆã¿
```

**å®Ÿè£…ãƒ•ãƒ­ãƒ¼:**
1. Migrationä½œæˆï¼ˆcreation_templates, user_creationsï¼‰
2. Modelä½œæˆï¼ˆCreationTemplateï¼‰
3. Repositoryä½œæˆï¼ˆCreationTemplateRepositoryï¼‰
4. Custom Hookä½œæˆï¼ˆuseImageGenerationï¼‰
5. Feature Componentsä½œæˆï¼ˆCreationFlow, TemplateSelector, ImageGalleryï¼‰
6. Pagesä½œæˆï¼ˆCreationPage, GalleryPageï¼‰
7. Routingè¨­å®šï¼ˆApp.jsxï¼‰

---

#### Template 2: LLMãƒãƒ£ãƒƒãƒˆã‚¢ãƒ—ãƒª

**ç”»é¢æ§‹æˆ:**
```
HomePage (/) â†’ ChatPage (/chat) â†’ HistoryPage (/history)
```

**DBè¨­è¨ˆ:**
```sql
-- Migration
profiles                   -- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ï¼ˆå®Ÿè£…æ¸ˆã¿ï¼‰
ai_models                  -- AIãƒ¢ãƒ‡ãƒ«æƒ…å ±ï¼ˆå®Ÿè£…æ¸ˆã¿ï¼‰
llm_call_logs              -- LLMå‘¼ã³å‡ºã—å±¥æ­´ï¼ˆå®Ÿè£…æ¸ˆã¿ï¼‰
user_quotas                -- ä½¿ç”¨åˆ¶é™ï¼ˆå®Ÿè£…æ¸ˆã¿ï¼‰
chat_sessions              -- ãƒãƒ£ãƒƒãƒˆã‚»ãƒƒã‚·ãƒ§ãƒ³ï¼ˆæ–°è¦ï¼‰
chat_messages              -- ãƒãƒ£ãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆæ–°è¦ï¼‰
```

**å®Ÿè£…ãƒ¬ã‚¤ãƒ¤ãƒ¼:**
```javascript
// Models
AIModel.js                 // å®Ÿè£…æ¸ˆã¿
UserProfile.js             // å®Ÿè£…æ¸ˆã¿
ChatSession.js             // æ–°è¦ä½œæˆ
ChatMessage.js             // æ–°è¦ä½œæˆ

// Repositories
AIModelRepository.js       // å®Ÿè£…æ¸ˆã¿
UserQuotaRepository.js     // å®Ÿè£…æ¸ˆã¿
ChatSessionRepository.js   // æ–°è¦ä½œæˆ
ChatMessageRepository.js   // æ–°è¦ä½œæˆ

// Services
services/ai/AIService.js   // å®Ÿè£…æ¸ˆã¿
EdgeFunctionService.js     // å®Ÿè£…æ¸ˆã¿

// Hooks
useAIGen.js                // å®Ÿè£…æ¸ˆã¿
useChatSession.js          // æ–°è¦ä½œæˆ

// Components
components/auth/AuthGuard.jsx              // å®Ÿè£…æ¸ˆã¿
components/layout/TopNavigation.jsx        // å®Ÿè£…æ¸ˆã¿
components/features/chat/ChatCard.jsx      // æ–°è¦
components/features/chat/MessageList.jsx   // æ–°è¦
components/features/chat/ModelSelector.jsx // æ–°è¦

// UI Components (shadcn/ui)
components/ui/card.jsx
components/ui/button.jsx
components/ui/input.jsx
components/ui/textarea.jsx
components/ui/skeleton.jsx
components/ui/scroll-area.jsx
```

**Edge Functions:**
```
ai-chat                    // å®Ÿè£…æ¸ˆã¿ï¼ˆOpenAI/Anthropic/Geminiå¯¾å¿œï¼‰
```

**å®Ÿè£…ãƒ•ãƒ­ãƒ¼:**
1. Migrationä½œæˆï¼ˆchat_sessions, chat_messagesï¼‰
2. Modelä½œæˆï¼ˆChatSession, ChatMessageï¼‰
3. Repositoryä½œæˆï¼ˆChatSessionRepository, ChatMessageRepositoryï¼‰
4. Custom Hookä½œæˆï¼ˆuseChatSessionï¼‰
5. Feature Componentsä½œæˆï¼ˆChatCard, MessageList, ModelSelectorï¼‰
6. Pagesä½œæˆï¼ˆChatPage, HistoryPageï¼‰
7. Routingè¨­å®šï¼ˆApp.jsxï¼‰

---

#### Template 3: ãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç†ã‚¢ãƒ—ãƒª

**ç”»é¢æ§‹æˆ:**
```
HomePage (/) â†’ UploadPage (/upload) â†’ FilesPage (/files)
```

**DBè¨­è¨ˆ:**
```sql
-- Migration
profiles                   -- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ï¼ˆå®Ÿè£…æ¸ˆã¿ï¼‰
file_metadata              -- ãƒ•ã‚¡ã‚¤ãƒ«ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ï¼ˆå®Ÿè£…æ¸ˆã¿ï¼‰
file_folders               -- ãƒ•ã‚©ãƒ«ãƒ€ï¼ˆæ–°è¦ï¼‰
```

**å®Ÿè£…ãƒ¬ã‚¤ãƒ¤ãƒ¼:**
```javascript
// Models
UserProfile.js             // å®Ÿè£…æ¸ˆã¿
FileMetadata.js            // æ–°è¦ä½œæˆ
FileFolder.js              // æ–°è¦ä½œæˆ

// Repositories
FileMetadataRepository.js  // å®Ÿè£…æ¸ˆã¿
FileFolderRepository.js    // æ–°è¦ä½œæˆ

// Services
PublicStorageService.js    // å®Ÿè£…æ¸ˆã¿
PrivateStorageService.js   // å®Ÿè£…æ¸ˆã¿

// Hooks
useFileUpload.js           // æ–°è¦ä½œæˆ

// Components
components/auth/AuthGuard.jsx          // å®Ÿè£…æ¸ˆã¿
components/storage/FileUpload.jsx      // å®Ÿè£…æ¸ˆã¿
components/features/files/FileList.jsx     // æ–°è¦
components/features/files/FolderTree.jsx   // æ–°è¦

// UI Components (shadcn/ui)
components/ui/card.jsx
components/ui/button.jsx
components/ui/table.jsx
components/ui/dropdown-menu.jsx
components/ui/dialog.jsx
```

**Edge Functions:**
```
upload-file                // å®Ÿè£…æ¸ˆã¿
delete-file                // å®Ÿè£…æ¸ˆã¿
get-signed-url             // å®Ÿè£…æ¸ˆã¿
create-signed-url          // å®Ÿè£…æ¸ˆã¿
```

**å®Ÿè£…ãƒ•ãƒ­ãƒ¼:**
1. Migrationä½œæˆï¼ˆfile_foldersï¼‰
2. Modelä½œæˆï¼ˆFileMetadata, FileFolderï¼‰
3. Repositoryä½œæˆï¼ˆFileFolderRepositoryï¼‰
4. Custom Hookä½œæˆï¼ˆuseFileUploadï¼‰
5. Feature Componentsä½œæˆï¼ˆFileList, FolderTreeï¼‰
6. Pagesä½œæˆï¼ˆUploadPage, FilesPageï¼‰
7. Routingè¨­å®šï¼ˆApp.jsxï¼‰

---

#### Template 4: ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ï¼ˆãƒ‡ãƒ¼ã‚¿å¯è¦–åŒ–ï¼‰

**ç”»é¢æ§‹æˆ:**
```
HomePage (/) â†’ DashboardPage (/dashboard) â†’ ReportsPage (/reports)
```

**DBè¨­è¨ˆ:**
```sql
-- Migration
profiles                   -- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ï¼ˆå®Ÿè£…æ¸ˆã¿ï¼‰
user_usage_stats           -- ä½¿ç”¨çµ±è¨ˆï¼ˆå®Ÿè£…æ¸ˆã¿ï¼‰
metrics                    -- ãƒ¡ãƒˆãƒªã‚¯ã‚¹ï¼ˆæ–°è¦ï¼‰
reports                    -- ãƒ¬ãƒãƒ¼ãƒˆï¼ˆæ–°è¦ï¼‰
```

**å®Ÿè£…ãƒ¬ã‚¤ãƒ¤ãƒ¼:**
```javascript
// Models
UserProfile.js             // å®Ÿè£…æ¸ˆã¿
UserUsageStats.js          // æ–°è¦ä½œæˆ
Metric.js                  // æ–°è¦ä½œæˆ

// Repositories
UserUsageStatsRepository.js  // å®Ÿè£…æ¸ˆã¿
MetricRepository.js          // æ–°è¦ä½œæˆ

// Services
EdgeFunctionService.js     // å®Ÿè£…æ¸ˆã¿

// Hooks
useMetrics.js              // æ–°è¦ä½œæˆ

// Components
components/auth/AuthGuard.jsx                  // å®Ÿè£…æ¸ˆã¿
components/features/dashboard/MetricsCard.jsx  // æ–°è¦
components/features/dashboard/ChartCard.jsx    // æ–°è¦
components/features/dashboard/StatsOverview.jsx // æ–°è¦

// UI Components (shadcn/ui)
components/ui/card.jsx
components/ui/chart.jsx    // å®Ÿè£…æ¸ˆã¿ï¼ˆRechartsçµ±åˆï¼‰
components/ui/table.jsx
components/ui/badge.jsx
```

**Edge Functions:**
```
generate-report            // æ–°è¦ä½œæˆ
```

**å®Ÿè£…ãƒ•ãƒ­ãƒ¼:**
1. Migrationä½œæˆï¼ˆmetrics, reportsï¼‰
2. Modelä½œæˆï¼ˆUserUsageStats, Metricï¼‰
3. Repositoryä½œæˆï¼ˆMetricRepositoryï¼‰
4. Edge Functionä½œæˆï¼ˆgenerate-reportï¼‰
5. Custom Hookä½œæˆï¼ˆuseMetricsï¼‰
6. Feature Componentsä½œæˆï¼ˆMetricsCard, ChartCard, StatsOverviewï¼‰
7. Pagesä½œæˆï¼ˆDashboardPage, ReportsPageï¼‰
8. Routingè¨­å®šï¼ˆApp.jsxï¼‰

---

#### ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆæ´»ç”¨ã®ãƒã‚¤ãƒ³ãƒˆ

1. **å®Ÿè£…æ¸ˆã¿ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’æœ€å¤§é™æ´»ç”¨**
   - AuthGuard, TopNavigation, FileUpload ã¯å¿…é ˆ
   - shadcn/ui ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯ã™ã¹ã¦åˆ©ç”¨å¯èƒ½

2. **Edge Functionsã®å†åˆ©ç”¨**
   - ai-chat, generate-image, upload-file ã¯å®Ÿè£…æ¸ˆã¿
   - æ–°è¦Edge Functionã¯çµ±ä¸€ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ï¼ˆcreateAkatsukiHandlerï¼‰ã‚’ä½¿ç”¨

3. **Repository/Model ãƒ‘ã‚¿ãƒ¼ãƒ³**
   - æ—¢å­˜ã® UserProfileRepository.js ã‚’å‚è€ƒã«å®Ÿè£…
   - fromDatabase(), toDatabase() ã‚’å¿…ãšå®Ÿè£…

4. **Custom Hooks ã«ã‚ˆã‚‹å†åˆ©ç”¨**
   - useAIGen.js ã‚’å‚è€ƒã«ã€Featureå›ºæœ‰ã®Hooksã‚’ä½œæˆ
   - ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã¯ã™ã¹ã¦Hooksã«é›†ç´„

---

## 9. ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ç’°å¢ƒãŒå‹•ã‹ãªã„æ™‚ã®ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

1. **Node.jsãƒãƒ¼ã‚¸ãƒ§ãƒ³ç¢ºèª:**
   ```bash
   node --version  # v20.x ä»¥ä¸Š
   nvm use         # ã¾ãŸã¯ asdf install
   ```

2. **Rustãƒãƒ¼ã‚¸ãƒ§ãƒ³ç¢ºèª:**
   ```bash
   rustc --version
   ```

3. **ä¾å­˜é–¢ä¿‚ã®å†ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«:**
   ```bash
   npm install
   cd packages/app-backend && cargo build
   ```

4. **ç’°å¢ƒå¤‰æ•°ã®ç¢ºèª:**
   ```bash
   # Frontend
   cat packages/app-frontend/.env

   # Backend
   cat packages/app-backend/.env
   ```

5. **Supabaseæ¥ç¶šç¢ºèª:**
   - Supabaseãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒActiveã‹ç¢ºèª
   - DATABASE_URLã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒæ­£ã—ã„ã‹ç¢ºèª

---

### 9.2. VibeCodingä¸­ã®ã‚ˆãã‚ã‚‹ãƒˆãƒ©ãƒ–ãƒ«

å®Ÿè£…ä¸­ã«ç™ºç”Ÿã—ã‚„ã™ã„å•é¡Œã¨è§£æ±ºæ–¹æ³•ã‚’è¨˜è¼‰ã—ã¾ã™ã€‚

**ã“ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®ä½¿ã„æ–¹:**
- å®Ÿè£…ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸã‚‰ã€è©²å½“ã™ã‚‹ã‚±ãƒ¼ã‚¹ã‚’æ¢ã™
- è¨ºæ–­æ–¹æ³•ã«å¾“ã£ã¦åŸå› ã‚’ç‰¹å®š
- è§£æ±ºæ–¹æ³•ã‚’é©ç”¨

#### ã‚±ãƒ¼ã‚¹1: Edge Function ãŒ 500 ã‚¨ãƒ©ãƒ¼

**ç—‡çŠ¶:**
- Edge Functionå‘¼ã³å‡ºã—ãŒ500ã‚¨ãƒ©ãƒ¼ã§å¤±æ•—
- ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã§ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œãªã„

**è¨ºæ–­æ–¹æ³•:**
```bash
# ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ­ã‚°ç¢ºèª
npx supabase functions logs ai-chat --tail

# ç‰¹å®šã®Functionã®ãƒ­ã‚°
npx supabase functions logs generate-image --tail
```

**ã‚ˆãã‚ã‚‹åŸå› ã¨è§£æ±º:**

1. **Secretsæœªè¨­å®š**
   ```bash
   # Secretsä¸€è¦§ç¢ºèª
   npx supabase secrets list

   # ä¸è¶³ã—ã¦ã„ã‚‹Secretè¨­å®š
   npx supabase secrets set OPENAI_API_KEY=sk-...
   npx supabase secrets set ANTHROPIC_API_KEY=sk-ant-...
   ```

2. **CORSè¨­å®šæ¼ã‚Œ**
   - çµ±ä¸€ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ï¼ˆcreateAkatsukiHandler, createSystemHandlerï¼‰ã‚’ä½¿ç”¨ã—ã¦ã„ã‚Œã°è‡ªå‹•å¯¾å¿œæ¸ˆã¿
   - æ‰‹å‹•ã§Fetch APIã‚’ä½¿ã£ã¦ã„ã‚‹å ´åˆã¯ã€Response headerã«CORSè¨­å®šã‚’è¿½åŠ 

3. **èªè¨¼ã‚¨ãƒ©ãƒ¼**
   ```typescript
   // âœ… èªè¨¼å¿…é ˆAPIã®å ´åˆ
   createAkatsukiHandler(req, {
     requireAuth: true,  // â† ã“ã‚Œã‚’å¿˜ã‚Œãšã«
     logic: async ({ userClient, adminClient, repos }) => { ... }
   })
   ```

4. **å…¥åŠ›ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼**
   ```typescript
   // Zodã‚¹ã‚­ãƒ¼ãƒã§å‹ãƒã‚§ãƒƒã‚¯
   import { z } from 'zod'

   const InputSchema = z.object({
     prompt: z.string().min(1),
     model: z.string().optional(),
   })

   createAkatsukiHandler<Input, Output>(req, {
     inputSchema: InputSchema,  // â† ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³è‡ªå‹•å®Ÿè¡Œ
     // ...
   })
   ```

---

#### ã‚±ãƒ¼ã‚¹2: RLSã§ãƒ‡ãƒ¼ã‚¿å–å¾—ã§ããªã„

**ç—‡çŠ¶:**
- ãƒ­ã‚°ã‚¤ãƒ³æ¸ˆã¿ãªã®ã«ã€è‡ªåˆ†ã®ãƒ‡ãƒ¼ã‚¿ãŒå–å¾—ã§ããªã„
- `profiles` ãƒ†ãƒ¼ãƒ–ãƒ«ãŒç©ºé…åˆ—ã§è¿”ã£ã¦ãã‚‹

**è¨ºæ–­æ–¹æ³•:**
```sql
-- RLS Policyç¢ºèªï¼ˆSupabase Dashboard â†’ Database â†’ Policiesï¼‰
SELECT * FROM pg_policies WHERE tablename = 'profiles';

-- ç¾åœ¨ã®èªè¨¼çŠ¶æ…‹ç¢ºèª
SELECT auth.uid();  -- null ã®å ´åˆã¯æœªãƒ­ã‚°ã‚¤ãƒ³
```

**ã‚ˆãã‚ã‚‹åŸå› ã¨è§£æ±º:**

1. **Policyæœªä½œæˆ**
   ```sql
   -- Migration ã§å¿…ãš RLS Policy ã‚’ä½œæˆ
   CREATE POLICY "Users can read own profile"
     ON profiles FOR SELECT
     USING (auth.uid() = user_id);

   CREATE POLICY "Users can update own profile"
     ON profiles FOR UPDATE
     USING (auth.uid() = user_id);
   ```

2. **auth.uid() ãŒ null**
   ```javascript
   // ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰: ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ç¢ºèª
   const { user } = useAuth()
   if (!user) {
     // ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã¸ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
   }

   // Edge Function: èªè¨¼ç¢ºèª
   const { data: { user }, error } = await userClient.auth.getUser()
   if (error || !user) {
     throw new Error('Unauthorized')
   }
   ```

3. **adminClient ä½¿ã†ã¹ãç®‡æ‰€ã§ userClient ã‚’ä½¿ç”¨**
   ```typescript
   // âŒ æ‚ªã„ä¾‹: Usageæ›´æ–°ã‚’userClientã§å®Ÿè¡Œï¼ˆRLSã§æ‹’å¦ã•ã‚Œã‚‹ï¼‰
   await userClient.from('user_quotas').update({ usage: usage + 1 })

   // âœ… è‰¯ã„ä¾‹: ReposçµŒç”±ã§adminClientä½¿ç”¨ï¼ˆæ”¹ã–ã‚“é˜²æ­¢ï¼‰
   await repos.userQuota.incrementUsage(quotaId)
   ```

4. **å¤–éƒ¨ã‚­ãƒ¼åˆ¶ç´„ã‚¨ãƒ©ãƒ¼**
   ```sql
   -- profiles.user_id ãŒ auth.users ã«å­˜åœ¨ã—ãªã„å ´åˆ
   -- Trigger ãŒæ­£ã—ãå‹•ä½œã—ã¦ã„ã‚‹ã‹ç¢ºèª
   SELECT * FROM auth.users WHERE id = 'ãƒ¦ãƒ¼ã‚¶ãƒ¼ID';
   ```

---

#### ã‚±ãƒ¼ã‚¹3: Repository/Model ã§å‹ã‚¨ãƒ©ãƒ¼

**ç—‡çŠ¶:**
- `UserProfile.fromDatabase is not a function`
- `Cannot read property 'toDatabase' of undefined`

**è¨ºæ–­æ–¹æ³•:**
```javascript
// Modelå®Ÿè£…ç¢ºèª
console.log(UserProfile.fromDatabase)  // undefined ã®å ´åˆã¯æœªå®Ÿè£…
```

**ã‚ˆãã‚ã‚‹åŸå› ã¨è§£æ±º:**

1. **fromDatabase() ã®å®Ÿè£…æ¼ã‚Œ**
   ```javascript
   // âŒ æ‚ªã„ä¾‹: static method æœªå®Ÿè£…
   class UserProfile {
     constructor(data) {
       this.userId = data.userId
       // ...
     }
   }

   // âœ… è‰¯ã„ä¾‹: fromDatabase() ã‚’å¿…ãšå®Ÿè£…
   class UserProfile {
     constructor(data) {
       this.userId = data.userId
       // ...
     }

     static fromDatabase(data) {
       return new UserProfile({
         userId: data.user_id,       // snake_case â†’ camelCase
         username: data.username,
         displayName: data.display_name,
       })
     }

     toDatabase() {
       return {
         user_id: this.userId,       // camelCase â†’ snake_case
         username: this.username,
         display_name: this.displayName,
       }
     }
   }
   ```

2. **Repository ã§ Model ã‚’ä½¿ã‚ãšã«ç›´æ¥è¿”ã™**
   ```javascript
   // âŒ æ‚ªã„ä¾‹: DBãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’ç›´æ¥è¿”ã™
   static async findByUserId(userId) {
     const { data } = await supabase
       .from('profiles')
       .select('*')
       .eq('user_id', userId)
       .single()

     return data  // âŒ snake_case ã®ã¾ã¾
   }

   // âœ… è‰¯ã„ä¾‹: Model çµŒç”±ã§å¤‰æ›
   static async findByUserId(userId) {
     const { data } = await supabase
       .from('profiles')
       .select('*')
       .eq('user_id', userId)
       .single()

     return UserProfile.fromDatabase(data)  // âœ… camelCase ã«å¤‰æ›
   }
   ```

3. **import æ¼ã‚Œ**
   ```javascript
   // âœ… å¿…ãš Model ã‚’ import
   import { UserProfile } from '../models'

   // ã¾ãŸã¯
   import { UserProfile } from '../models/UserProfile'
   ```

---

#### ã‚±ãƒ¼ã‚¹4: Migrationé©ç”¨ã§ããªã„

**ç—‡çŠ¶:**
- `npm run supabase:push` ãŒã‚¨ãƒ©ãƒ¼
- `duplicate key value violates unique constraint`

**è¨ºæ–­æ–¹æ³•:**
```bash
# Migrationå±¥æ­´ç¢ºèª
npx supabase migration list

# é©ç”¨æ¸ˆã¿Migrationç¢ºèªï¼ˆSupabase Dashboard â†’ Database â†’ Migrationsï¼‰
```

**ã‚ˆãã‚ã‚‹åŸå› ã¨è§£æ±º:**

1. **æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã¨ã®ç«¶åˆ**
   ```sql
   -- âŒ æ‚ªã„ä¾‹: æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚‹ã®ã« NOT NULL åˆ¶ç´„è¿½åŠ 
   ALTER TABLE profiles ADD COLUMN role TEXT NOT NULL;

   -- âœ… è‰¯ã„ä¾‹: DEFAULT å€¤ã‚’è¨­å®š
   ALTER TABLE profiles ADD COLUMN role TEXT NOT NULL DEFAULT 'user';
   ```

2. **Migrationé †åºã®å•é¡Œ**
   ```bash
   # Migration ãƒ•ã‚¡ã‚¤ãƒ«åã®ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã‚’ç¢ºèª
   ls supabase/migrations/

   # 20251029_*.sql ã®é †åºãŒæ­£ã—ã„ã‹ç¢ºèª
   ```

3. **æ‰‹å‹•ã§DBã‚’å¤‰æ›´ã—ã¦ã—ã¾ã£ãŸ**
   ```bash
   # Supabase Dashboard ã§ç›´æ¥ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’å¤‰æ›´ã—ãŸå ´åˆã€
   # Migration ã¨ã®ä¸æ•´åˆãŒç™ºç”Ÿã™ã‚‹

   # è§£æ±º: Migration ã«åæ˜ 
   npm run supabase:migration:new fix_manual_changes
   ```

---

#### ã‚±ãƒ¼ã‚¹5: EdgeFunctionService ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹å½¢å¼ã‚¨ãƒ©ãƒ¼

**ç—‡çŠ¶:**
- Edge Functionã¯æˆåŠŸã—ã¦ã„ã‚‹ã®ã«ã€ã‚µãƒ¼ãƒ“ã‚¹å±¤ã§ã€Œãƒ‡ãƒ¼ã‚¿ãŒãªã„ã€ã‚¨ãƒ©ãƒ¼
- `data` ã¨ `error` ã®æ‰±ã„ã‚’é–“é•ãˆã¦ã„ã‚‹
- `No image data returned` ãªã©ã®ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸

**è¨ºæ–­æ–¹æ³•:**
```javascript
// ã‚µãƒ¼ãƒ“ã‚¹å±¤ã§ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’ãƒ­ã‚°å‡ºåŠ›
const { data, error } = await EdgeFunctionService.invoke('generate-image', {...})
console.log('[Debug] EdgeFunctionService response:', { data, error })
```

**åŸå› :**
`EdgeFunctionService.invoke()` ã¯ **`{ data, error }` å½¢å¼** ã‚’è¿”ã—ã¾ã™ã€‚AkatsukiResponseå½¢å¼ã® `{ success, result, error }` ã‚’ `{ data, error }` å½¢å¼ã«å¤‰æ›ã—ã¦ã„ã¾ã™ã€‚

```javascript
// Edge Function ãŒè¿”ã™ãƒ¬ã‚¹ãƒãƒ³ã‚¹ (AkatsukiResponse)
{
  success: true,
  result: {
    image_data: "base64...",
    mime_type: "image/png"
  }
}

// EdgeFunctionService.invoke() ãŒè¿”ã™å€¤ ({ data, error } å½¢å¼)
{
  data: {
    image_data: "base64...",
    mime_type: "image/png"
  },
  error: null
}

// ã‚¨ãƒ©ãƒ¼æ™‚
{
  data: null,
  error: Error("ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸")
}
```

**è§£æ±ºæ–¹æ³•:**

```javascript
// âŒ æ‚ªã„ä¾‹: åˆ†å‰²ä»£å…¥ã›ãšã«ä½¿ç”¨
const result = await EdgeFunctionService.invoke('generate-image', {...})
if (!result.image_data) {  // â† result.data.image_data ãŒæ­£ã—ã„
  throw new Error('No data')
}

// âœ… è‰¯ã„ä¾‹: { data, error } å½¢å¼ã§åˆ†å‰²ä»£å…¥
const { data, error } = await EdgeFunctionService.invoke('generate-image', {...})
if (error) {
  return { data: null, error }  // ã‚¨ãƒ©ãƒ¼ã‚’ãã®ã¾ã¾è¿”ã™
}

if (!data || !data.image_data) {
  return { data: null, error: new Error('No image data returned') }
}

// data ã‚’ä½¿ç”¨
console.log(data.image_data)
```

**é‡è¦:**
- ã™ã¹ã¦ã®Serviceã¯ `{ data, error }` å½¢å¼ã‚’è¿”ã™ï¼ˆçµ±ä¸€ä»•æ§˜ï¼‰
- **ã‚¨ãƒ©ãƒ¼æ™‚ã‚‚ throw ã—ãªã„**: `{ data: null, error: Error }` ã‚’è¿”ã™
- å‘¼ã³å‡ºã—å´ã§å¿…ãš `error` ãƒã‚§ãƒƒã‚¯ã‚’è¡Œã†
- React Query ã¨ã®ç›¸æ€§ãŒè‰¯ã„è¨­è¨ˆ

**é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«:**
- `src/services/EdgeFunctionService.js:25-94` - `{ data, error }` å½¢å¼ã¸ã®å¤‰æ›ãƒ­ã‚¸ãƒƒã‚¯
- `src/services/ImageGenerationService.js:43-189` - Service ã®å®Ÿè£…ä¾‹

---

#### Akatsukiå›ºæœ‰ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

**çµ±ä¸€ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆæœ€é‡è¦ï¼‰:**
```typescript
// âœ… å¿…ãš createAkatsukiHandler ã¾ãŸã¯ createSystemHandler ã‚’ä½¿ç”¨
import { createAkatsukiHandler } from '../_shared/handler.ts'

Deno.serve(async (req) => {
  return createAkatsukiHandler(req, {
    requireAuth: true,  // èªè¨¼å¿…é ˆ
    inputSchema: InputSchema,  // Zodãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
    logic: async ({ userClient, adminClient, repos }) => {
      // userClient: RLSæœ‰åŠ¹
      // adminClient: RLSãƒã‚¤ãƒ‘ã‚¹ï¼ˆUsageç­‰ã®æ”¹ã–ã‚“é˜²æ­¢ï¼‰
      // repos: Repositoryé›†ç´„ï¼ˆadminClientçµŒç”±ï¼‰

      return { result: 'success' }
    }
  })
})
```

**Repository/Model ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆå¿…é ˆï¼‰:**
```javascript
// âœ… å¿…ãš Model çµŒç”±ã§DBå¤‰æ›
// 1. Repository ã§ãƒ‡ãƒ¼ã‚¿å–å¾—
const data = await UserProfileRepository.findByUserId(userId)

// 2. Model ã§å¤‰æ›ï¼ˆè‡ªå‹•å®Ÿè¡Œï¼‰
const profile = UserProfile.fromDatabase(data)  // snake_case â†’ camelCase

// 3. æ›´æ–°æ™‚ã‚‚ Model çµŒç”±
await UserProfileRepository.update(userId, profile.toDatabase())
```

**RLSè¨­è¨ˆã‚’æœ€åˆã‹ã‚‰ï¼ˆé‡è¦ï¼‰:**
```sql
-- Migrationä½œæˆæ™‚ã«å¿…ãš Policy ã‚‚ä½œæˆ
CREATE TABLE profiles (...);

-- RLSæœ‰åŠ¹åŒ–
ALTER TABLE profiles ENABLE ROW LEVEL SECURITY;

-- Policyä½œæˆï¼ˆåŒæ™‚ã«ï¼‰
CREATE POLICY "Users can read own profile"
  ON profiles FOR SELECT
  USING (auth.uid() = user_id);
```

**Edge Functions ãƒ­ã‚°ç¢ºèªï¼ˆãƒˆãƒ©ãƒ–ãƒ«æ™‚å¿…é ˆï¼‰:**
```bash
# ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ­ã‚°ç¢ºèª
npx supabase functions logs ai-chat --tail
npx supabase functions logs generate-image --tail

# Secretsç¢ºèª
npx supabase secrets list
```

---

## 10. ã•ã‚‰ã«è©³ã—ã

- **ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ:** `README.md`
- **Backend APIè©³ç´°:** `packages/app-backend/README.md`
- **ãƒ‡ãƒ—ãƒ­ã‚¤æ‰‹é †:** `docs/guide/` (ä»Šå¾Œè¿½åŠ äºˆå®š)

---

## 10. Supabase è¨­å®š (Supabase Configuration)

### Edge Functions

ç¾åœ¨ãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚Œã¦ã„ã‚‹Edge Functions:

1. **ai-chat** - ãƒãƒ«ãƒãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼LLM API
   - Providers: OpenAI, Anthropic (Claude), Google (Gemini)
   - Default models:
     - OpenAI: `gpt-4o-mini`
     - Anthropic: `claude-sonnet-4-5-20250929`
     - Gemini: `gemini-2.5-flash`

2. **upload-file** - ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
   - Public/Private ãƒã‚±ãƒƒãƒˆå¯¾å¿œ
   - æœ€å¤§ã‚µã‚¤ã‚º: 10MB

3. **create-signed-url** - Signed URL ç”Ÿæˆ
   - ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ç”¨

### Storage Buckets

1. **uploads** (Public)
   - å…¬é–‹ãƒ•ã‚¡ã‚¤ãƒ«ç”¨
   - RLS: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯è‡ªåˆ†ã®ãƒ•ã‚©ãƒ«ãƒ€ã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å¯èƒ½
   - èª°ã§ã‚‚èª­ã¿å–ã‚Šå¯èƒ½

2. **private_uploads** (Private)
   - ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ç”¨
   - RLS: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯è‡ªåˆ†ã®ãƒ•ã‚¡ã‚¤ãƒ«ã®ã¿ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½
   - Signed URLå¿…é ˆ

### Required Secrets

```bash
# LLM Provider API Keys
OPENAI_API_KEY=sk-...
ANTHROPIC_API_KEY=sk-ant-...
GEMINI_API_KEY=AIza...

# Supabase (è‡ªå‹•è¨­å®š)
SUPABASE_URL=https://...supabase.co
SUPABASE_ANON_KEY=eyJh...
SUPABASE_SERVICE_ROLE_KEY=eyJh...
SUPABASE_DB_URL=postgresql://...
```

### Secrets è¨­å®šã‚³ãƒãƒ³ãƒ‰

```bash
# ä¸€æ‹¬è¨­å®š
npx supabase secrets set --env-file .env.secrets

# å€‹åˆ¥è¨­å®š
npx supabase secrets set OPENAI_API_KEY=sk-...
npx supabase secrets set ANTHROPIC_API_KEY=sk-ant-...
npx supabase secrets set GEMINI_API_KEY=AIza...
# WebSearch å‘ã‘ Option
npx supabase secrets set TAVILY_API_KEY=tvly-...
# ComfyUI (RunPod) å‘ã‘ Option
npx supabase secrets set RUNPOD_ENDPOINT=https://your-pod-id.proxy.runpod.net
npx supabase secrets set RUNPOD_API_KEY=your-runpod-auth-token


# ç¢ºèª
npx supabase secrets list
```

### Database Tables

- **llm_call_logs**: LLM APIå‘¼ã³å‡ºã—å±¥æ­´
- **user_quotas**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã”ã¨ã®æœˆé–“ä½¿ç”¨åˆ¶é™
- **profiles**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æƒ…å ±
- **system_events**: ã‚¤ãƒ™ãƒ³ãƒˆã‚­ãƒ¥ãƒ¼ï¼ˆéåŒæœŸã‚¸ãƒ§ãƒ–å‡¦ç†ï¼‰
- **event_handlers**: ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ãƒ¼è¨­å®š


### Event System (ã‚¤ãƒ™ãƒ³ãƒˆé§†å‹•ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£)

è»½é‡ãªã‚¤ãƒ™ãƒ³ãƒˆé§†å‹•ã‚¸ãƒ§ãƒ–ã‚­ãƒ¥ãƒ¼ã‚·ã‚¹ãƒ†ãƒ ã‚’å®Ÿè£…ã—ã¦ã„ã¾ã™ã€‚

**ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£:**
```
EventService.emit() â†’ system_events (DB)
  â†“
  â”œâ”€â†’ Supabase Realtime â†’ Frontend (å³åº§ã«é€šçŸ¥)
  â””â”€â†’ Cron (æ¯åˆ†) â†’ process-events â†’ Handler Edge Functions
```

**ä½¿ç”¨ä¾‹:**
```javascript
// Frontend: ã‚¤ãƒ™ãƒ³ãƒˆç™ºè¡Œ
import { EventService } from './services/EventService'
await EventService.emit('image.generated', {
  imageId: '123',
  imageUrl: 'https://...',
  userId: user.id
})

// Frontend: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒªã‚¹ãƒŠãƒ¼
import { useEventListener } from './hooks/useEventListener'
useEventListener('image.generated', (event) => {
  toast.success('ç”»åƒç”Ÿæˆå®Œäº†ï¼')
  refetchImages()
})
```

**å®Ÿè£…æ¸ˆã¿ã‚¤ãƒ™ãƒ³ãƒˆã‚¿ã‚¤ãƒ—:**
- `image.generated` - ç”»åƒç”Ÿæˆå®Œäº†
- `quota.exceeded` - ã‚¯ã‚©ãƒ¼ã‚¿è¶…é
- `quota.warning` - ã‚¯ã‚©ãƒ¼ã‚¿è­¦å‘Š
- `user.registered` - ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²
- `model.synced` - ãƒ¢ãƒ‡ãƒ«åŒæœŸå®Œäº†

**ç‰¹å¾´:**
- ã‚·ãƒ³ãƒ—ãƒ«ãªç™ºè¡Œ: `EventService.emit(type, payload)`
- Realtimeé€šçŸ¥: åˆ¥ã‚¿ãƒ–ã§ã‚‚å³åº§ã«åæ˜ 
- è‡ªå‹•ãƒªãƒˆãƒ©ã‚¤: æŒ‡æ•°ãƒãƒƒã‚¯ã‚ªãƒ•ï¼ˆ5åˆ† Ã— retry_countï¼‰
- å„ªå…ˆåº¦åˆ¶å¾¡: `priority`ã§å‡¦ç†é †ã‚’åˆ¶å¾¡
- ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«å®Ÿè¡Œ: `scheduledAt`ã§é…å»¶å®Ÿè¡Œ

**Admin UI:** `/admin/events` ã§ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç›£è¦–å¯èƒ½

è©³ç´°ã¯ `workspace/event-system-guide.md` ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

### Async Job System (éåŒæœŸã‚¸ãƒ§ãƒ–å®Ÿè¡Œ)

Event Systemã‚’æ‹¡å¼µã—ãŸã€é•·æ™‚é–“å®Ÿè¡Œã‚¿ã‚¹ã‚¯å‘ã‘ã®éåŒæœŸã‚¸ãƒ§ãƒ–ã‚·ã‚¹ãƒ†ãƒ ã§ã™ã€‚

**ç‰¹å¾´:**
- **CRONé§†å‹•**: Edge Functionã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆï¼ˆ1åˆ†ï¼‰ã‚’å›é¿
- **é€²æ—ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°**: 0-100%ã®é€²æ—ã‚’Realtimeé…ä¿¡
- **æœ€å¤§1åˆ†å¾…æ©Ÿ**: ã‚¸ãƒ§ãƒ–èµ·å‹•ã‹ã‚‰å‡¦ç†é–‹å§‹ã¾ã§æœ€å¤§1åˆ†ã®ãƒ‡ã‚£ãƒ¬ã‚¤ï¼ˆè¨±å®¹ç¯„å›²ï¼‰
- **ã‚·ãƒ³ãƒ—ãƒ«API**: `EventService.emit('job:*')` ã§ã‚¸ãƒ§ãƒ–èµ·å‹•

**ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£:**
```
EventService.emit('job:*') â†’ system_events (pending)
  â†“ (æœ€å¤§1åˆ†å¾…æ©Ÿ)
Cron â†’ process-events â†’ handlers.ts
  â†“ (é€²æ—æ›´æ–°: 0% â†’ 50% â†’ 100%)
Realtime â†’ Frontend (useJob Hook)
  â†“
JobProgress Component (UIè¡¨ç¤º)
```

**ä½¿ç”¨ä¾‹ï¼ˆBackend - æ–°ã—ã„ã‚¸ãƒ§ãƒ–ãƒãƒ³ãƒ‰ãƒ©ãƒ¼è¿½åŠ ï¼‰:**
```typescript
// supabase/functions/execute-async-job/handlers.ts
export const jobHandlers: Record<string, JobHandler> = {
  'generate-report': async (params, context) => {
    const { reportType, startDate, endDate } = params

    // Step 1: åˆæœŸåŒ– (20%)
    await context.updateProgress(20)
    console.log(`Generating ${reportType} report`)

    // Step 2: ãƒ‡ãƒ¼ã‚¿å–å¾— (60%)
    const data = await fetchReportData(startDate, endDate)
    await context.updateProgress(60)

    // Step 3: å‡¦ç† (90%)
    const result = await processData(data)
    await context.updateProgress(90)

    // Step 4: çµæœè¿”å´ï¼ˆ100%ã¯è‡ªå‹•è¨­å®šï¼‰
    return {
      records: result.length,
      revenue: result.totalRevenue,
      generatedAt: new Date().toISOString()
    }
  }
}
```

**ä½¿ç”¨ä¾‹ï¼ˆFrontend - ã‚¸ãƒ§ãƒ–èµ·å‹•ã¨ç›£è¦–ï¼‰:**
```javascript
import { EventService } from './services/EventService'
import { useJob } from './hooks/useJob'
import { JobProgress } from './components/common/JobProgress'

// ã‚¸ãƒ§ãƒ–èµ·å‹•
const event = await EventService.emit('job:generate-report', {
  reportType: 'sales',
  startDate: '2025-01-01',
  endDate: '2025-01-31'
})

// é€²æ—ç›£è¦–ï¼ˆRealtimeè‡ªå‹•æ›´æ–°ï¼‰
const { progress, isCompleted, result } = useJob(event.id, {
  onComplete: (result) => {
    toast.success('ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆå®Œäº†ï¼')
    console.log(result)
  }
})

// UIè¡¨ç¤º
<JobProgress
  jobId={event.id}
  title="Sales Report"
  renderResult={(result) => (
    <div>
      <p>Records: {result.records}</p>
      <p>Revenue: ${result.revenue}</p>
    </div>
  )}
/>
```

**å®Ÿè£…æ¸ˆã¿ã‚¸ãƒ§ãƒ–ã‚¿ã‚¤ãƒ—:**
- `job:generate-report` - ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆï¼ˆã‚µãƒ³ãƒ—ãƒ«å®Ÿè£…ï¼‰

**ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒæ‹¡å¼µ:**
```sql
-- system_events ãƒ†ãƒ¼ãƒ–ãƒ«ã«è¿½åŠ ã•ã‚ŒãŸã‚«ãƒ©ãƒ 
ALTER TABLE system_events
  ADD COLUMN progress INTEGER DEFAULT 0 CHECK (progress >= 0 AND progress <= 100);
  ADD COLUMN result JSONB;
  ADD COLUMN processing_started_at TIMESTAMPTZ;
```

**ãƒ‡ãƒ¢:** `/examples` ãƒšãƒ¼ã‚¸ã§å‹•ä½œç¢ºèªå¯èƒ½

è©³ç´°ã¯ `docs/design/async_job_system.md` ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

### RLS ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

**âŒ é–“é•ã„: é–¢æ•°ã‚’ç›´æ¥å‘¼ã¶**
```sql
CREATE POLICY "Admin only"
  ON table_name
  FOR ALL
  USING (is_admin());  -- NG
```

**âœ… æ­£ã—ã„: SELECT ã§ãƒ©ãƒƒãƒ—**
```sql
CREATE POLICY "Admin only"
  ON table_name
  FOR ALL
  USING ((SELECT is_admin()) = true);  -- OK
```

**ç†ç”±:**
- RLSãƒãƒªã‚·ãƒ¼å†…ã§é–¢æ•°ã‚’ç›´æ¥å‘¼ã¶ã¨ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹å ´åˆãŒã‚ã‚‹
- `SELECT` ã§ãƒ©ãƒƒãƒ—ã™ã‚‹ã“ã¨ã§å®‰å…¨ã«å®Ÿè¡Œå¯èƒ½
- `= true` ã§æ˜ç¤ºçš„ã«booleanæ¯”è¼ƒ

**is_admin() å®Ÿè£…:**
```sql
CREATE OR REPLACE FUNCTION is_admin()
RETURNS BOOLEAN AS $$
BEGIN
  RETURN (
    SELECT COALESCE(
      (auth.jwt() -> 'app_metadata' -> 'role')::text = '"admin"',
      false
    )
  );
END;
$$ LANGUAGE plpgsql SECURITY DEFINER;
```

**é‡è¦:**
- `raw_app_meta_data` ã‚’ä½¿ç”¨ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå¤‰æ›´ä¸å¯ï¼‰
- `raw_user_meta_data` ã¯ä½¿ç”¨ã—ãªã„ï¼ˆã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒªã‚¹ã‚¯ï¼‰

### Realtime è¨­å®š

**é‡è¦:** Realtimeã‚’ä½¿ç”¨ã™ã‚‹ãƒ†ãƒ¼ãƒ–ãƒ«ã¯æ‰‹å‹•ã§æœ‰åŠ¹åŒ–ãŒå¿…è¦ã§ã™ã€‚

**è¨­å®šæ–¹æ³•:**
1. Supabase Dashboard â†’ Database â†’ Replication
2. `supabase_realtime_messages_publication` ã‚’é¸æŠ
3. å¯¾è±¡ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆä¾‹: `system_events`ï¼‰ã‚’è¿½åŠ 

**å‹•ä½œç¢ºèª:**
```javascript
// ExamplesPage (/examples) ã§ç¢ºèª
// ã‚¤ãƒ™ãƒ³ãƒˆã‚’ç™ºè¡Œ â†’ ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§å—ä¿¡ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
```

è©³ç´°ã¯ `docs/setup.md` ã®ã€Œ4.6. Supabase Realtime è¨­å®šã€ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

---

## 11. LLM Function Calling System

Akatsukiã¯ã€LLMãŒè‡ªå¾‹çš„ã«ã‚·ã‚¹ãƒ†ãƒ æ©Ÿèƒ½ã‚’å‘¼ã³å‡ºã›ã‚‹**Function Call System**ã‚’æ¨™æº–æ­è¼‰ã—ã¦ã„ã¾ã™ã€‚

### 11.1. ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Frontend Admin UI                        â”‚
â”‚  /admin/function-definitions             â”‚
â”‚  â†’ Functionå®šç¾©ã®CRUD                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“ INSERT/UPDATE
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ function_call_definitions (DB)          â”‚
â”‚  - name, description                    â”‚
â”‚  - parameters_schema (JSON Schema)      â”‚
â”‚  - target_event_type                    â”‚
â”‚  - is_enabled, is_global                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“ SELECT
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ai-chat Edge Function                   â”‚
â”‚  1. DBã‹ã‚‰Functionå®šç¾©èª­ã¿è¾¼ã¿           â”‚
â”‚  2. LLMã«ã‚¹ã‚­ãƒ¼ãƒæ³¨å…¥                    â”‚
â”‚  3. Function Callæ¤œå‡º                   â”‚
â”‚  4. system_events ã«Jobç™»éŒ²             â”‚
â”‚  5. function_call_logs è¨˜éŒ²             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Job System                              â”‚
â”‚  â† å®Ÿè¡Œãƒ­ã‚¸ãƒƒã‚¯ã¯åˆ¥é€”å®Ÿè£…               â”‚
â”‚  ï¼ˆJob Handler / Webhook / ç‹¬è‡ªï¼‰       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 11.2. è¨­è¨ˆæ€æƒ³

**é‡è¦ãªåˆ†é›¢:**
- **Functionå®šç¾© = ã‚¹ã‚­ãƒ¼ãƒã®ã¿ï¼ˆDBç®¡ç†ï¼‰**
- **å®Ÿè¡Œãƒ­ã‚¸ãƒƒã‚¯ = åˆ¥ã®å±¤ã§å®Ÿè£…**

ã“ã®è¨­è¨ˆã«ã‚ˆã‚Šï¼š
- âœ… ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼éä¾å­˜ï¼ˆOpenAI/Anthropic/Geminiå…±é€šï¼‰
- âœ… å®Ÿè¡ŒåŸºç›¤ã¯Job Systemã§çµ±ä¸€
- âœ… ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒç‹¬è‡ªFunctionã‚’ç™»éŒ²å¯èƒ½ï¼ˆLLM Platformå‹ã‚¢ãƒ—ãƒªã‚‚ä½œã‚Œã‚‹ï¼‰
- âœ… VibeCodingã§æŸ”è»Ÿã«ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºå¯èƒ½

### 11.3. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒ

**function_call_definitions ãƒ†ãƒ¼ãƒ–ãƒ«:**
```sql
CREATE TABLE function_call_definitions (
  id UUID PRIMARY KEY,
  user_id UUID,  -- NULL = global function
  name TEXT NOT NULL,
  description TEXT NOT NULL,
  parameters_schema JSONB NOT NULL,  -- JSON Schema
  target_event_type TEXT NOT NULL,   -- e.g., 'job:send_webhook'
  is_enabled BOOLEAN DEFAULT true,
  is_global BOOLEAN DEFAULT false,
  created_at TIMESTAMPTZ,
  updated_at TIMESTAMPTZ
);
```

**function_call_logs ãƒ†ãƒ¼ãƒ–ãƒ«:**
```sql
CREATE TABLE function_call_logs (
  id UUID PRIMARY KEY,
  llm_call_log_id UUID,  -- LLMå‘¼ã³å‡ºã—ã¨ã®ç´ä»˜ã‘
  user_id UUID,
  function_name TEXT NOT NULL,
  function_arguments JSONB NOT NULL,
  execution_type TEXT NOT NULL,  -- 'async' (å…¨ã¦JobçµŒç”±)
  status TEXT NOT NULL,  -- 'pending' | 'success' | 'failed'
  result JSONB,
  error_message TEXT,
  system_event_id UUID,  -- Job ID
  execution_time_ms INTEGER,
  started_at TIMESTAMPTZ,
  completed_at TIMESTAMPTZ,
  created_at TIMESTAMPTZ
);
```

### 11.4. ä½¿ã„æ–¹

**1. Functionå®šç¾©ã‚’è¿½åŠ ï¼ˆAdmin UIï¼‰**

`/admin/function-definitions` ã«ã‚¢ã‚¯ã‚»ã‚¹:
- Functionå: `send_webhook`
- èª¬æ˜: `Send HTTP webhook to external service`
- Parameters Schema (JSON Schema):
```json
{
  "type": "object",
  "properties": {
    "url": { "type": "string", "description": "Webhook URL" },
    "method": { "type": "string", "enum": ["GET", "POST"] },
    "body": { "type": "object" }
  },
  "required": ["url"]
}
```
- Target Event Type: `job:send_webhook`
- æœ‰åŠ¹åŒ– + ã‚°ãƒ­ãƒ¼ãƒãƒ«è¨­å®š

**2. LLMãŒFunction Callã‚’ä½¿ç”¨ï¼ˆFrontendï¼‰**

```javascript
import { AIService } from './services/ai/AIService'

const { data } = await AIService.chat({
  provider: 'openai',
  prompt: 'Send a webhook to https://example.com with message "Hello"',
  enableFunctionCalling: true,  // Function Callingæœ‰åŠ¹åŒ–
})

// â†’ LLMãŒ send_webhook ã‚’å‘¼ã³å‡ºã—
// â†’ system_events ã« 'job:send_webhook' ç™»éŒ²
// â†’ Job SystemãŒå‡¦ç†å®Ÿè¡Œï¼ˆJob HandlerãŒå¿…è¦ï¼‰
```

**3. å®Ÿè¡Œãƒ­ã‚¸ãƒƒã‚¯ã‚’å®Ÿè£…ï¼ˆJob Handlerï¼‰**

```typescript
// supabase/functions/execute-async-job/handlers.ts
export const jobHandlers: Record<string, JobHandler> = {
  'send_webhook': async (params, context) => {
    // Webhookã‚’å®Ÿéš›ã«é€ä¿¡
    const response = await fetch(params.url, {
      method: params.method || 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(params.body),
    })

    return {
      success: response.ok,
      result: { status: response.status },
    }
  },
}
```

**4. å®Ÿè¡Œãƒ­ã‚°ã‚’ç¢ºèª**

`/admin/function-calls` ã«ã‚¢ã‚¯ã‚»ã‚¹:
- æˆåŠŸ/å¤±æ•—
- å¼•æ•°ãƒ»çµæœ
- å®Ÿè¡Œæ™‚é–“
- LLMå‘¼ã³å‡ºã—ã¨ã®ç´ä»˜ã‘

### 11.5. ã‚µãƒ³ãƒ—ãƒ«é–¢æ•°ï¼ˆSeedæ¸ˆã¿ï¼‰

Akatsukiã«ã¯5ã¤ã®ã‚µãƒ³ãƒ—ãƒ«Functionå®šç¾©ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ï¼š

| é–¢æ•°å | èª¬æ˜ | Event Type |
|--------|------|------------|
| `send_webhook` | Webhooké€ä¿¡ | `job:send_webhook` |
| `query_database` | DBã‚¯ã‚¨ãƒªå®Ÿè¡Œ | `job:query_database` |
| `send_notification` | é€šçŸ¥é€ä¿¡ | `job:send_notification` |
| `generate_image` | AIç”»åƒç”Ÿæˆ | `job:generate_image` |
| `aggregate_data` | ãƒ‡ãƒ¼ã‚¿é›†è¨ˆ | `job:aggregate_data` |

ã“ã‚Œã‚‰ã¯å‚è€ƒå®Ÿè£…ã§ã™ã€‚å®Ÿéš›ã®å®Ÿè¡Œãƒ­ã‚¸ãƒƒã‚¯ã¯åˆ¥é€”å®Ÿè£…ã—ã¦ãã ã•ã„ã€‚

### 11.6. VibeCodingã§ã®æ‹¡å¼µ

**æ–°ã—ã„Functionã‚’è¿½åŠ ã™ã‚‹å ´åˆ:**

1. Admin UIã§æ–°ã—ã„Functionå®šç¾©ã‚’ä½œæˆ
2. Job Handlerã«å®Ÿè¡Œãƒ­ã‚¸ãƒƒã‚¯ã‚’å®Ÿè£…
3. ãƒ‡ãƒ—ãƒ­ã‚¤

```typescript
// supabase/functions/execute-async-job/handlers.ts ã«è¿½åŠ 
export const jobHandlers: Record<string, JobHandler> = {
  // æ—¢å­˜...

  'my_custom_function': async (params, context) => {
    // ç‹¬è‡ªå‡¦ç†ã‚’å®Ÿè£…
    return { success: true, result: { ... } }
  },
}
```

### 11.7. ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ä¾‹

**1. ã‚·ãƒ³ãƒ—ãƒ«ãªã‚¢ãƒ—ãƒªï¼ˆé–‹ç™ºè€…ãŒé–¢æ•°å®šç¾©ï¼‰**
- Functionå®šç¾©: Admin UIã§ç®¡ç†
- å®Ÿè¡Œãƒ­ã‚¸ãƒƒã‚¯: Job Handlerã«ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰
- ç”¨é€”: è‡ªç¤¾ã‚¢ãƒ—ãƒªã®AIæ©Ÿèƒ½å¼·åŒ–

**2. LLM Platformï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒé–¢æ•°ç™»éŒ²ï¼‰**
- Functionå®šç¾©: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒUIçµŒç”±ã§ç™»éŒ²
- å®Ÿè¡Œãƒ­ã‚¸ãƒƒã‚¯: Webhook (Out) ã§å¤–éƒ¨é€£æº
- ç”¨é€”: Zapier/Make.comçš„ãªãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ 

**3. ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰**
- ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°: ç®¡ç†è€…ãŒå®šç¾©
- ãƒ¦ãƒ¼ã‚¶ãƒ¼é–¢æ•°: å„ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒç‹¬è‡ªã«è¿½åŠ 
- ç”¨é€”: ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºAIãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ 

### 11.8. ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

**Functionå®šç¾©:**
- âœ… æ˜ç¢ºãªè²¬å‹™ï¼ˆ1 Function = 1æ©Ÿèƒ½ï¼‰
- âœ… JSON Schema ã§ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å³å¯†ã«å®šç¾©
- âœ… `target_event_type` ã¯ `job:` ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ã‚’ä½¿ç”¨

**å®Ÿè¡Œãƒ­ã‚¸ãƒƒã‚¯:**
- âœ… Job Handler ã§ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
- âœ… é€²æ—æ›´æ–°ï¼ˆé•·æ™‚é–“å‡¦ç†ã®å ´åˆï¼‰
- âœ… ç›£æŸ»ãƒ­ã‚°ã‚’æ´»ç”¨

**ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£:**
- âœ… RLSã§Functionå®šç¾©ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹åˆ¶é™
- âœ… å±é™ºãªæ“ä½œã¯Adminå°‚ç”¨ã«ã™ã‚‹
- âœ… function_call_logs ã§å…¨å®Ÿè¡Œã‚’è¨˜éŒ²

### 11.9. ç®¡ç†ç”»é¢

**Functionå®šç¾©ç®¡ç†:** `/admin/function-definitions`
- Functionä¸€è¦§ãƒ»ä½œæˆãƒ»ç·¨é›†ãƒ»å‰Šé™¤
- JSON Schemaç·¨é›†
- æœ‰åŠ¹/ç„¡åŠ¹åˆ‡ã‚Šæ›¿ãˆ
- Global/Useråˆ‡ã‚Šæ›¿ãˆ

**å®Ÿè¡Œãƒ­ã‚°é–²è¦§:** `/admin/function-calls`
- å®Ÿè¡Œå±¥æ­´ä¸€è¦§
- ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ï¼ˆFunctionåã€ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ï¼‰
- è©³ç´°è¡¨ç¤ºï¼ˆå¼•æ•°ã€çµæœã€ã‚¨ãƒ©ãƒ¼ï¼‰
- çµ±è¨ˆæƒ…å ±

---

**å®‰è¼ï¼ˆã‚ãï¼‰ã‚ˆã‚Š:**

ã“ã® `AGENT.md` ãŒã€ç§ãŸã¡ã®ã€ŒAkatsukiã€ã®å®‰å®šæ€§ã¨è¼ãã‚’æ”¯ãˆã‚‹åŸºç›¤ã¨ãªã‚Šã¾ã™ã€‚
ãƒ«ãƒ¼ãƒ«ã‚’å®ˆã‚ŠãªãŒã‚‰ã€æœ€é€Ÿã§ä¾¡å€¤ã‚’å±Šã‘ã¾ã—ã‚‡ã†ï¼ ğŸš€
