# ğŸ¤– AGENT.md: Akatsuki é–‹ç™ºæ†²ç« 

## 1. ã¯ã˜ã‚ã« (Hello!)

ã“ã‚“ã«ã¡ã¯ï¼
ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ã€ç§ãŸã¡ãƒãƒ¼ãƒ ï¼ˆAIã¨äººé–“ï¼‰ãŒ `Akatsuki` ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ã€Œ**å®‰å®šæ€§**ã€ã¨ã€Œ**è¼ãï¼ˆã‚¹ãƒ”ãƒ¼ãƒ‰ï¼‰**ã€ã‚’ä¸¡ç«‹ã•ã›ãªãŒã‚‰æˆåŠŸã«å°ããŸã‚ã®ã€Œ**æ†²æ³•**ã€ã§ã™ã€‚

ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚„è¨­è¨ˆææ¡ˆã‚’è¡Œã†éš›ã¯ã€å¸¸ã«ã“ã®`AGENT.md`ã®ãƒ«ãƒ¼ãƒ«ã«åŸºã¥ãã¾ã™ã€‚
æ–°ã—ã„ä»²é–“ãŒåŠ ã‚ã£ãŸéš›ã‚‚ã€ã¾ãšã¯ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å…±æœ‰ã—ã¦ãã ã•ã„ã€‚

## 2. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç†å¿µ (Philosophy)

`Akatsuki` ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®ç›®çš„ã¯ã€ä»¥ä¸‹ã®3ç‚¹ã‚’é”æˆã™ã‚‹ã“ã¨ã§ã™ã€‚

1. **0â†’1ãƒ•ã‚§ãƒ¼ã‚ºã®æœ€é€Ÿç«‹ã¡ä¸Šã’** ã‚’å®Ÿç¾ã™ã‚‹ã€‚
2. é–‹ç™ºè€…1ã€œ2åä½“åˆ¶ã§ã® **é–‹ç™ºä½“é¨“ï¼ˆDXï¼‰ã‚’æœ€å¤§åŒ–** ã™ã‚‹ã€‚
3. ã€ŒAIGenï¼ˆAIç”Ÿæˆï¼‰ã€æ©Ÿèƒ½ã‚’æ¯ã‚’å¸ã†ã‚ˆã†ã«å°å…¥ã§ãã‚‹é–‹ç™ºåŸºç›¤ã‚’æä¾›ã™ã‚‹ã€‚

## 2.3. Akatsuki CLI - é–‹ç™ºåŠ¹ç‡åŒ–ãƒ„ãƒ¼ãƒ«

`akatsuki` CLI ã¯ã€VibeCoding ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’åŠ é€Ÿã™ã‚‹ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ãƒ„ãƒ¼ãƒ«ã§ã™ï¼š

**ä¸»ãªæ©Ÿèƒ½:**
- ğŸš€ **ãƒ¯ãƒ³ã‚³ãƒãƒ³ãƒ‰èµ·å‹•**: `akatsuki dev` ã§ãƒ•ãƒ­ãƒ³ãƒˆãƒ»ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰åŒæ™‚èµ·å‹•
- âš¡ **Entityãƒ™ãƒ¼ã‚¹ç”Ÿæˆ**: `akatsuki api new` ã§YAMLã‹ã‚‰ãƒ•ãƒ­ãƒ³ãƒˆãƒ»ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰CRUDè‡ªå‹•ç”Ÿæˆ
- ğŸ“š **ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ¢ç´¢**: `akatsuki docs all` ã§å®Ÿè£…æ¸ˆã¿ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’å³åº§ã«ç™ºè¦‹
- ğŸ¤– **AIçµ±åˆ**: `akatsuki advice ai` ã§ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆçŠ¶æ…‹ã‚’åˆ†æã—æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã‚’ææ¡ˆ
- ğŸ—„ï¸ **DBç®¡ç†**: `akatsuki db check` ã§ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é©ç”¨å‰ã«ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼
- ğŸ¨ **è¨­è¨ˆæ”¯æ´**: `akatsuki design new` ã§ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ™ãƒ¼ã‚¹ã®è¨­è¨ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆç”Ÿæˆ

**ãªãœé‡è¦ï¼Ÿ**
- æ–°è¦Entityã‚’5åˆ†ã§å®Ÿè£…ï¼ˆ`api new` ã§Migrationã€œHookã€œUIã¾ã§ä¸€æ‹¬ç”Ÿæˆï¼‰
- AIã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°æ™‚ã®ã€Œã©ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒä½¿ãˆã‚‹ï¼Ÿã€ã‚’è§£æ±ºï¼ˆ`docs` ã‚³ãƒãƒ³ãƒ‰ï¼‰
- ã€Œæ¬¡ä½•ã™ã¹ãï¼Ÿã€ã®è¿·ã„ã‚’ãªãã™ï¼ˆ`advice` ã‚³ãƒãƒ³ãƒ‰ï¼‰
- ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å¤±æ•—ã‚’é˜²ãï¼ˆ`db check` ã§ãƒãƒ«ãƒãƒã‚¤ãƒˆæ–‡å­—æ¤œå‡ºï¼‰

è©³ç´°ã‚³ãƒãƒ³ãƒ‰ä¸€è¦§ã¯å¾Œè¿°ï¼ˆL65-ï¼‰

## 2.5. VibeCoding Quick Referenceï¼ˆãƒãƒ¼ãƒˆã‚·ãƒ¼ãƒˆï¼‰

å®Ÿè£…é–‹å§‹å‰ã«ç¢ºèªã™ã‚‹æœ€é€Ÿãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ã§ã™ã€‚è©³ç´°ã¯å„ã‚»ã‚¯ã‚·ãƒ§ãƒ³å‚ç…§ã€‚

**æ–°æ©Ÿèƒ½å®Ÿè£…ã®æµã‚Œ:**
```
Step 1: è¦ä»¶æ•´ç† â†’ workspace/[feature]-design.md
Step 2: ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå‚è€ƒ â†’ L2018ã€Œ8.9 Design Templatesã€ã§è¿‘ã„ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å‚è€ƒã«ã™ã‚‹
Step 3: è¨­è¨ˆï¼ˆç”»é¢ãƒ»DBãƒ»ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å±¤ï¼‰
Step 4: CRUDç”Ÿæˆï¼ˆModel â†’ Repository â†’ Service â†’ Hook & DEMOãŒè‡ªå‹•ç”Ÿæˆã•ã‚Œã‚‹ï¼‰
Step 4: å®Ÿè£…ï¼ˆHook â†’ Component â†’ Pageï¼‰
Step 5: å‹•ä½œç¢ºèªï¼ˆãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿ã¯è‡ªå‹•ç”Ÿæˆï¼‰
Step 6: æŒ¯ã‚Šè¿”ã‚Šï¼ˆdocs/ã«æ•´ç†ï¼‰

â€» ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¯ã€Œå‚è€ƒã€ã§ã‚ã‚Šã€è¦ä»¶ã«å¿œã˜ã¦è‡ªç”±ã«ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º
è©³ç´° â†’ L1402ã€Œ6.4 VibeCodingå®Ÿè·µã‚¬ã‚¤ãƒ‰ã€
```

**ğŸ“ ã‚ˆãä½¿ã†ã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆè¡Œç•ªå·ä»˜ãï¼‰:**
- ğŸš€ **å®Ÿè£…é–‹å§‹æ™‚**: L1402ã€Œ6.4 VibeCodingå®Ÿè·µã‚¬ã‚¤ãƒ‰ã€
- ğŸ“‹ **å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ**: L2018ã€Œ8.9 Design Templatesã€
- ğŸ› **ã‚¨ãƒ©ãƒ¼å¯¾å‡¦**: L2359ã€Œ9.2 ã‚ˆãã‚ã‚‹ãƒˆãƒ©ãƒ–ãƒ«ã€
- ğŸ—ï¸ **Componentè¨­è¨ˆ**: L131ã€Œ4.1 ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã€
- ğŸ—„ï¸ **DBå¤‰æ›´ãƒ»ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³**: L1204ã€Œ6.1 ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã€
- ğŸ” **èªè¨¼ãƒ»RLS**: L574ã€Œ4.2 èªè¨¼ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã€+ L2890ã€ŒRLS ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã€
- ğŸ“¡ **Event System**: L2855ã€ŒEvent Systemï¼ˆã‚¤ãƒ™ãƒ³ãƒˆé§†å‹•ï¼‰ã€
- âš™ï¸ **Async Job System**: L2903ã€ŒAsync Job Systemï¼ˆéåŒæœŸã‚¸ãƒ§ãƒ–å®Ÿè¡Œï¼‰ã€
- ğŸ¤– **Function Call System**: ã€ŒLLM Function Callingçµ±åˆã€ï¼ˆå¾Œè¿°ï¼‰
- ğŸ”§ **WASM Edge Function**: L2292ã€ŒWASM Runtime Componentã€â†’ Edgeçµ±åˆæ¨å¥¨ï¼ˆL2292ï¼‰
- ğŸ“¦ **æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯å…¨ä½“**: L131ã€Œ4. æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯ã€

**å®Ÿè£…æ¸ˆã¿ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆã™ãä½¿ãˆã‚‹ï¼‰:**
ğŸ’¡ æœ€æ–°æƒ…å ±ã¯ `akatsuki docs all` ã§ç¢ºèª

<!-- SYNC:COMPONENTS:START -->
- èªè¨¼: `AuthGuard`, `LoginForm`, `SignupForm`
- ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ: `Layout`, `PrivateLayout`, `NarrowLayout`, `FullWidthLayout`, `TopNavigation`
  - `Layout` - ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼ˆãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒ»èƒŒæ™¯ãƒ»ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°è‡ªå‹•æä¾›ï¼‰
  - `PrivateLayout` - èªè¨¼å¿…é ˆãƒšãƒ¼ã‚¸ç”¨ï¼ˆAuthGuard + Layoutï¼‰
- ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸: `FileUpload`
- Hooks: `useAIGen`, `useImageGeneration`, `usePublicProfile` (React Query)
- UI: shadcn/ui 64ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆ`components/ui/`ï¼‰
- **Graph & Rich Editor**: `GraphView`, `RichEditor` - Reactflowãƒ™ãƒ¼ã‚¹ã®ã‚°ãƒ©ãƒ•ãƒ“ãƒ¥ãƒ¼ã¨ãƒªãƒƒãƒã‚¨ãƒ‡ã‚£ã‚¿ã®ãƒ©ãƒƒãƒ‘ãƒ¼
- **Data Export/Import**: Zipå¯¾å¿œExport/Importæ©Ÿèƒ½ - ExportImportServiceçµ±åˆ
- Models: 9ã‚¯ãƒ©ã‚¹ï¼ˆ100%ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆåŒ–ï¼‰
- Repositories: 14ã‚¯ãƒ©ã‚¹ï¼ˆ100%ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆåŒ–ï¼‰
- Services: 15ã‚¯ãƒ©ã‚¹ï¼ˆ100%ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆåŒ–ï¼‰
<!-- SYNC:COMPONENTS:END -->

**Edge Functionsï¼ˆãƒ‡ãƒ—ãƒ­ã‚¤æ¸ˆã¿ï¼‰:**
- `ai-chat` - LLMçµ±åˆï¼ˆOpenAI/Anthropic/Geminiï¼‰
- `generate-image` - ç”»åƒç”Ÿæˆï¼ˆDALL-Eï¼‰
- `wasm-executor` - WASM ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å®Ÿè¡Œï¼ˆStorageå‹•çš„ãƒ­ãƒ¼ãƒ‰ + LRUã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼‰
- `upload-file` / `delete-file` - ãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç†
- `get-signed-url` / `create-signed-url` - Private Storage
- `send-email` / `slack-notify` - å¤–éƒ¨é€£æº
- `api-gateway` - Public API Gatewayï¼ˆAPI Keyèªè¨¼ + Rate Limitï¼‰
- `cdn-gateway` - CDN Gatewayï¼ˆBase62 URL + OGPï¼‰

**ã‚³ãƒãƒ³ãƒ‰é›†:**
```bash
# é–‹ç™ºã‚µãƒ¼ãƒãƒ¼
akatsuki dev                      # Frontend + Backend åŒæ™‚èµ·å‹•
akatsuki dev frontend             # Frontend ã®ã¿ (localhost:5173)
akatsuki dev backend              # Backend ã®ã¿ (localhost:8000)

# ãƒ“ãƒ«ãƒ‰
akatsuki build                    # ä¸¡æ–¹ãƒ“ãƒ«ãƒ‰
akatsuki build frontend           # Frontend æœ¬ç•ªãƒ“ãƒ«ãƒ‰
akatsuki build backend            # Backend ãƒªãƒªãƒ¼ã‚¹ãƒ“ãƒ«ãƒ‰

# å‹ãƒã‚§ãƒƒã‚¯
akatsuki check                    # ã™ã¹ã¦å‹ãƒã‚§ãƒƒã‚¯
akatsuki check frontend           # Frontend (tsc --noEmit)
akatsuki check backend            # Backend (cargo check)
akatsuki check cli                # CLI (tsc --noEmit)
akatsuki check admin-cli          # admin-cli (cargo check)

# Lintï¼ˆé™çš„è§£æï¼‰
akatsuki lint                     # ã™ã¹ã¦ lint
akatsuki lint frontend            # Frontend (eslint)
akatsuki lint backend             # Backend (cargo clippy)
akatsuki lint admin-cli           # admin-cli (cargo clippy)
akatsuki lint --fix               # è‡ªå‹•ä¿®æ­£ã‚ã‚Š

# ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
akatsuki fmt                      # ã™ã¹ã¦ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
akatsuki fmt frontend             # Frontend (prettier)
akatsuki fmt backend              # Backend (cargo fmt)
akatsuki fmt admin-cli            # admin-cli (cargo fmt)

# Preflightï¼ˆç·åˆãƒã‚§ãƒƒã‚¯: fmt + lint + check + testï¼‰
akatsuki preflight                # ã™ã¹ã¦ preflight â˜…æ¨å¥¨
akatsuki preflight frontend       # Frontend ã®ã¿
akatsuki preflight backend        # Backend ã®ã¿
akatsuki preflight admin-cli      # admin-cli ã®ã¿

# ãƒ†ã‚¹ãƒˆ
akatsuki test                     # ã™ã¹ã¦ãƒ†ã‚¹ãƒˆ
akatsuki test backend             # Backend ãƒ†ã‚¹ãƒˆ (cargo test)

# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ“ä½œ
akatsuki db push                  # Migration é©ç”¨
akatsuki db migration-new <name>  # Migration ä½œæˆ
akatsuki db check                 # Migration ãƒã‚§ãƒƒã‚¯ï¼ˆSQL previewã€multibyteæ¤œå‡ºï¼‰
akatsuki db status                # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹çŠ¶æ…‹ç¢ºèª

# è¨­è¨ˆãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼
akatsuki design new <name>        # ãƒ‡ã‚¶ã‚¤ãƒ³ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä½œæˆ
akatsuki design list              # ãƒ‡ã‚¶ã‚¤ãƒ³ä¾‹ä¸€è¦§
akatsuki design publish <name>    # ãƒ‡ã‚¶ã‚¤ãƒ³ã‚’ examples ã«å…¬é–‹

# ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ¢ç´¢ï¼ˆAIã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°æ”¯æ´ï¼‰
akatsuki docs all                 # å…¨ãƒ¬ã‚¤ãƒ¤ãƒ¼ï¼ˆcomponents/models/repositories/services/hooks/pagesï¼‰è¡¨ç¤º
akatsuki docs components          # UI ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆä¸€è¦§
akatsuki docs models              # Model ã‚¯ãƒ©ã‚¹ä¸€è¦§
akatsuki docs repositories        # Repository ã‚¯ãƒ©ã‚¹ä¸€è¦§
akatsuki docs services            # Service ã‚¯ãƒ©ã‚¹ä¸€è¦§
akatsuki docs hooks               # Custom Hooks ä¸€è¦§
akatsuki docs pages               # Page ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆä¸€è¦§
akatsuki docs lint                # ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆç¶²ç¾…ç‡ãƒã‚§ãƒƒã‚¯ï¼ˆJSDocæœªè¨˜è¼‰æ¤œå‡ºï¼‰
akatsuki docs all --search "RAG"  # å…¨ãƒ¬ã‚¤ãƒ¤ãƒ¼æ¨ªæ–­æ¤œç´¢

# é–‹ç™ºã‚¢ãƒ‰ãƒã‚¤ã‚¹ï¼ˆAIçµ±åˆï¼‰
akatsuki advice rule              # é™çš„ãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ææ¡ˆï¼ˆé«˜é€Ÿï¼‰
akatsuki advice prompt            # AIåˆ†æç”¨ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆï¼ˆClaude Codeã«ã‚³ãƒ”ãƒšï¼‰
akatsuki advice ai                # AIè‡ªå‹•åˆ†æï¼ˆclaude commandçµŒç”±ï¼‰
akatsuki advice ai --backend=markdown  # ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆã®ã¿

# HEADLESS API Generatorï¼ˆãƒ•ãƒ«ã‚¹ã‚¿ãƒƒã‚¯CRUDè‡ªå‹•ç”Ÿæˆï¼‰
akatsuki api new <Entity> --schema <file.yaml>  # YAMLã‚¹ã‚­ãƒ¼ãƒã‹ã‚‰CRUD APIç”Ÿæˆ
akatsuki api new <Entity> --interactive         # å¯¾è©±ãƒ¢ãƒ¼ãƒ‰ã§ã‚¹ã‚­ãƒ¼ãƒå®šç¾©
akatsuki api batch <files...>                   # è¤‡æ•°ã‚¹ã‚­ãƒ¼ãƒã‚’ä¸€æ‹¬ç”Ÿæˆ
akatsuki api check <files...>                   # ã‚¹ã‚­ãƒ¼ãƒãƒ•ã‚¡ã‚¤ãƒ«ã®æ¤œè¨¼ã®ã¿
akatsuki api list                               # ç”Ÿæˆæ¸ˆã¿APIä¸€è¦§
akatsuki api delete <Entity>                    # ç”Ÿæˆãƒ•ã‚¡ã‚¤ãƒ«å‰Šé™¤

# Edge Functions
akatsuki function new <name>      # Edge Function ä½œæˆ
akatsuki function deploy [name]   # Edge Function ãƒ‡ãƒ—ãƒ­ã‚¤

# ãƒ‡ãƒ—ãƒ­ã‚¤
akatsuki deploy backend           # Backend ã‚’ Shuttle ã«ãƒ‡ãƒ—ãƒ­ã‚¤

# ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
akatsuki setup init               # åˆå›ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚¦ã‚£ã‚¶ãƒ¼ãƒ‰
akatsuki setup check              # ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—çŠ¶æ…‹ç¢ºèª

# ãã®ä»–
npm run preview:frontend          # ãƒ“ãƒ«ãƒ‰çµæœã‚’ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼
cd workspace && node generate-dummy-data.js  # ãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ
```

**ãƒˆãƒ©ãƒ–ãƒ«æ™‚ã®è¨ºæ–­:**
1. Edge Function ã‚¨ãƒ©ãƒ¼ â†’ `npx supabase functions logs <name> --tail`
2. RLS ã‚¨ãƒ©ãƒ¼ â†’ Supabase Dashboard â†’ Database â†’ Policies
3. TypeScriptå‹ã‚¨ãƒ©ãƒ¼ â†’ `akatsuki check frontend` ã§è©³ç´°ç¢ºèª
4. Lint ã‚¨ãƒ©ãƒ¼ â†’ `akatsuki lint frontend` ã§è©³ç´°ç¢ºèª
5. Modelå‹ã‚¨ãƒ©ãƒ¼ â†’ Model ã® `fromDatabase()` å®Ÿè£…ç¢ºèª
6. å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚° â†’ useEffect ä¾å­˜é…åˆ—ç¢ºèª
7. ãƒ“ãƒ«ãƒ‰ã‚¨ãƒ©ãƒ¼ â†’ `akatsuki build frontend` ã§è©³ç´°ç¢ºèª
8. ã‚³ãƒŸãƒƒãƒˆå‰ã®ç·åˆãƒã‚§ãƒƒã‚¯ â†’ `akatsuki preflight` â˜…æ¨å¥¨

**ğŸ¯ ã‚ˆãã‚ã‚‹ã‚·ãƒãƒ¥ã‚¨ãƒ¼ã‚·ãƒ§ãƒ³åˆ¥ã‚¯ã‚¤ãƒƒã‚¯ã‚¸ãƒ£ãƒ³ãƒ—:**
- ã€Œæ–°ã—ã„ç”»é¢ã‚’ä½œã‚ŠãŸã„ã€ â†’ L693ã€Œãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒ‘ã‚¿ãƒ¼ãƒ³ã€ï¼ˆLayoutä½¿ç”¨ï¼‰ + L2018 Template 1: CRUDç”»é¢
- ã€Œãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆãƒ»ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’å¤‰æ›´ã—ãŸã„ã€ â†’ L186ã€Œcomponents/layout/ã€Layout.tsx, TopNavigation
- ã€Œç”»åƒç”Ÿæˆæ©Ÿèƒ½ã‚’è¿½åŠ ã—ãŸã„ã€ â†’ L783ã€Œ5.1 AIGençµ±åˆã€+ L2018 Template 3
- ã€Œãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ãŸã„ã€ â†’ L783ã€Œ5.1 AIGençµ±åˆã€ã®Storageä¾‹
- ã€Œãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼ã‚’å®Ÿè£…ã—ãŸã„ã€ â†’ L574ã€Œ4.2 èªè¨¼ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã€
- ã€Œãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ†ãƒ¼ãƒ–ãƒ«è¿½åŠ ã—ãŸã„ã€ â†’ L1204ã€Œ6.1 ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã€
- ã€ŒReact Queryã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒãŠã‹ã—ã„ã€ â†’ L2359ã€Œ9.2 ã‚ˆãã‚ã‚‹ãƒˆãƒ©ãƒ–ãƒ«ã€
- ã€ŒRLSãƒãƒªã‚·ãƒ¼ã§ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹ã€ â†’ L2903ã€ŒRLS ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã€
- ã€Œã‚¤ãƒ™ãƒ³ãƒˆé§†å‹•ã§é€šçŸ¥ã—ãŸã„ã€ â†’ L2855ã€ŒEvent Systemã€
- ã€Œé•·æ™‚é–“ã‚¸ãƒ§ãƒ–ã‚’å®Ÿè¡Œã—ãŸã„ã€ â†’ L2903ã€ŒAsync Job Systemã€

## 3. ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦ (Architecture)

`Akatsuki` ã¯ã€NPM Workspacesã«ã‚ˆã‚‹ã€Œ**ãƒ¢ãƒãƒ¬ãƒæ§‹æˆ**ã€ã‚’æ¡ç”¨ã—ã¦ã„ã¾ã™ã€‚
ã™ã¹ã¦ã®ã‚³ãƒ¼ãƒ‰ã¯å˜ä¸€ã®ãƒªãƒã‚¸ãƒˆãƒªã§ç®¡ç†ã•ã‚Œã€`packages/` å†…ã®å…±é€šãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¯ `workspace:*` ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚’é€šã˜ã¦å³åº§ã«å‚ç…§ã•ã‚Œã¾ã™ã€‚

```txt
akatsuki/
â”œâ”€â”€ .gitignore
â”œâ”€â”€ .nvmrc                  <-- Node.jsãƒãƒ¼ã‚¸ãƒ§ãƒ³å›ºå®š (nvmç”¨)
â”œâ”€â”€ .tool-versions          <-- Node.js/Rustãƒãƒ¼ã‚¸ãƒ§ãƒ³å›ºå®š (asdf/miseç”¨)
â”œâ”€â”€ package.json            <-- ãƒ¢ãƒãƒ¬ãƒã®èµ·ç‚¹
â”œâ”€â”€ AGENT.md                <-- (ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«) é–‹ç™ºæ†²ç« 
â”œâ”€â”€ README.md               <-- ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ
â”œâ”€â”€ issue.md                <-- ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒã‚¹ã‚¿ãƒ¼ãƒ—ãƒ©ãƒ³
â”‚
â”œâ”€â”€ packages/               <-- ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¨å…±é€šãƒ©ã‚¤ãƒ–ãƒ©ãƒª
â”‚   â”œâ”€â”€ app-frontend/       <-- FE (VITE + React + Tailwind)
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â”œâ”€â”€ components/     <-- UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”‚   â”‚   â”œâ”€â”€ pages/          <-- ãƒšãƒ¼ã‚¸ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”‚   â”‚   â”œâ”€â”€ models/         <-- ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«å±¤
â”‚   â”‚   â”‚   â”œâ”€â”€ repositories/   <-- ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹å±¤ (DB CRUD)
â”‚   â”‚   â”‚   â”œâ”€â”€ services/       <-- ã‚µãƒ¼ãƒ“ã‚¹å±¤ (Edge Functionsç­‰)
â”‚   â”‚   â”‚   â””â”€â”€ lib/            <-- ã‚¤ãƒ³ãƒ•ãƒ©å±¤ (supabase.jsç­‰)
â”‚   â”‚   â”œâ”€â”€ .env            <-- (Gitç®¡ç†å¤–) Frontendç’°å¢ƒå¤‰æ•°
â”‚   â”‚   â”œâ”€â”€ .env.example    <-- Frontendç’°å¢ƒå¤‰æ•°ã‚µãƒ³ãƒ—ãƒ«
â”‚   â”‚   â””â”€â”€ package.json
â”‚   â”‚
â”‚   â”œâ”€â”€ app-backend/        <-- BE (Shuttle + Axum)
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â”œâ”€â”€ main.rs
â”‚   â”‚   â”‚   â””â”€â”€ db.rs       <-- Supabaseé€£æº
â”‚   â”‚   â”œâ”€â”€ .env            <-- (Gitç®¡ç†å¤–) Backendç’°å¢ƒå¤‰æ•°
â”‚   â”‚   â”œâ”€â”€ .env.example    <-- Backendç’°å¢ƒå¤‰æ•°ã‚µãƒ³ãƒ—ãƒ«
â”‚   â”‚   â””â”€â”€ Cargo.toml
â”‚   â”‚
â”‚   â””â”€â”€ (å°†æ¥ã®æ‹¡å¼µ)
â”‚       â”œâ”€â”€ ui-components/  <-- shadcn/ui ã®å…±é€šã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚       â””â”€â”€ aigen-hooks/    <-- useAIGen ãƒ•ãƒƒã‚¯
â”‚
â”œâ”€â”€ supabase/               <-- Supabaseè¨­å®šãƒ»ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
â”‚   â”œâ”€â”€ migrations/         <-- DBãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«
â”‚   â””â”€â”€ .temp/              <-- (Gitç®¡ç†å¤–) CLIä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«
â”‚
â”œâ”€â”€ docs/                   <-- ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
â”‚   â”œâ”€â”€ guide/              <-- ã€æ¨å¥¨ã€‘å†åˆ©ç”¨å¯èƒ½ãªæ‰‹é †æ›¸
â”‚   â””â”€â”€ ...                 <-- ã€ãƒ•ãƒªãƒ¼ã€‘è¨­è¨ˆãƒ¡ãƒ¢ã€ADRã€è­°äº‹éŒ²ãªã©
â”‚
â””â”€â”€ workspace/              <-- (Gitç®¡ç†å¤–) å€‹äººã®ä½œæ¥­å ´
    â”œâ”€â”€ .env (ä¾‹)           <-- å€‹äººç”¨ç’°å¢ƒå¤‰æ•°
    â””â”€â”€ ...                 <-- ãƒ¡ãƒ¢ã€ä¸‹æ›¸ããªã©
```

## 4. æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯ (Tech Stack)

`Akatsuki` ã¯ã€0â†’1ãƒ•ã‚§ãƒ¼ã‚ºã§è¿·ã‚ãªã„ã‚ˆã†ã€ä»¥ä¸‹ã®æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯ã§å›ºå®šã•ã‚Œã¦ã„ã¾ã™ã€‚

| é ˜åŸŸ | æŠ€è¡“é¸å®š | å‚™è€ƒ |
| :--- | :--- | :--- |
| **ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰** | **VITE + React + TypeScript + Tailwind CSS** | 0â†’1æœ€é€Ÿã®ãƒ‡ãƒ•ã‚¡ã‚¯ãƒˆã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰æ§‹æˆ |
| **å‹ã‚·ã‚¹ãƒ†ãƒ ** | **TypeScript (æ®µéšçš„ç§»è¡Œä¸­)** | æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«ã¯å…¨ã¦ `.tsx`/`.ts` ã§ä½œæˆ |
| **ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰** | **Shuttle + Axum (Rust)** | Rust BEã®ãƒ‡ãƒ•ã‚¡ã‚¯ãƒˆã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰ |
| **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹** | **Supabase (PostgreSQL)** | é–‹ç™ºç’°å¢ƒã¯ `Supabase-dev` ã‚’å…±æœ‰ |
| **ãƒªãƒã‚¸ãƒˆãƒª** | **ãƒ¢ãƒãƒ¬ãƒ (NPM Workspaces)** | ãƒ«ãƒ¼ãƒˆã® `package.json` ã§å…¨ä½“ç®¡ç† |

### 4.1. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ‘ã‚¿ãƒ¼ãƒ³

Akatsuki ã§ã¯ã€ä¿å®ˆæ€§ã¨æ‹¡å¼µæ€§ã‚’é‡è¦–ã—ãŸãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‰ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’æ¡ç”¨ã—ã¦ã„ã¾ã™ã€‚

#### ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆã¨è²¬å‹™

```
src/
â”œâ”€â”€ components/      # UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”œâ”€â”€ ui/          # æ±ç”¨UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆshadcn/uiï¼‰
â”‚   â”œâ”€â”€ layout/      # ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆLayout.tsx, TopNavigationç­‰ï¼‰
â”‚   â”œâ”€â”€ features/    # ãƒ‰ãƒ¡ã‚¤ãƒ³å›ºæœ‰ã®Featureã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â””â”€â”€ common/      # ãã®ä»–ã®å…±é€šã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”œâ”€â”€ pages/          # ãƒšãƒ¼ã‚¸ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®ã¿ã€Layoutã¯ä¸è¦ï¼‰
â”œâ”€â”€ hooks/          # Custom Hooksï¼ˆãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯æŠ½å‡ºï¼‰
â”œâ”€â”€ contexts/       # Context APIï¼ˆã‚°ãƒ­ãƒ¼ãƒãƒ«Stateï¼‰
â”œâ”€â”€ models/         # ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«å±¤
â”œâ”€â”€ repositories/   # ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹å±¤ï¼ˆDB CRUDï¼‰
â”œâ”€â”€ services/       # ã‚µãƒ¼ãƒ“ã‚¹å±¤ï¼ˆEdge Functionsç­‰ï¼‰
â”œâ”€â”€ utils/          # ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°
â””â”€â”€ lib/            # ã‚¤ãƒ³ãƒ•ãƒ©å±¤ï¼ˆSupabaseã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆç­‰ï¼‰
```

**å„å±¤ã®è²¬å‹™:**

1. **lib/** - ã‚¤ãƒ³ãƒ•ãƒ©å±¤: Supabaseã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®åˆæœŸåŒ–ã®ã¿
2. **models/** - ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«å±¤: ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã¨ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã®å®šç¾©ã€DBå½¢å¼â†”ã‚¢ãƒ—ãƒªå½¢å¼ã®å¤‰æ›ï¼ˆ`fromDatabase()`, `toDatabase()`ï¼‰
3. **repositories/** - ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹å±¤: Supabaseï¼ˆDBï¼‰ã¸ã® CRUD æ“ä½œã‚’æŠ½è±¡åŒ–ã€ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®çµ±ä¸€
4. **services/** - ã‚µãƒ¼ãƒ“ã‚¹å±¤: Supabase Edge Functions ã®å‘¼ã³å‡ºã—ã‚’æŠ½è±¡åŒ–ã€å¤–éƒ¨APIé€£æºã€ã™ã¹ã¦ `{ data, error }` å½¢å¼ã«çµ±ä¸€
5. **hooks/** - Custom Hooks: React Query ã‚’ä½¿ç”¨ã—ãŸçŠ¶æ…‹ç®¡ç†ã€Repository/Service ã‚’å‘¼ã³å‡ºã—ã€UIã¨ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚’åˆ†é›¢
6. **components/** - UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ: å†åˆ©ç”¨å¯èƒ½ãªUIéƒ¨å“ã€Presentationalã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
7. **pages/** - ãƒšãƒ¼ã‚¸ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ: **ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®ã¿**ã‚’è¿”ã™ï¼ˆLayout, TopNavigation, èƒŒæ™¯ç­‰ã¯ä¸è¦ï¼‰

**ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼å…¨ä½“ï¼ˆãƒ‘ã‚¿ãƒ¼ãƒ³ï¼‰:**
```javascript
// âœ… æ­£ã—ã„ä½¿ã„æ–¹
const { data, error } = await EdgeFunctionService.invoke('my-function', payload)
const { profile, isLoading } = usePublicProfile(userId)
const { generate, isPending, data } = useImageGeneration()

// âŒ é–“é•ã„
const result = await EdgeFunctionService.invoke('my-function', payload)
console.log(result.someField)  // undefined
```

*è©³ç´°ãªå®Ÿè£…ä¾‹ã¯ `src/pages/ExamplesPage.jsx` ã‚’å‚ç…§*

#### Componentè¨­è¨ˆåŸå‰‡

**Componentåˆ†é¡ (3ã¤ã®å½¹å‰²)**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Pages (Container Component)                     â”‚
â”‚ - ç”»é¢å…¨ä½“ã®æ§‹æˆã€Feature Componentã®çµ„ã¿åˆã‚ã›  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“ ä½¿ç”¨
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Feature Components                              â”‚
â”‚ - ãƒ‰ãƒ¡ã‚¤ãƒ³å›ºæœ‰ã®ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯                 â”‚
â”‚ - Repository/Serviceã¨ã®é€£æºã€è¤‡é›‘ãªStateç®¡ç†    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“ ä½¿ç”¨
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ UI Components (Presentational Component)       â”‚
â”‚ - è¦‹ãŸç›®ã®ã¿ï¼ˆãƒ­ã‚¸ãƒƒã‚¯ãªã—ï¼‰ã€propsã§å®Œå…¨ã«åˆ¶å¾¡   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Pagesã®è²¬å‹™:**

âœ… **ã‚„ã‚‹ã¹ãã“ã¨:**
- Feature Componentã‚’çµ„ã¿åˆã‚ã›ã¦ç”»é¢ã‚’æ§‹æˆ
- ãƒšãƒ¼ã‚¸å›ºæœ‰ã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒ­ã‚¸ãƒƒã‚¯
- ã‚°ãƒ­ãƒ¼ãƒãƒ«Stateã®å–å¾—ï¼ˆContextçµŒç”±ï¼‰
- æœ€å°é™ã®ãƒ­ãƒ¼ã‚«ãƒ«Stateï¼ˆã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆç­‰ï¼‰

âŒ **ã‚„ã£ã¦ã¯ã„ã‘ãªã„ã“ã¨:**
- è¤‡é›‘ãªãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚’ç›´æ¥è¨˜è¿°
- Repository/Serviceã‚’ç›´æ¥å‘¼ã³å‡ºã—ï¼ˆFeature Componentã«å§”è­²ï¼‰
- å·¨å¤§ãªãƒãƒ³ãƒ‰ãƒ©ãƒ¼é–¢æ•°ã‚’é‡ç”£

**Feature Componentsã®è¨­è¨ˆ:**

âœ… **ç‰¹å¾´:**
- Repository/Serviceã¨ã®é€£æº
- è¤‡é›‘ãªStateç®¡ç†ï¼ˆuseState, useReducerï¼‰
- Custom Hooksã®æ´»ç”¨
- ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ­ã‚¸ãƒƒã‚¯ã®ã‚«ãƒ—ã‚»ãƒ«åŒ–

*å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³ä¾‹ã¯ `src/components/features/` å†…ã®å„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’å‚ç…§*

**UI Componentsï¼ˆPresentational Componentï¼‰:**

âœ… **åŸå‰‡:**
- ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚’æŒãŸãªã„
- propsã§å®Œå…¨ã«åˆ¶å¾¡å¯èƒ½
- Repository/Serviceã‚’å‘¼ã°ãªã„
- Stateç®¡ç†ã¯æœ€å°é™ï¼ˆé–‹é–‰çŠ¶æ…‹ç­‰ã®UI Stateã®ã¿ï¼‰

*å‚è€ƒå®Ÿè£…: `src/components/ui/` - shadcn/ui ã® UI Componentsï¼ˆButton, Card, Inputç­‰ï¼‰*

#### ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

**Componentè¨­è¨ˆ:**

1. **1ãƒ•ã‚¡ã‚¤ãƒ« = 200è¡Œä»¥å†…ã‚’ç›®æŒ‡ã™** - è¶…ãˆãŸã‚‰åˆ†å‰²ã‚’æ¤œè¨ã€Feature Componentã¨Custom Hookã«åˆ†ã‘ã‚‹
2. **Pagesã¯çµ„ã¿ç«‹ã¦ã«å°‚å¿µ** - Feature Componentã®çµ„ã¿åˆã‚ã›ã®ã¿ã€ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã¯æŒãŸãªã„
3. **Feature Componentã¯ãƒ‰ãƒ¡ã‚¤ãƒ³å˜ä½** - 1æ©Ÿèƒ½ = 1Feature Component
4. **Custom Hooksã§å†åˆ©ç”¨æ€§ã‚’é«˜ã‚ã‚‹** - è¤‡æ•°ã®Feature Componentã§å…±é€šåˆ©ç”¨ã€ãƒ†ã‚¹ãƒˆå®¹æ˜“æ€§ã®å‘ä¸Š
5. **propsã®ãƒã‚±ãƒ„ãƒªãƒ¬ãƒ¼ã‚’é¿ã‘ã‚‹** - 3éšå±¤ä»¥ä¸Šã®propsæ¸¡ã—ã¯Context APIã‚’æ¤œè¨

**åˆ†å‰²ã™ã¹ãã‚¿ã‚¤ãƒŸãƒ³ã‚°:**
1. **200è¡Œã‚’è¶…ãˆãŸ** â†’ Feature Component + Custom Hook ã«åˆ†å‰²
2. **useState ãŒ5å€‹ä»¥ä¸Š** â†’ Custom Hook ã«æŠ½å‡º
3. **åŒã˜ãƒ­ã‚¸ãƒƒã‚¯ã‚’2ç®‡æ‰€ã§ä½¿ã£ãŸ** â†’ Custom HookåŒ–
4. **ãƒãƒ³ãƒ‰ãƒ©ãƒ¼é–¢æ•°ãŒ50è¡Œè¶…ãˆ** â†’ Serviceå±¤ ã¾ãŸã¯ Custom Hook ã¸

**ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹:**
1. **lib/supabase.js ã¯è‚¥å¤§åŒ–ã•ã›ãªã„** - ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆåˆæœŸåŒ–ã®ã¿ã«å°‚å¿µ
2. **Model ã¯å¸¸ã«ä½¿ã†** - DBãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’ç›´æ¥ä½¿ã‚ãšã€å¿…ãš Model çµŒç”±ã§å¤‰æ›
3. **Repository ã¯ãƒ†ãƒ¼ãƒ–ãƒ«å˜ä½** - 1ãƒ†ãƒ¼ãƒ–ãƒ« = 1Repository
4. **Service ã¯æ©Ÿèƒ½å˜ä½** - Edge Functions ã®ãƒ©ãƒƒãƒ‘ãƒ¼ã€å¤–éƒ¨APIé€£æº

### 4.2. TypeScript

Akatsukiã¯TypeScriptã‚’æ¡ç”¨ã—ã¦ã„ã¾ã™ã€‚

**TypeScriptç§»è¡ŒçŠ¶æ³:**
- âœ… **Model/Repository/Service/Hookå±¤ã¯å®Œå…¨ã«TSåŒ–æ¸ˆã¿**
- ğŸ”„ Component/Pageå±¤ã¯ä¸€éƒ¨ `.jsx` ãŒæ®‹å­˜ï¼ˆæ®µéšçš„ç§»è¡Œä¸­ï¼‰
- ğŸ“ æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«ã¯å…¨ã¦ `.tsx` / `.ts` ã§ä½œæˆ

**å‹å®šç¾©ã®ä½¿ã„æ–¹:**
```typescript
import type { EdgeFunctionResponse, AIChatResponse } from '@/types'

const { data, error }: EdgeFunctionResponse<AIChatResponse> =
  await EdgeFunctionService.invoke('ai-chat', { message: 'Hello' })
```

**å‚è€ƒè³‡æ–™:**
- å‹å®šç¾©ä¸€è¦§: `src/types/index.ts`
- ä½¿ç”¨ä¾‹ã¨ã‚¬ã‚¤ãƒ‰: `src/types/README.md`
- ãƒ†ã‚¹ãƒˆã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ: `/type-test` (é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ã§ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½)

### 4.3. èªè¨¼ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ (Authentication)

Akatsuki ã§ã¯ã€Supabase Auth ã‚’ä½¿ç”¨ã—ãŸå…¬é–‹/éå…¬é–‹ãƒšãƒ¼ã‚¸æ··åœ¨å‹ã®èªè¨¼ã‚·ã‚¹ãƒ†ãƒ ã‚’æ¨™æº–å®Ÿè£…ã—ã¦ã„ã¾ã™ã€‚

#### ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒ‘ã‚¿ãƒ¼ãƒ³

**Layout.tsx ã‚’ä½¿ã£ãŸéšå±¤åŒ–ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°:**

```javascript
<BrowserRouter>
  <AuthProvider>
    <Routes>
      {/* Public Routes */}
      <Route element={<Layout />}>
        <Route path="/" element={<HomePage />} />
        <Route path="/login" element={<LoginPage />} />
      </Route>

      {/* Private Routes */}
      <Route element={<PrivateLayout />}>
        <Route path="/admin" element={<AdminDashboard />} />
      </Route>
    </Routes>
  </AuthProvider>
</BrowserRouter>
```

**Layoutãƒãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³:**
- `Layout` - ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼ˆmax-w-7xlï¼‰
- `NarrowLayout` - ç‹­ã„ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ç”¨ï¼ˆmax-w-4xlï¼‰
- `FullWidthLayout` - å…¨å¹…ï¼ˆw-fullï¼‰
- `PrivateLayout` - AuthGuard + Layout

#### èªè¨¼æ©Ÿèƒ½

**AuthContext ãŒæä¾›ã™ã‚‹æ©Ÿèƒ½:**
- `user` - ç¾åœ¨ã®ãƒ­ã‚°ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±
- `session` - Supabase ã‚»ãƒƒã‚·ãƒ§ãƒ³æƒ…å ±
- `loading` - èªè¨¼çŠ¶æ…‹ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°
- `signUp(email, password, metadata)` - Email/Password ã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—
- `signIn(email, password)` - Email/Password ãƒ­ã‚°ã‚¤ãƒ³
- `signInWithMagicLink(email)` - Magic Link ãƒ­ã‚°ã‚¤ãƒ³
- `signInWithOAuth(provider)` - OAuth ãƒ­ã‚°ã‚¤ãƒ³ï¼ˆGoogle, GitHub ç­‰ï¼‰
- `signOut()` - ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
- `resetPassword(email)` - ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆãƒ¡ãƒ¼ãƒ«é€ä¿¡
- `updatePassword(newPassword)` - ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰æ›´æ–°

**OAuth ã‚µãƒãƒ¼ãƒˆ:**
- Google, GitHub, GitLab, Bitbucket, Azure, Facebook, Twitter, Discord, Slack, Apple ãªã©

**ãƒ­ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ï¼ˆRBACï¼‰:**
```javascript
const { profile, isAdmin, isModerator } = useAuth()

if (isAdmin) {
  // ç®¡ç†è€…æ©Ÿèƒ½
}

// metadata ã§ role ã‚’æŒ‡å®š
signUp(email, password, {
  username: 'admin_user',
  role: 'admin'  // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ 'user'
})
```

**åˆ©ç”¨å¯èƒ½ãªãƒ­ãƒ¼ãƒ«:**
- `user` - ä¸€èˆ¬ãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰
- `admin` - ç®¡ç†è€…
- `moderator` - ãƒ¢ãƒ‡ãƒ¬ãƒ¼ã‚¿ãƒ¼

#### ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

1. **AuthProvider ã¯ App ã®æœ€ä¸Šä½ã«é…ç½®**
2. **Public/Private ã‚’æ˜ç¢ºã«åˆ†é›¢**
3. **RLSï¼ˆRow Level Securityï¼‰ã¨é€£æº** - Supabase ã® RLS ãŒæœ‰åŠ¹ãªå ´åˆã€èªè¨¼æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã¿ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½
4. **Profile è‡ªå‹•ä½œæˆ** - ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²æ™‚ã«è‡ªå‹•çš„ã« `profiles` ãƒ¬ã‚³ãƒ¼ãƒ‰ãŒä½œæˆã•ã‚Œã‚‹ï¼ˆDatabase Triggerï¼‰
## 5. ä¸»è¦æ©Ÿèƒ½ (Key Features)

ã“ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¯ã€AIé–‹ç™ºã‚’åŠ é€Ÿã™ã‚‹ãŸã‚ã®åŸºç›¤ã‚’æ¨™æº–æ­è¼‰ã—ã¦ã„ã¾ã™ã€‚

### 5.1. AIGen (AI Generation) çµ±åˆåŸºç›¤

Akatsuki ã§ã¯ã€è¤‡æ•°ã®AIãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ï¼ˆOpenAI, Anthropic, Geminiï¼‰ã‚’çµ±ä¸€çš„ã«æ‰±ãˆã‚‹åŸºç›¤ã‚’æ¨™æº–æ­è¼‰ã—ã¦ã„ã¾ã™ã€‚

#### Frontendå®Ÿè£…ï¼ˆå®Ÿè£…æ¸ˆã¿ï¼‰

**useAIGen ãƒ•ãƒƒã‚¯ï¼ˆæ±ç”¨AIæ“ä½œï¼‰:**
```javascript
const { chat, generateImage, loading, error } = useAIGen('openai')
const response = await chat('ã“ã‚“ã«ã¡ã¯')
const image = await generateImage('çŒ«ã®çµµ')
```

**useImageGeneration ãƒ•ãƒƒã‚¯ï¼ˆç”»åƒç”Ÿæˆç‰¹åŒ–ï¼‰:**

**3ã¤ã®ãƒ¢ãƒ¼ãƒ‰:**

| Mode | èª¬æ˜ | ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | ã‚µãƒãƒ¼ãƒˆProvider |
|------|------|------------|------------------|
| **text-to-image** | ãƒ†ã‚­ã‚¹ãƒˆã‹ã‚‰ç”»åƒç”Ÿæˆ | prompt: å¿…é ˆ | DALL-E 3, DALL-E 2, Gemini |
| **variation** | æ—¢å­˜ç”»åƒã®è‡ªå‹•ãƒãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³ | image_url: å¿…é ˆ | DALL-E 2, Gemini |
| **edit** | ç”»åƒã‚’ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã§ç·¨é›† | prompt + image_url | Gemini ã®ã¿ |

**è¨­è¨ˆæ€æƒ³:**
- âœ… Mode = ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ„å›³ï¼ˆã‚¤ãƒ³ãƒ•ãƒ©çŸ¥è­˜ã‚’æ¼æ´©ã•ã›ãªã„ï¼‰
- âœ… Provider/Model = ã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã§å‹•ä½œï¼‰
- âœ… Storage è‡ªå‹•ä¿å­˜ï¼ˆPublic/Privateé¸æŠå¯èƒ½ï¼‰

*è©³ç´°ãªä½¿ç”¨ä¾‹ã¯ `src/pages/ExamplesPage.jsx` ã‚’å‚ç…§*

**å®Ÿè£…æ¸ˆã¿æ©Ÿèƒ½:**
- `useAIGen` - ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼åˆ‡ã‚Šæ›¿ãˆå¯èƒ½ãªAIãƒ•ãƒƒã‚¯ï¼ˆchat, chatStream, generateImage, editImage, embedï¼‰
- `AIService` - ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼çµ±åˆå±¤ï¼ˆOpenAI, Anthropic, Geminiå¯¾å¿œï¼‰
- `AIModel` - ãƒ¢ãƒ‡ãƒ«å®šç¾©ï¼ˆDBç®¡ç†ï¼‰
- `AIModelRepository` - ãƒ¢ãƒ‡ãƒ«æƒ…å ±å–å¾—ï¼ˆSupabaseï¼‰
- `ModelSelector` - UIãƒ¢ãƒ‡ãƒ«é¸æŠã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

**Supabase Edge Functions:**
- `ai-chat` - AIãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼çµ±ä¸€ãƒãƒ£ãƒƒãƒˆã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆï¼ˆãƒãƒ«ãƒãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼å¯¾å¿œã€ã‚¯ã‚©ãƒ¼ã‚¿ç®¡ç†ï¼‰
- `generate-image` - AIç”»åƒç”Ÿæˆã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆï¼ˆDALL-E, Geminiå¯¾å¿œï¼‰

#### Akatsukiçµ±ä¸€ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ãƒ‘ã‚¿ãƒ¼ãƒ³

Supabase Edge Functions ã§å…±é€šçš„ã«ä½¿ç”¨ã™ã‚‹çµ±ä¸€ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã‚’æä¾›ã€‚

**2ç¨®é¡ã®ãƒãƒ³ãƒ‰ãƒ©ãƒ¼:**

1. **`createAkatsukiHandler`** - ãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘APIï¼ˆèªè¨¼å¿…é ˆï¼‰
   - `userClient`: RLSæœ‰åŠ¹ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼è‡ªèº«ã®ãƒ‡ãƒ¼ã‚¿ã®ã¿ï¼‰
   - `adminClient`: RLSãƒã‚¤ãƒ‘ã‚¹ï¼ˆUsageç­‰ã®æ”¹ã–ã‚“é˜²æ­¢ï¼‰

2. **`createSystemHandler`** - ã‚·ã‚¹ãƒ†ãƒ å†…éƒ¨APIï¼ˆWebhookç­‰ã€èªè¨¼ä¸è¦ï¼‰
   - `adminClient`: RLSãƒã‚¤ãƒ‘ã‚¹ï¼ˆå…¨ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ï¼‰

**è¨­è¨ˆã®æ„å›³:**
- èªè¨¼: ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ãƒ¬ãƒ™ãƒ«ã§è‡ªå‹•ãƒã‚§ãƒƒã‚¯
- çµ±ä¸€ãƒ¬ã‚¹ãƒãƒ³ã‚¹: `AkatsukiResponse<T>` å½¢å¼
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°: çµ±ä¸€ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã§è‡ªå‹•å‡¦ç†ï¼ˆCORSã€ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ç­‰ï¼‰

*å®Ÿè£…ä¾‹: `supabase/functions/ai-chat/index.ts`, `generate-image/index.ts`*

### 5.2. Webæ¤œç´¢çµ±åˆ (Web Search Integration)

AIçµ±åˆå‹Webæ¤œç´¢æ©Ÿèƒ½ã‚’æ¨™æº–æ­è¼‰ã€‚2ã¤ã®ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã‹ã‚‰é¸æŠå¯èƒ½ã€‚

#### å¯¾å¿œãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼

| Provider | ç‰¹å¾´ | æ–™é‡‘ | ãŠã™ã™ã‚ç”¨é€” |
|----------|------|------|-------------|
| **Gemini Googleæ¤œç´¢** (ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ) | Googleæ¤œç´¢çµ±åˆã€è‡ªå‹•åˆ¤æ–­ã€å¼•ç”¨æƒ…å ± | Geminiæ–™é‡‘ã®ã¿ï¼ˆæ¤œç´¢è¿½åŠ æ–™é‡‘ãªã—ï¼‰ | æ±ç”¨Webæ¤œç´¢ã€æœ€æ–°æƒ…å ±å–å¾— |
| **Tavily AI Search** | AIç‰¹åŒ–ã€æ§‹é€ åŒ–ãƒ‡ãƒ¼ã‚¿ | $5/æœˆï¼ˆ1000reqï¼‰ | å°‚é–€çš„ãªæ¤œç´¢ã€è¤‡æ•°LLMåˆ©ç”¨æ™‚ |

**æ¨å¥¨**: Geminiåˆ©ç”¨æ™‚ã¯Googleæ¤œç´¢ãŒåœ§å€’çš„ã«ã‚³ã‚¹ãƒ‘è‰¯ã„ï¼ˆè¿½åŠ æ–™é‡‘ãªã—ï¼‰

#### Frontendå®Ÿè£…

```javascript
import { WebSearchService } from '@/services/WebSearchService'
import { useWebSearch } from '@/hooks/useWebSearch'

// Serviceï¼ˆåŸºæœ¬ï¼‰
const { data, error } = await WebSearchService.search('AIã‚¢ãƒ¼ãƒˆ æœ€æ–°å‹•å‘')

// Hookï¼ˆReact Queryï¼‰
const { searchAsync, isPending, data } = useWebSearch()
const result = await searchAsync({ query: '...', provider: 'gemini' })
```

**å®Ÿè£…æ¸ˆã¿æ©Ÿèƒ½:**
- `WebSearchService` - Webæ¤œç´¢çµ±ä¸€API
- `useWebSearch` - React Queryçµ±åˆãƒ•ãƒƒã‚¯
- `WebSearchCard` - ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼åˆ‡ã‚Šæ›¿ãˆUIä»˜ãã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
- `web-search` Edge Function - ãƒãƒ«ãƒãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼æ¤œç´¢ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

### 5.3. å¤–éƒ¨é€£æºçµ±åˆ (External Integrations)

ã‚ˆãä½¿ã†å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹é€£æºã®é››å½¢ã‚’æ¨™æº–æ­è¼‰ã€‚

#### Slacké€šçŸ¥

**å®Ÿè£…å ´æ‰€:** `supabase/functions/slack-notify/index.ts`

**ç”¨é€”ä¾‹:** ã‚¨ãƒ©ãƒ¼é€šçŸ¥ã€ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ©ãƒ¼ãƒˆã€ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°é€šçŸ¥ã€ãƒ‡ãƒ—ãƒ­ã‚¤å®Œäº†é€šçŸ¥

**ç’°å¢ƒå¤‰æ•°:** `SLACK_WEBHOOK_URL`

#### Emailé€ä¿¡

**å®Ÿè£…å ´æ‰€:** `supabase/functions/send-email/index.ts`

**ç”¨é€”ä¾‹:** ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆãƒ¡ãƒ¼ãƒ«ã€ã‚¦ã‚§ãƒ«ã‚«ãƒ ãƒ¡ãƒ¼ãƒ«ã€é€šçŸ¥ãƒ¡ãƒ¼ãƒ«ã€ãƒ¬ãƒãƒ¼ãƒˆé€ä¿¡

**ç’°å¢ƒå¤‰æ•°:** `RESEND_API_KEY`, `EMAIL_FROM`

**ä½¿ç”¨ã‚µãƒ¼ãƒ“ã‚¹:** [Resend](https://resend.com/)

#### æ‹¡å¼µæ–¹æ³•

æ–°ã—ã„å¤–éƒ¨é€£æºã‚’è¿½åŠ ã™ã‚‹å ´åˆ:
1. `supabase/functions/` ã«æ–°ã—ã„Functionä½œæˆ
2. `createSystemHandler` ã‚’ä½¿ç”¨ã—ã¦ãƒãƒ³ãƒ‰ãƒ©ãƒ¼å®Ÿè£…
3. ç’°å¢ƒå¤‰æ•°ã« Webhook URL ã‚„ API Key ã‚’è¨­å®š
4. ãƒ‡ãƒ—ãƒ­ã‚¤: `npm run supabase:function:deploy`

### 5.4. shadcn/ui ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

`packages/ui-components/` ã« shadcn/ui ã®ä¸»è¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’å°å…¥äºˆå®šã€‚é–‹ç™ºè€…ã¯å³åº§ã«ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’åˆ©ç”¨ãƒ»ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºå¯èƒ½ã€‚

### 5.5. AI Agent UI Library (`@akatsuki/ai-agent-ui`)

**Location:** `packages/ai-agent-ui/`

ãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã« AI æ©Ÿèƒ½ã‚’ç°¡å˜ã«è¿½åŠ ã§ãã‚‹ React ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ©ã‚¤ãƒ–ãƒ©ãƒªã€‚

#### ç‰¹å¾´

- **Headless Architecture**: Coreå±¤ï¼ˆãƒ­ã‚¸ãƒƒã‚¯ï¼‰ã¨UIå±¤ï¼ˆè¦‹ãŸç›®ï¼‰ã‚’å®Œå…¨åˆ†é›¢
- **Provider Pattern**: è¤‡æ•°ã®AIãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã‚’ã‚µãƒãƒ¼ãƒˆï¼ˆOpenAI, Anthropic, Geminiç­‰ï¼‰
- **i18nå¯¾å¿œ**: è‹±èªãƒ»æ—¥æœ¬èªã®å®Œå…¨ã‚µãƒãƒ¼ãƒˆï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: è‹±èªï¼‰
- **Type-Safe**: å…¨ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ»å‹å®šç¾©ãŒå®Œå…¨ã«TypeScriptåŒ–
- **Zero Config**: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šã§å³åº§ã«å‹•ä½œ

#### ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆä¸€è¦§

| ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ | èª¬æ˜ |
|--------------|------|
| `AITrigger` | AIæ©Ÿèƒ½ã‚’é–‹ããƒˆãƒªã‚¬ãƒ¼ãƒœã‚¿ãƒ³ï¼ˆâœ¨ã‚¢ã‚¤ã‚³ãƒ³ï¼‰ |
| `AIIconSet` | AIæ©Ÿèƒ½ã®ãƒ¡ã‚¤ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼ï¼ˆğŸ’«ç”Ÿæˆ, ğŸ–Œï¸ä¿®æ­£, â†æˆ»ã™ç­‰ï¼‰ |
| `AIDirectionMenu` | ç”Ÿæˆæ–¹å‘æ€§ã®é¸æŠãƒ‘ãƒãƒ«ï¼ˆãƒ•ã‚©ãƒ¼ãƒãƒ«ã€ã‚«ã‚¸ãƒ¥ã‚¢ãƒ«ç­‰ï¼‰ |
| `AIModelSelector` | AIãƒ¢ãƒ‡ãƒ«é¸æŠãƒ‘ãƒãƒ«ï¼ˆFast/Thinkã€Multi-Runå¯¾å¿œï¼‰ |
| `AICommandPanel` | ã‚«ã‚¹ã‚¿ãƒ ã‚³ãƒãƒ³ãƒ‰å…¥åŠ›ãƒ»ä¿å­˜ãƒ‘ãƒãƒ« |
| `AIHistoryList` | å±¥æ­´è¡¨ç¤ºãƒ»ã‚¸ãƒ£ãƒ³ãƒ—ãƒ‘ãƒãƒ« |
| `AITokenUsagePanel` | Tokenä½¿ç”¨é‡ãƒ»ã‚³ã‚¹ãƒˆè¡¨ç¤ºãƒ‘ãƒãƒ« |

#### åŸºæœ¬çš„ãªä½¿ã„æ–¹

```tsx
import { AIAgentProvider, useAIRegister, useAIUI, AIIconSet, AI_LABELS } from '@akatsuki/ai-agent-ui'

function MyEditor() {
  const [text, setText] = useState('')
  const ai = useAIRegister({ text, onUpdate: setText, provider: 'openai' })
  const uiState = useAIUI()

  return (
    <div className="relative">
      <textarea value={text} onChange={(e) => setText(e.target.value)} />
      <AITrigger onClick={uiState.handlers.toggleMenu} isActive={uiState.ui.isMenuOpen} />
      {uiState.ui.isMenuOpen && (
        <AIIconSet
          actions={ai.actions}
          state={ai.state}
          uiState={uiState.ui}
          uiHandlers={uiState.handlers}
          labels={AI_LABELS.ja}
        />
      )}
    </div>
  )
}
```

#### ãƒ•ã‚©ãƒ¼ãƒ é€£æºæ©Ÿèƒ½ï¼ˆrelatedDataï¼‰

**ä»–ã®ãƒ•ã‚©ãƒ¼ãƒ ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®å€¤ã‚’ AI ç”Ÿæˆã«åæ˜ :**

```tsx
function BlogPostForm() {
  const [title, setTitle] = useState('')
  const [summary, setSummary] = useState('') // ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›
  const [content, setContent] = useState('') // AIç”Ÿæˆ

  const ai = useAIRegister({
    context: {
      scope: 'BlogPost.Content',
      type: 'long_text',
      maxLength: 2000,
      relatedData: {
        title: title,
        summary: summary, // â† ã“ã‚Œã‚‰ã®å€¤ãŒAIã«æ¸¡ã•ã‚Œã‚‹
      },
    },
    getValue: () => content,
    setValue: (newValue) => setContent(newValue),
  })

  return (
    <>
      <input value={title} onChange={(e) => setTitle(e.target.value)} />
      <textarea value={summary} onChange={(e) => setSummary(e.target.value)} />
      <textarea value={content} onChange={(e) => setContent(e.target.value)} />
      <button onClick={() => ai.actions.generate()}>ğŸ’« æœ¬æ–‡ã‚’ç”Ÿæˆ</button>
    </>
  )
}
```

**AIã«é€ã‚‰ã‚Œã‚‹ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ:**
```
ã€SystemPromptã€‘
ã‚ãªãŸã¯å„ªç§€ãªã‚³ãƒ³ãƒ†ãƒ³ãƒ„ç”Ÿæˆã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã§ã™...

ã€ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã€‘
- ã‚¹ã‚³ãƒ¼ãƒ—: BlogPost.Content
- ã‚¿ã‚¤ãƒ—: long_text

ã€é–¢é€£æƒ…å ±ã€‘
- title: React Hooksã®åŸºç¤
- summary: React Hooksã‚’ä½¿ã£ãŸçŠ¶æ…‹ç®¡ç†ã¨ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ã®åŸºæœ¬ã‚’è§£èª¬

ã€é‡è¦ãªåˆ¶ç´„ã€‘
ç”Ÿæˆã™ã‚‹ãƒ†ã‚­ã‚¹ãƒˆã¯å¿…ãš2000æ–‡å­—ä»¥å†…ã«ã—ã¦ãã ã•ã„ã€‚
```

**å¯¾å¿œã™ã‚‹å‹:**
- `string`, `number`, `boolean`: èª­ã¿ã‚„ã™ã„key-valueå½¢å¼
- `object`, `array`: æ•´å½¢ã•ã‚ŒãŸJSONå½¢å¼

#### è¨­è¨ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

è©³ç´°ã¯ä»¥ä¸‹ã‚’å‚ç…§ï¼š
- `packages/ai-agent-ui/README.md` - ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãƒ»åŸºæœ¬çš„ãªä½¿ã„æ–¹
- `packages/ai-agent-ui/CORE_LOGIC_CONSOLIDATION.md` - Coreå±¤ã®è¨­è¨ˆæ€æƒ³
- `packages/ai-agent-ui/TOKEN_LOGIC_CONSOLIDATION.md` - Tokenè¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯
- `packages/ai-agent-ui/RELATEDDATA_USAGE.md` - relatedDataã«ã‚ˆã‚‹ãƒ•ã‚©ãƒ¼ãƒ é€£æºã®è©³ç´°ã‚¬ã‚¤ãƒ‰

### 5.6. GraphView & RichEditor

**Location:** `src/components/ui/GraphView.tsx`, `RichEditor.tsx`

Reactflow/Lexical ã®è»½é‡ãƒ©ãƒƒãƒ‘ãƒ¼ã€‚åŸºæœ¬çš„ãªä½¿ã„æ–¹ã®ã¿æä¾›ã€‚

- `GraphView` - ã‚°ãƒ©ãƒ•å¯è¦–åŒ–ï¼ˆReactflowï¼‰
- `RichEditor` - ãƒªãƒƒãƒãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒ‡ã‚£ã‚¿ï¼ˆLexicalï¼‰

**ä½¿ã„æ–¹:** `src/app/examples/` ã®ãƒ‡ãƒ¢ã‚’å‚ç…§

### 5.7. Export/Import Service

**Location:** `src/services/ExportImportService.ts`

ãƒ‡ãƒ¼ã‚¿ã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ/ã‚¤ãƒ³ãƒãƒ¼ãƒˆæ©Ÿèƒ½ã€‚Zipå½¢å¼å¯¾å¿œã€‚

```typescript
// Export
const zipBlob = await ExportImportService.exportData(data, 'filename')

// Import
const data = await ExportImportService.importData(file)
```

**è¨­è¨ˆ:** Type-safeã€æ‹¡å¼µå¯èƒ½ãªãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆå®šç¾©

---
## 6. é–‹ç™ºãƒ«ãƒ¼ãƒ« (Rules)

ã“ã“ãŒæœ€ã‚‚é‡è¦ã§ã™ã€‚ã€Œå®‰å®šæ€§ã€ã¨ã€Œã‚¹ãƒ”ãƒ¼ãƒ‰ã€ã‚’ç¶­æŒã™ã‚‹ãŸã‚ã€ä»¥ä¸‹ã®ãƒ«ãƒ¼ãƒ«ã‚’å¿…ãšéµå®ˆã—ã¦ãã ã•ã„ã€‚

### 6.1. ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ (Workflow)

#### DBé‹ç”¨ï¼ˆãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰

* **`Supabase-dev` ç’°å¢ƒã‚’å¿…ãšä½œæˆã—ã€ãƒãƒ¼ãƒ ã§å…±æœ‰**
* **ãƒ­ãƒ¼ã‚«ãƒ«ã§ã®DBé–‹ç™ºã¯åŸå‰‡ç¦æ­¢**ã€`Supabase-dev` ã¸ç›´æ¥å¤‰æ›´ã‚’åŠ ãˆã‚‹

**ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æ‰‹é †:**
```bash
npm run supabase:migration:new create_users_table  # Migrationä½œæˆ
npm run supabase:push                               # Supabaseã«é©ç”¨
```

#### Edge Functionsé‹ç”¨

**æ‰‹é †:**
```bash
npm run supabase:function:new my-function           # Functionä½œæˆ
npm run supabase:function:deploy my-function        # ãƒ‡ãƒ—ãƒ­ã‚¤
npm run supabase:function:deploy                    # å…¨Functionsãƒ‡ãƒ—ãƒ­ã‚¤
```

**Frontend ã‹ã‚‰ã®å‘¼ã³å‡ºã—:**
```javascript
// services/EdgeFunctionService.js ã«å€‹åˆ¥é–¢æ•°ã‚’è¿½åŠ 
export async function callMyFunction(payload) {
  return EdgeFunctionService.invoke('my-function', payload)
}
```

#### é–‹ç™ºç”¨ãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ

å‹•ä½œç¢ºèªç”¨ã®ãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿ã¯ã€`akatsuki api`ã§ä½œæˆã™ã‚‹ã¨è‡ªå‹•ç”Ÿæˆã•ã‚Œã‚‹ã€‚

**åŸºæœ¬æ–¹é‡:**
- Seed (seed.sql) = æœ¬å½“ã®åˆæœŸãƒ‡ãƒ¼ã‚¿ï¼ˆãƒã‚¹ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿ã€å›ºå®šãƒ‡ãƒ¼ã‚¿ï¼‰
- workspace/ ã‚¹ã‚¯ãƒªãƒ—ãƒˆ = é–‹ç™ºç”¨ã®ä¸€æ™‚çš„ãªãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿

**å®Ÿè¡Œæ–¹æ³•:**
```bash
cd workspace
node generate-dummy-data.js
```

**ãƒã‚¤ãƒ³ãƒˆ:**
- import path ã¯ç›¸å¯¾ãƒ‘ã‚¹ï¼ˆ`../packages/app-frontend/src/...`ï¼‰
- ImageGenerationService ã‚’æ´»ç”¨ï¼ˆEdge FunctionçµŒç”±ã§ç”»åƒç”Ÿæˆï¼‰
- file_id ã‚’å–å¾—ï¼ˆStorage + file_metadata ã«è‡ªå‹•ä¿å­˜ï¼‰
- Supabase Client ã§ç›´æ¥INSERT
- workspace/ ã¯ Gitç®¡ç†å¤–ï¼ˆä½¿ã„æ¨ã¦ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’è‡ªç”±ã«ï¼‰

*è©³ç´°ãªå®Ÿè£…ä¾‹ã¯æ—¢å­˜ã® workspace/ ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å‚ç…§*

#### ãƒ­ãƒ¼ã‚«ãƒ«å°‚ç”¨é ˜åŸŸ (`workspace/`)

* `.gitignore` ã•ã‚Œã¦ã„ã‚‹
* å€‹äººã®ãƒ¡ãƒ¢ã€ä¸‹æ›¸ãã€ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒå¤‰æ•°ï¼ˆ`.env`ï¼‰ãªã©ã‚’é…ç½®
* ç”¨é€”ä¾‹: å€‹äººçš„ãªå®Ÿé¨“ã‚³ãƒ¼ãƒ‰ã€å¤–éƒ¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®èª¿æŸ»ç”¨ã‚¯ãƒ­ãƒ¼ãƒ³ã€æ©Ÿå¯†æƒ…å ±

### 6.2. ç’°å¢ƒå¤‰æ•°ç®¡ç†

| å¯¾è±¡ | é…ç½®å ´æ‰€ | Gitç®¡ç† | ã‚µãƒ³ãƒ—ãƒ« |
| :--- | :--- | :--- | :--- |
| **Frontend** | `packages/app-frontend/.env` | âŒ Ignore | `.env.example` ã‚ã‚Š |
| **Backend** | `packages/app-backend/.env` | âŒ Ignore | `.env.example` ã‚ã‚Š |
| **å€‹äººç”¨** | `workspace/.env` | âŒ Ignore | - |

**é‡è¦:** `.env` ãƒ•ã‚¡ã‚¤ãƒ«ã¯çµ¶å¯¾ã«ã‚³ãƒŸãƒƒãƒˆã—ãªã„ã€‚

### 6.3. ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç† (Version Control)

é–‹ç™ºç’°å¢ƒã®å·®ç•°ã‚’é˜²ããŸã‚ã€ä»¥ä¸‹ã‚’é…ç½®ã—ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’çµ±ä¸€ï¼š

1. `.tool-versions` (asdf, miseç”¨)
2. `.nvmrc` (nvmç”¨)
3. `package.json` ã® `engines` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰

**é–‹ç™ºé–‹å§‹æ™‚ã¯å¿…ãšãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ãƒ„ãƒ¼ãƒ«ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«:**
```bash
nvm use           # nvmã®å ´åˆ
asdf install      # asdf/miseã®å ´åˆ
```

### 6.4. ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ãƒ»ãƒãƒªã‚·ãƒ¼ (Documentation)

| ãƒ•ã‚¡ã‚¤ãƒ«/ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª | å½¹å‰² | Gitç®¡ç† |
| :--- | :--- | :--- |
| **`README.md`** | ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦ãƒ»æœ€é€Ÿèµ·å‹• | â­•ï¸ Commit |
| **`AGENT.md`** | è¨­è¨ˆæ€æƒ³ãƒ»ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ»ãƒ«ãƒ¼ãƒ« | â­•ï¸ Commit |
| **`issue.md`** | ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒã‚¹ã‚¿ãƒ¼ãƒ—ãƒ©ãƒ³ | â­•ï¸ Commit |
| **`docs/guide/`** | å†åˆ©ç”¨å¯èƒ½ãªã€Œæ‰‹é †æ›¸ã€ | â­•ï¸ Commit |
| **`docs/`**(ãã®ä»–) | è¨­è¨ˆãƒ¡ãƒ¢ã€ADRã€è­°äº‹éŒ²ãªã© | â­•ï¸ Commit |
| **`workspace/`** | å€‹äººã®ä½œæ¥­å ´ãƒ»ä¸‹æ›¸ã | âŒ **Ignore** |

**ãƒ«ãƒ¼ãƒ«:**
- ãƒãƒ¼ãƒ ã§å…±æœ‰ã™ã¹ãæƒ…å ±ã¯å¿…ãš `docs/` é…ä¸‹ã«ã‚³ãƒŸãƒƒãƒˆ
- å€‹äººçš„ãªãƒ¡ãƒ¢ã‚„å®Ÿé¨“ã¯ `workspace/` ã«é…ç½®
- ç’°å¢ƒå¤‰æ•°ã‚„ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã¯çµ¶å¯¾ã«ã‚³ãƒŸãƒƒãƒˆã—ãªã„

### 6.4. VibeCodingå®Ÿè·µã‚¬ã‚¤ãƒ‰

#### 6.4.1. QuickStart Checklistï¼ˆå®Ÿè£…é–‹å§‹å‰ã®1åˆ†ç¢ºèªï¼‰

```
â–¡ Step 1: è¦ä»¶ã‚’æ•´ç†
   â†’ workspace/[feature-name]-design.md ã«ä¸‹æ›¸ã

â–¡ Step 2: ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå‚è€ƒï¼ˆè‡ªç”±ã«è¨­è¨ˆï¼‰
   â†’ 8.9ã‚’è¦‹ã¦ã€è¿‘ã„ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æŠŠæ¡
   â†’ è¦ä»¶ã«åˆã‚ã›ã¦è‡ªç”±ã«ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºï¼ˆãã®ã¾ã¾é©ç”¨ã—ãªã„ï¼‰
   â†’ ExamplePage/AdminPageã§å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’èª¿æŸ»

â–¡ Step 3: è¨­è¨ˆæ•´ç†
   â†’ ç”»é¢æ•°ãƒ»ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ï¼ˆ3-5ç”»é¢æ¨å¥¨ï¼‰
   â†’ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆï¼ˆEntityãƒ»DB/ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼ãƒ»ãƒ¬ã‚¤ãƒ¤ãƒ¼ï¼‰
   â†’ Schemaè¨­è¨ˆï¼ˆEntity + RLSï¼‰
   â†’ ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆè¨­è¨ˆï¼ˆHook â†’ Component â†’ Pageï¼‰
 
â–¡ Step 4: TodoWrite ã§ã‚¿ã‚¹ã‚¯ç®¡ç†é–‹å§‹
   â†’ Phaseåˆ†å‰²ã¯å†…éƒ¨ç®¡ç†ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¸ã®ä¸­é–“å ±å‘Šã¯ä¸è¦

â–¡ Step 5: è¨­è¨ˆã‚’ã‚‚ã¨ã«å®Ÿè£…
   â†’ CRUDã‚³ãƒ¼ãƒ‰è‡ªå‹•ç”Ÿæˆä»–`akatsuki`ã‚³ãƒãƒ³ãƒ‰ã‚’åˆ©ç”¨
   â†’ è©°ã¾ã£ãŸã‚‰å ±å‘Šã€ãã‚Œä»¥å¤–ã¯é€²ã‚ã‚‹

â–¡ Step 6: å‹•ä½œç¢ºèª
   â†’ è‡ªå‹•ç”Ÿæˆã•ã‚ŒãŸãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿ â†’ ç”»é¢ç¢ºèª

â–¡ Step 7: æŒ¯ã‚Šè¿”ã‚Šï¼ˆå®Œäº†å¾Œï¼‰
   â†’ docs/ ã«è¨­è¨ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ•´ç†
```

**å‚ç…§ã‚»ã‚¯ã‚·ãƒ§ãƒ³:**
- DBè¨­è¨ˆ â†’ 6.1ï¼ˆãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰
- Componentè¨­è¨ˆ â†’ 4.1ï¼ˆã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼‰
- ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ â†’ 8.9ï¼ˆVibeCoding Design Templatesï¼‰
- ãƒˆãƒ©ãƒ–ãƒ«å¯¾å¿œ â†’ 9.2ï¼ˆVibeCodingä¸­ã®ã‚ˆãã‚ã‚‹ãƒˆãƒ©ãƒ–ãƒ«ï¼‰

#### 6.4.2. å®Ÿè£…ã®é€²ã‚æ–¹ï¼ˆåŸºæœ¬å§¿å‹¢ï¼‰

**VibeCodingã®æœ¬è³ª: ã‚¹ãƒ”ãƒ¼ãƒ‰é‡è¦–ã€è¦ä»¶ã‚’å‹•ã‹ã™ã“ã¨ã‚’æœ€å„ªå…ˆ**

**å®Ÿè£…æ™‚ã®ãƒ«ãƒ¼ãƒ«:**

1. **Phaseåˆ†ã‘ã¯å†…éƒ¨ç®¡ç†ã§OK** - TodoWriteãƒ„ãƒ¼ãƒ«ã§Phaseã‚’ç®¡ç†ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¸ã®ä¸­é–“å ±å‘Šã¯ä¸è¦
2. **ç›¸è«‡ãŒå¿…è¦ãªæ™‚ã®ã¿åœæ­¢** - æŠ€è¡“çš„ã«è©°ã¾ã£ãŸæ™‚ã€é‡è¦ãªè¨­è¨ˆåˆ¤æ–­ãŒå¿…è¦ãªæ™‚ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ˜ç¤ºçš„ã«ç›¸è«‡ã‚’æ±‚ã‚ãŸæ™‚ã®ã¿
3. **å“è³ªã¯AGENT.mdã®ãƒ«ãƒ¼ãƒ«ã¨Exampleã§æ‹…ä¿** - Repository/Modelãƒ‘ã‚¿ãƒ¼ãƒ³å¾¹åº•ã€çµ±ä¸€ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ä½¿ç”¨ã€RLSè¨­è¨ˆã‚’æœ€åˆã‹ã‚‰è€ƒæ…®ã€ExamplePageã‚„åˆæœŸå®Ÿè£…ã‚’å¿…ãšèª¿æŸ»

**âœ… è‰¯ã„ä¾‹:**
```
ãƒ¦ãƒ¼ã‚¶ãƒ¼: ã€Œã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ä½œæˆã‚¢ãƒ—ãƒªä½œã‚ã†ã€
AI:
  1. è¦ä»¶æ•´ç†ï¼ˆworkspace/ã«ä¸‹æ›¸ãï¼‰
  2. ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå‚è€ƒï¼ˆ8.9ã‚’è¦‹ã¦ã€è¿‘ã„ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æŠŠæ¡ï¼‰
  3. è‡ªç”±ã«è¨­è¨ˆï¼ˆè¦ä»¶ã«åˆã‚ã›ã¦ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºï¼‰
  4. TodoWrite ã§ã‚¿ã‚¹ã‚¯ä½œæˆ
  5. ä¸€æ°—ã«å®Ÿè£…ï¼ˆMigration â†’ Model â†’ Repository â†’ Component â†’ Pageï¼‰
  6. å‹•ä½œç¢ºèªï¼ˆworkspace/ã§ãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆï¼‰
  7. å®Œæˆå ±å‘Š

ï¼ˆPhase 1-7ã‚’å†…éƒ¨çš„ã«é€²ã‚ã‚‹ã€è©°ã¾ã‚‰ãªã‘ã‚Œã°å ±å‘Šä¸è¦ï¼‰

â€» ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¯ã€Œå‚è€ƒã€ã§ã‚ã‚Šã€ãã®ã¾ã¾é©ç”¨ã™ã‚‹ã‚‚ã®ã§ã¯ãªã„
â€» è¦ä»¶ã«å¿œã˜ã¦è‡ªç”±ã«ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã—ã¦è¨­è¨ˆã™ã‚‹
```

**âŒ NGä¾‹:**
```
AI: ã€ŒPhase 1ãŒå®Œäº†ã—ã¾ã—ãŸã€‚æ¬¡ã«é€²ã‚“ã§è‰¯ã„ã§ã™ã‹ï¼Ÿã€
AI: ã€ŒMigrationã‚’ä½œã‚Šã¾ã—ãŸã€‚ç¢ºèªã—ã¦ãã ã•ã„ã€‚ã€
AI: ã€Œæ¬¡ã¯Repositoryã‚’ä½œã‚Šã¾ã™ãŒã€ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿã€
ãƒ¼ï¼ç¢ºèªã¯ä¸è¦
```

#### 6.4.3. VibeCoding Design Frameworkï¼ˆè¨­è¨ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä½œæˆï¼‰

**è¨­è¨ˆæ•´ç†ã¯å¿…é ˆ** - æ–°æ©Ÿèƒ½ã‚’å®Ÿè£…ã™ã‚‹å‰ã«ã€`workspace/[feature-name]-design.md` ã«æ›¸ãå‡ºã™ã€‚

**âœ¨ æ–°æ©Ÿèƒ½: Design Template Generator**

```bash
# è¨­è¨ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’è‡ªå‹•ç”Ÿæˆ
npm run design:new <feature-name>

# ä¾‹
npm run design:new user-dashboard
# â†’ workspace/user-dashboard-design.md ãŒä½œæˆã•ã‚Œã‚‹
```

**ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®ç‰¹å¾´:**
- ğŸ’¡ **"Feel free to customize!"** ãƒãƒ¼ã‚«ãƒ¼ - ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºãƒã‚¤ãƒ³ãƒˆã‚’æ˜ç¤º
- ğŸ¨ **ã‚«ãƒ©ãƒ¼ãƒãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³é¸æŠè‚¢** - AGENT.md L954-1000å‚ç…§
- ğŸ“ **ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³** - 1-pane/2-pane/3-paneã‹ã‚‰é¸æŠ
- ğŸ“ **äº‹å‰å¯¾è©±ãƒ¡ãƒ¢** - ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ã®å¯¾è©±å†…å®¹ã‚’è¨˜éŒ²

**ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé …ç›®:**
1. **äº‹å‰å¯¾è©±ãƒ¡ãƒ¢** - ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ã®å¯¾è©±å†…å®¹ï¼ˆã‚«ãƒ©ãƒ¼ã€ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆç­‰ï¼‰
2. **ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æœ¬å½“ã®ãƒ‹ãƒ¼ã‚º** - WHY/WHO/WHAT
3. **ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹å±•é–‹** - ãƒ¡ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼/ã‚µãƒ–ãƒ•ãƒ­ãƒ¼/ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹
4. **ç”»é¢æ§‹æˆï¼ˆUXé‡è¦–ï¼‰** - ã‚«ãƒ©ãƒ¼ãƒ†ãƒ¼ãƒã€ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³ã€ASCII WireFrame
5. **DBè¨­è¨ˆ** - ãƒ†ãƒ¼ãƒ–ãƒ«å®šç¾©ï¼ˆSQLï¼‰ã€RLS Policyè¨­è¨ˆ
6. **ä½¿ç”¨ã™ã‚‹Akatsukiæ©Ÿèƒ½** - å®Ÿè£…æ¸ˆã¿æ©Ÿèƒ½ã€æ–°è¦ä½œæˆãŒå¿…è¦ãªæ©Ÿèƒ½
7. **ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å±¤** - Models/Repositories/Services/Hooks/Components
8. **å®Ÿè£…ã‚¹ãƒ†ãƒƒãƒ—** - Phase 1-8ã®ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ
9. **é‡è¦ãªè¨­è¨ˆåˆ¤æ–­** - ãªãœã“ã®è¨­è¨ˆã«ã—ãŸã‹ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è€ƒæ…®äº‹é …
10. **å‚è€ƒè³‡æ–™** - æ—¢å­˜å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³ã¸ã®ãƒªãƒ³ã‚¯

**Design Frameworkã®æœ¬è³ª:**

âŒ **å¾“æ¥ã®Template/Themeï¼ˆå›ºå®šåŒ–ï¼‰:**
- WordPressãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆçš„
- ã€Œãã®ã¾ã¾é©ç”¨ã€ã‚’æƒ³å®š
- ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã—ã«ãã„

âœ… **VibeCoding Designï¼ˆå¯¾è©±ã¨æŸ”è»Ÿæ€§ï¼‰:**
- ã€Œæ€è€ƒã®å‡ºç™ºç‚¹ã€
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ã®å¯¾è©±ã§æ±ºå®šï¼ˆã‚«ãƒ©ãƒ¼ã€ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆç­‰ï¼‰
- è¦ä»¶ã«å¿œã˜ã¦è‡ªç”±ã«ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º
- å®Ÿè£…ã®ã€Œåœ°å›³ã€ã§ã‚ã‚Šã€Œç¾…é‡ç›¤ã€

**ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼:**
1. **CLIå®Ÿè¡Œ**: `npm run design:new <feature-name>`
2. **å¯¾è©±ã§ç¢ºèª**: ã‚«ãƒ©ãƒ¼ã€ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã€ç”»é¢æ•°ãªã©ã‚’ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ç¢ºèª
3. **ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆè¨˜å…¥**: å¯¾è©±å†…å®¹ã‚’ã€Œäº‹å‰å¯¾è©±ãƒ¡ãƒ¢ã€ã«è¨˜éŒ²ã€å„ã‚»ã‚¯ã‚·ãƒ§ãƒ³åŸ‹ã‚ã‚‹
4. **Exampleèª¿æŸ»**: ExamplePage/AdminPageã€æ—¢å­˜å®Ÿè£…ã‚’èª¿æŸ»
5. **å®Ÿè£…é–‹å§‹**: è¨­è¨ˆã‚’è¦‹ãªãŒã‚‰VibeCoding
6. **å®Œäº†å¾Œ**: `docs/examples/` ã«ã‚³ãƒŸãƒƒãƒˆï¼ˆæˆåŠŸäº‹ä¾‹ã¨ã—ã¦è“„ç©ï¼‰

**å‚è€ƒè³‡æ–™:**
- Template: `docs/templates/design-template.md`
- å®Ÿä¾‹: `docs/examples/agent-asset-hub-design.md`

**ãƒã‚¤ãƒ³ãƒˆ:**
- âœ… å¯¾è©±ã‚’æœ€å„ªå…ˆ - ã€Œã‚«ãƒ©ãƒ•ãƒ«ã§æ¥½ã—ã„æ„Ÿã˜ã€ç­‰ã®ãƒ‹ãƒ¥ã‚¢ãƒ³ã‚¹ã‚’åæ˜ 
- âœ… è‡ªç”±ã«ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º - "Feel free!"ãƒãƒ¼ã‚«ãƒ¼ã‚’æ´»ç”¨
- âœ… æœ€å°é™ã®æ•´ç†ã§é–‹å§‹ - å®Œç’§ã‚’æ±‚ã‚ãªã„
- âœ… Exampleæ´»ç”¨ - è»Šè¼ªã®å†ç™ºæ˜ã‚’é¿ã‘ã‚‹
- âœ… RLSè¨­è¨ˆã‚’æœ€åˆã‹ã‚‰ - å¾Œä»˜ã‘ã¯ä¸æ•´åˆã®å…ƒ
- âœ… workspace â†’ docs/examples - æˆåŠŸäº‹ä¾‹ã¨ã—ã¦è“„ç©

#### 6.4.4. ã‚ˆãã‚ã‚‹è³ªå•ï¼ˆFAQï¼‰

**Q1: ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¯ã©ã†ä½¿ãˆã°è‰¯ã„ï¼Ÿ**
- ã‚»ã‚¯ã‚·ãƒ§ãƒ³8.9ã‚’è¦‹ã¦ã€è¿‘ã„ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æŠŠæ¡
- è¦ä»¶ã«å¿œã˜ã¦è‡ªç”±ã«ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºï¼ˆãã®ã¾ã¾é©ç”¨ã—ãªã„ï¼‰
- VibeCodingã¯ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚¨ãƒ³ã‚¸ãƒ³ã§ã¯ãªãã€è‡ªç”±åº¦ã®é«˜ã„è¨­è¨ˆãŒæœ¬è³ª

**Q2: å®Ÿè£…ä¸­ã«è©°ã¾ã£ãŸã‚‰ï¼Ÿ**
- ã‚»ã‚¯ã‚·ãƒ§ãƒ³9.2ã€ŒVibeCodingä¸­ã®ã‚ˆãã‚ã‚‹ãƒˆãƒ©ãƒ–ãƒ«ã€ã‚’å‚ç…§

**Q3: Componentåˆ†å‰²ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã¯ï¼Ÿ**
- ã‚»ã‚¯ã‚·ãƒ§ãƒ³4.1ã€ŒComponentåˆ†å‰²ã®åˆ¤æ–­åŸºæº–ï¼ˆThe 200-Line Ruleï¼‰ã€ã‚’å‚ç…§
- 200è¡Œè¶…ãˆ/useState 5å€‹ä»¥ä¸Š/ãƒãƒ³ãƒ‰ãƒ©ãƒ¼50è¡Œè¶…ãˆã§åˆ†å‰²

**Q4: workspace/ ã«ä½•ã‚’ç½®ã‘ã°è‰¯ã„ï¼Ÿ**
- è¨­è¨ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ä¸‹æ›¸ãã€ãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆã‚¹ã‚¯ãƒªãƒ—ãƒˆã€å€‹äººçš„ãªãƒ¡ãƒ¢ã€å®Ÿé¨“ã‚³ãƒ¼ãƒ‰ã€ç’°å¢ƒå¤‰æ•°

**Q5: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ç¢ºèªãŒå¿…è¦ãªã‚¿ã‚¤ãƒŸãƒ³ã‚°ã¯ï¼Ÿ**
- æŠ€è¡“çš„ã«è©°ã¾ã£ãŸæ™‚ã€é‡è¦ãªè¨­è¨ˆåˆ¤æ–­ãŒå¿…è¦ãªæ™‚ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ˜ç¤ºçš„ã«ç›¸è«‡ã‚’æ±‚ã‚ãŸã«è¡Œã†

#### 6.4.5. å®Ÿè£…æ™‚ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ï¼ˆæœ€é‡è¦ï¼‰

**æ—¢å­˜ã‚³ãƒ¼ãƒ‰ã‚’æœ€å„ªå…ˆã§å‚ç…§ã›ã‚ˆ**

**å‚è€ƒè³‡æ–™ã®å„ªå…ˆé †ä½:**
```
æ—¢å­˜ã‚³ãƒ¼ãƒ‰ > Design Templates > ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå†…ã®ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰
```

**1. æ—¢å­˜ã®å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆæœ€å„ªå…ˆï¼‰**
- `src/models/UserProfile.ts` - Modelå±¤ã®å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³
- `src/repositories/UserProfileRepository.ts` - Repositoryå±¤ã®å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³
- `src/hooks/usePublicProfile.ts` - React Queryçµ±åˆãƒ‘ã‚¿ãƒ¼ãƒ³
- `src/pages/ExamplesPage.jsx` - å…¨æ©Ÿèƒ½ã®ãƒ‡ãƒ¢å®Ÿè£…
- `src/pages/AdminDashboard.jsx` - ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³

**åˆ©ç‚¹:** âœ… TypeScriptå‹å®šç¾©ãŒæ­£ç¢ºã€âœ… å®Ÿéš›ã«å‹•ä½œã—ã¦ã„ã‚‹ã€âœ… Akatsukiã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã«æº–æ‹ 

**2. Design Templatesï¼ˆå‚è€ƒï¼‰**
- ã‚»ã‚¯ã‚·ãƒ§ãƒ³ 8.9 ã‚’è¦‹ã¦ã€è¿‘ã„ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æŠŠæ¡
- âš ï¸ ãã®ã¾ã¾ã‚³ãƒ”ãƒšã›ãšã€è¦ä»¶ã«å¿œã˜ã¦ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º
- âš ï¸ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¯ã‚ãã¾ã§ã€Œå‚è€ƒã€
- âœ… æ—¢å­˜ã‚³ãƒ¼ãƒ‰ã¨çµ„ã¿åˆã‚ã›ã¦ä½¿ã†

**3. QuickStart Checklistï¼ˆãƒ•ãƒ­ãƒ¼ç¢ºèªï¼‰**
- ã‚»ã‚¯ã‚·ãƒ§ãƒ³ 6.4.1 ã§ãƒ•ãƒ­ãƒ¼ç¢ºèª

### 6.5. ãƒ©ã‚¤ãƒ–ãƒ©ãƒª (Lib) ç®¡ç†ãƒãƒªã‚·ãƒ¼

#### 1. å†…éƒ¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒª (Monorepo Internal)

- `packages/` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªé…ä¸‹ï¼ˆGitç®¡ç†å¯¾è±¡ï¼‰
- `workspace:*` ã«ã‚ˆã‚‹ãƒ­ãƒ¼ã‚«ãƒ«å‚ç…§ã‚’æ¨å¥¨

**ä¾‹ (package.json):**
```json
{
  "dependencies": {
    "ui-components": "workspace:*",
    "aigen-hooks": "workspace:*"
  }
}
```

#### 2. å¤–éƒ¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒª (Monorepo External)

- `npm link` ã‚„ `path:` æŒ‡å®šã«ã‚ˆã‚‹**ãƒ­ãƒ¼ã‚«ãƒ«ãƒ‘ã‚¹å‚ç…§ã¯åŸå‰‡ç¦æ­¢**
- å…ƒã®ãƒªãƒã‚¸ãƒˆãƒªå´ã‚’ã‚¯ãƒªãƒ¼ãƒ³ã«ä¿®æ­£ãƒ»Publishå¾Œã€`package.json`ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’æ›´æ–°

**âœ… æ¨å¥¨ä¾‹:**
```json
{
  "dependencies": {
    "llm-toolkit": "^1.2.3"  // OK: å…¬é–‹ãƒãƒ¼ã‚¸ãƒ§ãƒ³æŒ‡å®š
  }
}
```

#### 3. `workspace/` ã¨ã‚³ãƒ¼ãƒ‰å‚ç…§

- å¤–éƒ¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ã‚³ãƒ¼ãƒ‰ã‚’ã€Œèª­ã‚€ãŸã‚ã€ã« `workspace/` ã¸ `git clone` ã™ã‚‹ã®ã¯è‡ªç”±
- ãŸã ã—ã€ä¾å­˜é–¢ä¿‚ã¨ã—ã¦ãƒªãƒ³ã‚¯ã™ã‚‹ã“ã¨ã¯å³ç¦

### 6.6. Gitã‚³ãƒŸãƒƒãƒˆãƒãƒªã‚·ãƒ¼

* **ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸:** ç°¡æ½”ã‹ã¤æ˜ç¢ºã«ï¼ˆä½•ã‚’å¤‰æ›´ã—ãŸã‹ï¼‰
* **`.gitignore`:** ä»¥ä¸‹ã¯å¿…ãšé™¤å¤–
  - ç’°å¢ƒå¤‰æ•°ãƒ•ã‚¡ã‚¤ãƒ« (`.env`, `.env.local`, `.env.*.local`)
  - ãƒ“ãƒ«ãƒ‰æˆæœç‰© (`target/`, `dist/`, `build/`)
  - å€‹äººä½œæ¥­å ´ (`workspace/`)
  - IDEè¨­å®šã€OSå›ºæœ‰ãƒ•ã‚¡ã‚¤ãƒ«

---
## 7. é–‹ç™ºã‚³ãƒãƒ³ãƒ‰ä¸€è¦§

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã‹ã‚‰å®Ÿè¡Œã§ãã‚‹ä¸»è¦ã‚³ãƒãƒ³ãƒ‰ï¼š

### Frontend
```bash
npm run dev:frontend      # é–‹ç™ºã‚µãƒ¼ãƒãƒ¼èµ·å‹•
npm run build:frontend    # ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³ãƒ“ãƒ«ãƒ‰
npm run preview:frontend  # ãƒ“ãƒ«ãƒ‰çµæœã®ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼
```

### Backend
```bash
npm run dev:backend       # Shuttle ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºã‚µãƒ¼ãƒãƒ¼èµ·å‹•
npm run check:backend     # ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ãƒã‚§ãƒƒã‚¯
npm run build:backend     # ãƒªãƒªãƒ¼ã‚¹ãƒ“ãƒ«ãƒ‰
npm run test:backend      # ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
npm run deploy:backend    # Shuttleã¸ãƒ‡ãƒ—ãƒ­ã‚¤
```

### Supabase
```bash
# ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
npm run supabase:link             # Supabaseãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ãƒªãƒ³ã‚¯
npm run supabase:migration:new    # æ–°è¦ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ä½œæˆ
npm run supabase:push             # ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³é©ç”¨

# Edge Functions
npm run supabase:function:new     # æ–°è¦Functionä½œæˆ
npm run supabase:function:deploy  # Functionãƒ‡ãƒ—ãƒ­ã‚¤
```

## 8. UIå®Ÿè£…ã®æ¨™æº–è¨­è¨ˆãƒ‘ã‚¿ãƒ¼ãƒ³

### VibeCoding ãƒ‡ã‚¶ã‚¤ãƒ³åŸå‰‡

Akatsukiã§ã¯ã€**è¦‹æ „ãˆã®è‰¯ã•**ã¨**ä½¿ã„ã‚„ã™ã•**ã‚’é‡è¦–ã—ãŸã€ŒãƒªãƒƒãƒãªUIã€ã‚’æ¨™æº–ã¨ã—ã¾ã™ã€‚

#### ãƒ‡ã‚¶ã‚¤ãƒ³ã‚¹ã‚¿ã‚¤ãƒ«

1. **Glassmorphismï¼ˆã‚°ãƒ©ã‚¹ãƒ¢ãƒ¼ãƒ•ã‚£ã‚ºãƒ ï¼‰**
   - åŠé€æ˜ã®èƒŒæ™¯ (`bg-white/80`, `bg-black/60`)
   - backdrop-bluråŠ¹æœ (`backdrop-blur-md`, `backdrop-blur-lg`)
   - æŸ”ã‚‰ã‹ã„å½± (`shadow-lg`, `shadow-xl`)

2. **Gradient Designï¼ˆã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‡ã‚¶ã‚¤ãƒ³ï¼‰**
   - èƒŒæ™¯ãƒ»ãƒœã‚¿ãƒ³ãƒ»ãƒ†ã‚­ã‚¹ãƒˆã«ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å¤šç”¨
   - è¯ã‚„ã‹ã§å°è±¡çš„ãªãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«
   - `bg-gradient-to-r`, `bg-gradient-to-br`

3. **Soft UIï¼ˆã‚½ãƒ•ãƒˆUIï¼‰**
   - ä¸¸ã¿ã®ã‚ã‚‹è¦ç´  (`rounded-xl`, `rounded-3xl`)
   - æŸ”ã‚‰ã‹ã„å°è±¡
   - ä½™ç™½ã‚’ãŸã£ã·ã‚Šä½¿ç”¨

**Akatsuki Design Language: "Vibrant Soft UI"**
- è¯ã‚„ã‹ã•ã¨æŸ”ã‚‰ã‹ã•ã‚’ä¸¡ç«‹
- AIã‚¢ãƒ—ãƒªã«æœ€é©ãªè¦ªã—ã¿ã‚„ã™ã„ãƒ‡ã‚¶ã‚¤ãƒ³

#### ã‚«ãƒ©ãƒ¼ãƒ†ãƒ¼ãƒãƒãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³

**1. ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼ˆAIã‚¢ãƒ—ãƒªå‘ã‘ï¼‰- ãƒ”ãƒ³ã‚¯/ãƒ‘ãƒ¼ãƒ—ãƒ«/ãƒ–ãƒ«ãƒ¼**
```css
bg-gradient-to-br from-pink-100 via-purple-100 to-blue-100
bg-gradient-to-r from-pink-500 via-purple-500 to-blue-500 text-transparent bg-clip-text
bg-gradient-to-r from-pink-500 to-purple-600
```

**2. ãƒ“ã‚¸ãƒã‚¹/ä¼æ¥­å‘ã‘ - ãƒ€ãƒ¼ã‚¯/ãƒ–ãƒ«ãƒ¼ãƒˆãƒ¼ãƒ³**
```css
bg-gradient-to-br from-slate-900 via-blue-900 to-slate-800
bg-gradient-to-r from-blue-400 via-cyan-400 to-teal-400 text-transparent bg-clip-text
bg-gradient-to-r from-blue-600 to-cyan-600
```

**3. ãƒ˜ãƒ«ã‚¹ã‚±ã‚¢/ã‚¦ã‚§ãƒ«ãƒã‚¹ - ã‚°ãƒªãƒ¼ãƒ³/ãƒŸãƒ³ãƒˆ**
```css
bg-gradient-to-br from-emerald-50 via-teal-50 to-cyan-50
bg-gradient-to-r from-emerald-500 via-teal-500 to-cyan-500 text-transparent bg-clip-text
```

**4. ã‚¨ãƒ³ã‚¿ãƒ¡/ã‚¯ãƒªã‚¨ã‚¤ãƒ†ã‚£ãƒ– - ã‚ªãƒ¬ãƒ³ã‚¸/ã‚¤ã‚¨ãƒ­ãƒ¼**
```css
bg-gradient-to-br from-orange-100 via-yellow-100 to-pink-100
bg-gradient-to-r from-orange-500 via-yellow-500 to-pink-500 text-transparent bg-clip-text
```

**5. Eã‚³ãƒãƒ¼ã‚¹/ã‚·ãƒ§ãƒƒãƒ”ãƒ³ã‚° - ãƒ‘ãƒ¼ãƒ—ãƒ«/ãƒ”ãƒ³ã‚¯**
```css
bg-gradient-to-br from-purple-100 via-pink-100 to-rose-100
bg-gradient-to-r from-purple-500 via-pink-500 to-rose-500 text-transparent bg-clip-text
```

**6. ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰å¯¾å¿œ**
```css
bg-gradient-to-br from-gray-900 via-slate-800 to-gray-900
bg-gradient-to-r from-pink-400 via-purple-400 to-blue-400 text-transparent bg-clip-text
bg-slate-800/50 backdrop-blur-lg border border-slate-700
```

**ä½¿ã„åˆ†ã‘ã‚¬ã‚¤ãƒ‰:**
- ãƒ—ãƒªã‚¯ãƒ©/AIç”»åƒç”Ÿæˆ â†’ ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼ˆãƒ”ãƒ³ã‚¯/ãƒ‘ãƒ¼ãƒ—ãƒ«/ãƒ–ãƒ«ãƒ¼ï¼‰
- ãƒ“ã‚¸ãƒã‚¹ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ â†’ ãƒ“ã‚¸ãƒã‚¹å‘ã‘ï¼ˆãƒ€ãƒ¼ã‚¯/ãƒ–ãƒ«ãƒ¼ï¼‰
- ãƒ˜ãƒ«ã‚¹ã‚±ã‚¢ã‚¢ãƒ—ãƒª â†’ ã‚°ãƒªãƒ¼ãƒ³/ãƒŸãƒ³ãƒˆ
- éŸ³æ¥½/å‹•ç”»ã‚¢ãƒ—ãƒª â†’ ã‚ªãƒ¬ãƒ³ã‚¸/ã‚¤ã‚¨ãƒ­ãƒ¼
- ECã‚µã‚¤ãƒˆ â†’ ãƒ‘ãƒ¼ãƒ—ãƒ«/ãƒ”ãƒ³ã‚¯

#### ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«é‡è¦–ã®åŸå‰‡

âœ… **ã‚„ã‚‹ã¹ãã“ã¨:**
- **ç”»åƒã‚’ç©æ¥µçš„ã«ä½¿ã†** - ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ç”»åƒã€ç”Ÿæˆç”»åƒã€ã‚¢ã‚¤ã‚³ãƒ³ç”»åƒ
- **ã‚¢ã‚¤ã‚³ãƒ³ã‚’å¤šç”¨** - lucide-react ã§è¦–è¦šçš„ã«ã‚ã‹ã‚Šã‚„ã™ã
- **ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã§è¯ã‚„ã‹ã«** - èƒŒæ™¯ã€ãƒœã‚¿ãƒ³ã€ã‚«ãƒ¼ãƒ‰ã«é©ç”¨
- **ä¸¸ã¿ã®ã‚ã‚‹ãƒ‡ã‚¶ã‚¤ãƒ³** - `rounded-lg`, `rounded-xl`, `rounded-3xl`
- **ä½™ç™½ã‚’ãŸã£ã·ã‚Š** - `space-y-6`, `gap-4` ãªã©ã§è©°ã‚è¾¼ã¾ãªã„
- **CTAãƒœã‚¿ãƒ³ã¯å¤§ãã** - `size="lg"` ã¾ãŸã¯ `size="xl"`ã€ç›®ç«‹ã¤é…è‰²

âŒ **é¿ã‘ã‚‹ã¹ãã“ã¨:**
- ç™½é»’ã®ã‚·ãƒ³ãƒ—ãƒ«ã™ãã‚‹UI
- ãƒ†ã‚­ã‚¹ãƒˆã ã‘ã®ç¾…åˆ—
- å°ã•ãã¦ç›®ç«‹ãŸãªã„ãƒœã‚¿ãƒ³
- çµµæ–‡å­—ã®éåº¦ãªä½¿ç”¨ï¼ˆã‚¢ã‚¤ã‚³ãƒ³å„ªå…ˆï¼‰

#### å¿…é ˆè¦ä»¶
- **ç”»é¢æ•°:** æœ€ä½3ç”»é¢ä»¥ä¸Š
- **ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³:** ãƒˆãƒƒãƒ—ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒãƒ¼å¿…é ˆï¼ˆè¤‡é›‘ãªã‚¢ãƒ—ãƒªã¯å·¦ãƒšã‚¤ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚‚æ¤œè¨ï¼‰
- **ã‚¢ã‚¤ã‚³ãƒ³:** lucide-reactã®ã‚¢ã‚¤ã‚³ãƒ³å„ªå…ˆä½¿ç”¨ã€çµµæ–‡å­—ã¯è£…é£¾ã®ã¿
- **ãƒªãƒƒãƒUI:** shadcn/uiã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå¿…é ˆä½¿ç”¨
- **ãƒ‡ã‚¶ã‚¤ãƒ³:** ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã€ä¸¸ã¿ã®ã‚ã‚‹ã‚«ãƒ¼ãƒ‰
- **CTAãƒœã‚¿ãƒ³:** ãƒ¡ã‚¤ãƒ³ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆç”Ÿæˆã€ä¿å­˜ãªã©ï¼‰ã¯å¤§ããç›®ç«‹ãŸã›ã‚‹ï¼ˆsize="lg" or "xl"ï¼‰
- **ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–:** ãƒ¢ãƒã‚¤ãƒ«ãƒ»ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆãƒ»ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—å¯¾å¿œï¼ˆTailwindã®ãƒ–ãƒ¬ãƒ¼ã‚¯ãƒã‚¤ãƒ³ãƒˆæ´»ç”¨ï¼‰

### æ¨å¥¨ãƒ‡ã‚¶ã‚¤ãƒ³ãƒ‘ã‚¿ãƒ¼ãƒ³é›†

#### ä¸»è¦ãƒ‘ã‚¿ãƒ¼ãƒ³ä¸€è¦§

1. **Hero Sectionï¼ˆãƒ’ãƒ¼ãƒ­ãƒ¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼‰** - ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ã®ç¬¬ä¸€å°è±¡
   - `min-h-screen`, `bg-gradient-to-br`, `text-6xl`, `bg-clip-text`, `Button variant="gradient"`

2. **Feature Cardsï¼ˆæ©Ÿèƒ½ã‚«ãƒ¼ãƒ‰ï¼‰** - æ©Ÿèƒ½ç´¹ä»‹ã€ãƒ¡ãƒ‹ãƒ¥ãƒ¼é¸æŠ
   - `grid md:grid-cols-3`, `Card`, `hover:border-pink-300`, lucide-reactã‚¢ã‚¤ã‚³ãƒ³

3. **Image Galleryï¼ˆç”»åƒã‚®ãƒ£ãƒ©ãƒªãƒ¼ï¼‰** - ç”Ÿæˆç”»åƒã®è¡¨ç¤ºã€ä½œå“ä¸€è¦§
   - `grid grid-cols-2 md:grid-cols-3`, `group`, `hover:scale-105`, `hover:shadow-2xl`

4. **Step-by-Step UIï¼ˆã‚¹ãƒ†ãƒƒãƒ—å¼UIï¼‰** - è¤‡æ•°ã‚¹ãƒ†ãƒƒãƒ—ã®ä½œæˆãƒ•ãƒ­ãƒ¼
   - `Progress`, `useState(currentStep)`, æ¡ä»¶åˆ†å²ã§Stepè¡¨ç¤º

5. **Loading & Empty Statesï¼ˆãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãƒ»ç©ºçŠ¶æ…‹ï¼‰** - ãƒ‡ãƒ¼ã‚¿å–å¾—ä¸­ã€ãƒ‡ãƒ¼ã‚¿ãªã—
   - `animate-spin`, `flex items-center justify-center`, lucide-reactã‚¢ã‚¤ã‚³ãƒ³

6. **Image Upload Previewï¼ˆç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼‰** - ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ™‚ã®ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼
   - `relative`, `absolute top-2 right-2`, `rounded-xl shadow-lg`

**è©³ç´°ãªå®Ÿè£…ä¾‹:** `src/pages/ExamplesPage.jsx` ãŠã‚ˆã³ `src/pages/HomePage.jsx` ã‚’å‚ç…§

### æ¨å¥¨ã™ã‚‹è¦–è¦šè¦ç´ 

#### ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³é…è‰²ãƒ‘ã‚¿ãƒ¼ãƒ³

```css
/* èƒŒæ™¯ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ */
bg-gradient-to-br from-pink-100 via-purple-100 to-blue-100
bg-gradient-to-br from-purple-50 via-pink-50 to-yellow-50
bg-gradient-to-br from-blue-50 via-cyan-50 to-teal-50

/* ãƒ†ã‚­ã‚¹ãƒˆã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ */
bg-gradient-to-r from-pink-500 via-purple-500 to-blue-500 text-transparent bg-clip-text

/* ãƒœã‚¿ãƒ³ãƒ»ã‚«ãƒ¼ãƒ‰ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ */
bg-gradient-to-r from-pink-500 to-purple-600
bg-gradient-to-r from-blue-500 to-cyan-600
bg-gradient-to-r from-orange-500 to-pink-600
```

#### ã‚¢ã‚¤ã‚³ãƒ³ã®ä½¿ã„æ–¹

**lucide-react ã®æ¨å¥¨ã‚¢ã‚¤ã‚³ãƒ³:**
- `Sparkles` - AIç”Ÿæˆã€ã‚­ãƒ©ã‚­ãƒ©åŠ¹æœ
- `Wand2` - é­”æ³•ã€å¤‰æ›
- `Image` - ç”»åƒé–¢é€£
- `Camera` - æ’®å½±ã€ã‚«ãƒ¡ãƒ©
- `Palette` - ã‚«ãƒ©ãƒ¼ã€ãƒ‡ã‚¶ã‚¤ãƒ³
- `Download` - ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
- `Upload` - ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
- `Heart` - ãŠæ°—ã«å…¥ã‚Š
- `Star` - è©•ä¾¡
- `Zap` - é«˜é€Ÿã€ãƒ‘ãƒ¯ãƒ¼

**ã‚¢ã‚¤ã‚³ãƒ³ã‚µã‚¤ã‚º:**
- å°: `w-4 h-4` (ãƒœã‚¿ãƒ³å†…)
- ä¸­: `w-6 h-6` (ã‚«ãƒ¼ãƒ‰å†…)
- å¤§: `w-8 h-8` (ãƒ¡ã‚¤ãƒ³è¦ç´ )
- ç‰¹å¤§: `w-12 h-12` (Hero Section)

#### ä¸¸ã¿ã®ãƒ¬ãƒ™ãƒ«

```css
rounded-md     /* å°: ãƒœã‚¿ãƒ³ã€ãƒãƒƒã‚¸ */
rounded-lg     /* ä¸­: ã‚«ãƒ¼ãƒ‰ã€å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ */
rounded-xl     /* å¤§: ãƒ¡ã‚¤ãƒ³ã‚«ãƒ¼ãƒ‰ã€ç”»åƒ */
rounded-2xl    /* ç‰¹å¤§: Feature Cards */
rounded-3xl    /* è¶…ç‰¹å¤§: Hero Section ã‚«ãƒ¼ãƒ‰ */
rounded-full   /* å††å½¢: ã‚¢ãƒã‚¿ãƒ¼ã€ã‚¢ã‚¤ã‚³ãƒ³ãƒœã‚¿ãƒ³ */
```

### ã‚«ãƒ†ã‚´ãƒªåˆ¥æ¨™æº–è¨­è¨ˆ

#### ãƒ—ãƒªã‚¯ãƒ©ç³»ã‚¢ãƒ—ãƒª
**ç”»é¢æ•°:** 3-5ç”»é¢

**æ¨å¥¨ãƒ•ãƒ­ãƒ¼:**
```
ãƒ›ãƒ¼ãƒ  â†’ ã‚¹ãƒ†ãƒƒãƒ—å¼ä½œæˆ â†’ å†™çœŸç”Ÿæˆ â†’ ã‚®ãƒ£ãƒ©ãƒªãƒ¼
```

**å®Ÿè£…ã‚¤ãƒ¡ãƒ¼ã‚¸:**
- ãƒ›ãƒ¼ãƒ : 3ã¤ã®æ©Ÿèƒ½ã‚«ãƒ¼ãƒ‰ï¼ˆã‚¢ã‚¤ã‚³ãƒ³ä»˜ãï¼‰
- ä½œæˆãƒ•ãƒ­ãƒ¼: ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ + ã‚¹ãƒ†ãƒƒãƒ—å¼UIï¼ˆé«ªè‰²â†’ãƒ¡ã‚¤ã‚¯â†’ãƒãƒ¼ã‚ºï¼‰
- ç”Ÿæˆç”»é¢: ãƒ•ãƒ¬ãƒ¼ãƒ é¸æŠ + ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼é¸æŠ
- ã‚®ãƒ£ãƒ©ãƒªãƒ¼: ã‚°ãƒªãƒƒãƒ‰è¡¨ç¤ºï¼ˆ2åˆ— or 3åˆ—ï¼‰

**UIè¦ç´ :**
- ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³èƒŒæ™¯ï¼ˆãƒ”ãƒ³ã‚¯/ç´«/é’ï¼‰
- Buttonï¼ˆgradient variantï¼‰
- Cardï¼ˆrounded-3xlï¼‰
- Progressï¼ˆã‚¹ãƒ†ãƒƒãƒ—è¡¨ç¤ºï¼‰
- Badgeï¼ˆNEWã€äººæ°—è¡¨ç¤ºï¼‰

### 8.9. VibeCoding Design Templatesï¼ˆå®Ÿè£…ã®å‚è€ƒãƒ‘ã‚¿ãƒ¼ãƒ³é›†ï¼‰

**é‡è¦: ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®ä½¿ã„æ–¹**
- âš ï¸ **ãã®ã¾ã¾é©ç”¨ã™ã‚‹ã‚‚ã®ã§ã¯ãªã„** - WordPressã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¨ã¯é•ã†
- âœ… **å‚è€ƒã«ã—ã¦è‡ªç”±ã«è¨­è¨ˆ** - è¿‘ã„ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æŠŠæ¡ã—ã€è¦ä»¶ã«å¿œã˜ã¦ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º
- âœ… **å®Ÿè£…æ¸ˆã¿ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’æ´»ç”¨** - AuthGuard, useAIGen, FileUploadç­‰ã‚’å†åˆ©ç”¨
- âœ… **å‘½åè¦å‰‡ã«å¾“ã†** - Model, Repository, Serviceç­‰ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ç¶­æŒ

**VibeCodingã®æœ¬è³ª:**
- ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚¨ãƒ³ã‚¸ãƒ³ã§ã¯ãªãã€è‡ªç”±åº¦ã®é«˜ã„è¨­è¨ˆã‚’å®Ÿç¾
- Akatsukiã®åŸºç›¤ï¼ˆçµ±ä¸€ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã€Repository/Modelãƒ‘ã‚¿ãƒ¼ãƒ³ç­‰ï¼‰ã‚’æ´»ç”¨
- ã‚¹ãƒ”ãƒ¼ãƒ‰ã¨å“è³ªã‚’ä¸¡ç«‹

#### Template 1: AIç”»åƒç”Ÿæˆã‚¢ãƒ—ãƒªï¼ˆãƒ—ãƒªã‚¯ãƒ©ç³»ï¼‰

**ç”»é¢æ§‹æˆ:** `HomePage (/) â†’ CreationPage (/create) â†’ GalleryPage (/gallery)`

**DBè¨­è¨ˆ:**
```sql
profiles                    -- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ï¼ˆå®Ÿè£…æ¸ˆã¿ï¼‰
file_metadata              -- ç”Ÿæˆç”»åƒï¼ˆå®Ÿè£…æ¸ˆã¿ï¼‰
user_quotas                -- ä½¿ç”¨åˆ¶é™ï¼ˆå®Ÿè£…æ¸ˆã¿ï¼‰
creation_templates         -- ä½œæˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆï¼ˆæ–°è¦ï¼‰
user_creations             -- ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆç‰©ï¼ˆæ–°è¦ï¼‰
```

**å®Ÿè£…ãƒ¬ã‚¤ãƒ¤ãƒ¼:**
- Models: UserProfile.js (å®Ÿè£…æ¸ˆã¿), CreationTemplate.js (æ–°è¦)
- Repositories: UserProfileRepository.js (å®Ÿè£…æ¸ˆã¿), CreationTemplateRepository.js (æ–°è¦)
- Services: ImageGenerationService.js (å®Ÿè£…æ¸ˆã¿), PublicStorageService.js (å®Ÿè£…æ¸ˆã¿)
- Hooks: useAIGen.js (å®Ÿè£…æ¸ˆã¿), useImageGeneration.js (æ–°è¦)
- Components: AuthGuard, TopNavigation, FileUpload (å®Ÿè£…æ¸ˆã¿), CreationFlow, TemplateSelector, ImageGallery (æ–°è¦)

**Edge Functions:** generate-image, upload-file (å®Ÿè£…æ¸ˆã¿)

**å®Ÿè£…ãƒ•ãƒ­ãƒ¼:**
1. Migrationä½œæˆ â†’ 2. Modelä½œæˆ â†’ 3. Repositoryä½œæˆ â†’ 4. Custom Hookä½œæˆ â†’ 5. Feature Componentsä½œæˆ â†’ 6. Pagesä½œæˆ â†’ 7. Routingè¨­å®š

---

#### Template 2: LLMãƒãƒ£ãƒƒãƒˆã‚¢ãƒ—ãƒª

**ç”»é¢æ§‹æˆ:** `HomePage (/) â†’ ChatPage (/chat) â†’ HistoryPage (/history)`

**DBè¨­è¨ˆ:**
```sql
profiles                   -- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ï¼ˆå®Ÿè£…æ¸ˆã¿ï¼‰
ai_models                  -- AIãƒ¢ãƒ‡ãƒ«æƒ…å ±ï¼ˆå®Ÿè£…æ¸ˆã¿ï¼‰
llm_call_logs              -- LLMå‘¼ã³å‡ºã—å±¥æ­´ï¼ˆå®Ÿè£…æ¸ˆã¿ï¼‰
user_quotas                -- ä½¿ç”¨åˆ¶é™ï¼ˆå®Ÿè£…æ¸ˆã¿ï¼‰
chat_sessions              -- ãƒãƒ£ãƒƒãƒˆã‚»ãƒƒã‚·ãƒ§ãƒ³ï¼ˆæ–°è¦ï¼‰
chat_messages              -- ãƒãƒ£ãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆæ–°è¦ï¼‰
```

**å®Ÿè£…ãƒ¬ã‚¤ãƒ¤ãƒ¼:**
- Models: AIModel.js, UserProfile.js (å®Ÿè£…æ¸ˆã¿), ChatSession.js, ChatMessage.js (æ–°è¦)
- Repositories: AIModelRepository.js, UserQuotaRepository.js (å®Ÿè£…æ¸ˆã¿), ChatSessionRepository.js, ChatMessageRepository.js (æ–°è¦)
- Services: AIService.js, EdgeFunctionService.js (å®Ÿè£…æ¸ˆã¿)
- Hooks: useAIGen.js (å®Ÿè£…æ¸ˆã¿), useChatSession.js (æ–°è¦)
- Components: AuthGuard, TopNavigation (å®Ÿè£…æ¸ˆã¿), ChatCard, MessageList, ModelSelector (æ–°è¦)

**Edge Functions:** ai-chat (å®Ÿè£…æ¸ˆã¿ - OpenAI/Anthropic/Geminiå¯¾å¿œ)

**å®Ÿè£…ãƒ•ãƒ­ãƒ¼:** Migration â†’ Model â†’ Repository â†’ Hook â†’ Components â†’ Pages â†’ Routing

---

#### Template 3: ãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç†ã‚¢ãƒ—ãƒª

**ç”»é¢æ§‹æˆ:** `HomePage (/) â†’ UploadPage (/upload) â†’ FilesPage (/files)`

**DBè¨­è¨ˆ:**
```sql
profiles                   -- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ï¼ˆå®Ÿè£…æ¸ˆã¿ï¼‰
file_metadata              -- ãƒ•ã‚¡ã‚¤ãƒ«ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ï¼ˆå®Ÿè£…æ¸ˆã¿ï¼‰
file_folders               -- ãƒ•ã‚©ãƒ«ãƒ€ï¼ˆæ–°è¦ï¼‰
```

**å®Ÿè£…ãƒ¬ã‚¤ãƒ¤ãƒ¼:**
- Models: UserProfile.js (å®Ÿè£…æ¸ˆã¿), FileMetadata.js, FileFolder.js (æ–°è¦)
- Repositories: FileMetadataRepository.js (å®Ÿè£…æ¸ˆã¿), FileFolderRepository.js (æ–°è¦)
- Services: PublicStorageService.js, PrivateStorageService.js (å®Ÿè£…æ¸ˆã¿)
- Hooks: useFileUpload.js (æ–°è¦)
- Components: AuthGuard, FileUpload (å®Ÿè£…æ¸ˆã¿), FileList, FolderTree (æ–°è¦)

**Edge Functions:** upload-file, delete-file, get-signed-url, create-signed-url (å®Ÿè£…æ¸ˆã¿)

**å®Ÿè£…ãƒ•ãƒ­ãƒ¼:** Migration â†’ Model â†’ Repository â†’ Hook â†’ Components â†’ Pages â†’ Routing

---

#### Template 4: ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ï¼ˆãƒ‡ãƒ¼ã‚¿å¯è¦–åŒ–ï¼‰

**ç”»é¢æ§‹æˆ:** `HomePage (/) â†’ DashboardPage (/dashboard) â†’ ReportsPage (/reports)`

**DBè¨­è¨ˆ:**
```sql
profiles                   -- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ï¼ˆå®Ÿè£…æ¸ˆã¿ï¼‰
user_usage_stats           -- ä½¿ç”¨çµ±è¨ˆï¼ˆå®Ÿè£…æ¸ˆã¿ï¼‰
metrics                    -- ãƒ¡ãƒˆãƒªã‚¯ã‚¹ï¼ˆæ–°è¦ï¼‰
reports                    -- ãƒ¬ãƒãƒ¼ãƒˆï¼ˆæ–°è¦ï¼‰
```

**å®Ÿè£…ãƒ¬ã‚¤ãƒ¤ãƒ¼:**
- Models: UserProfile.js (å®Ÿè£…æ¸ˆã¿), UserUsageStats.js, Metric.js (æ–°è¦)
- Repositories: UserUsageStatsRepository.js (å®Ÿè£…æ¸ˆã¿), MetricRepository.js (æ–°è¦)
- Services: EdgeFunctionService.js (å®Ÿè£…æ¸ˆã¿)
- Hooks: useMetrics.js (æ–°è¦)
- Components: AuthGuard (å®Ÿè£…æ¸ˆã¿), MetricsCard, ChartCard, StatsOverview (æ–°è¦)
- UI Components: card.jsx, chart.jsx (Rechartsçµ±åˆ), table.jsx, badge.jsx

**Edge Functions:** generate-report (æ–°è¦ä½œæˆ)

**å®Ÿè£…ãƒ•ãƒ­ãƒ¼:** Migration â†’ Model â†’ Repository â†’ Edge Function â†’ Hook â†’ Components â†’ Pages â†’ Routing

---

#### ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆæ´»ç”¨ã®ãƒã‚¤ãƒ³ãƒˆ

1. **å®Ÿè£…æ¸ˆã¿ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’æœ€å¤§é™æ´»ç”¨**
   - AuthGuard, TopNavigation, FileUpload ã¯å¿…é ˆ
   - shadcn/ui ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯ã™ã¹ã¦åˆ©ç”¨å¯èƒ½

2. **Edge Functionsã®å†åˆ©ç”¨**
   - ai-chat, generate-image, upload-file ã¯å®Ÿè£…æ¸ˆã¿
   - æ–°è¦Edge Functionã¯çµ±ä¸€ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ï¼ˆcreateAkatsukiHandlerï¼‰ã‚’ä½¿ç”¨

3. **Repository/Model ãƒ‘ã‚¿ãƒ¼ãƒ³**
   - æ—¢å­˜ã® UserProfileRepository.js ã‚’å‚è€ƒã«å®Ÿè£…
   - fromDatabase(), toDatabase() ã‚’å¿…ãšå®Ÿè£…

4. **Custom Hooks ã«ã‚ˆã‚‹å†åˆ©ç”¨**
   - useAIGen.js ã‚’å‚è€ƒã«ã€Featureå›ºæœ‰ã®Hooksã‚’ä½œæˆ
   - ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã¯ã™ã¹ã¦Hooksã«é›†ç´„

---
## 9. ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ç’°å¢ƒãŒå‹•ã‹ãªã„æ™‚ã®ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

1. **Node.jsãƒãƒ¼ã‚¸ãƒ§ãƒ³ç¢ºèª:**
   ```bash
   node --version  # v20.x ä»¥ä¸Š
   nvm use         # ã¾ãŸã¯ asdf install
   ```

2. **Rustãƒãƒ¼ã‚¸ãƒ§ãƒ³ç¢ºèª:**
   ```bash
   rustc --version
   ```

3. **ä¾å­˜é–¢ä¿‚ã®å†ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«:**
   ```bash
   npm install
   cd packages/app-backend && cargo build
   ```

4. **ç’°å¢ƒå¤‰æ•°ã®ç¢ºèª:**
   ```bash
   cat packages/app-frontend/.env
   cat packages/app-backend/.env
   ```

5. **Supabaseæ¥ç¶šç¢ºèª:**
   - Supabaseãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒActiveã‹ç¢ºèª
   - DATABASE_URLã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒæ­£ã—ã„ã‹ç¢ºèª

---

### 9.2. VibeCodingä¸­ã®ã‚ˆãã‚ã‚‹ãƒˆãƒ©ãƒ–ãƒ«

å®Ÿè£…ä¸­ã«ç™ºç”Ÿã—ã‚„ã™ã„å•é¡Œã¨è§£æ±ºæ–¹æ³•ã‚’è¨˜è¼‰ã—ã¾ã™ã€‚

#### ã‚±ãƒ¼ã‚¹1: Edge Function ãŒ 500 ã‚¨ãƒ©ãƒ¼

**ç—‡çŠ¶:**
- Edge Functionå‘¼ã³å‡ºã—ãŒ500ã‚¨ãƒ©ãƒ¼ã§å¤±æ•—
- ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã§ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œãªã„

**è¨ºæ–­æ–¹æ³•:**
```bash
npx supabase functions logs ai-chat --tail
npx supabase functions logs generate-image --tail
```

**ã‚ˆãã‚ã‚‹åŸå› ã¨è§£æ±º:**

1. **Secretsæœªè¨­å®š**
   ```bash
   npx supabase secrets list
   npx supabase secrets set OPENAI_API_KEY=sk-...
   ```

2. **CORSè¨­å®šæ¼ã‚Œ**
   - çµ±ä¸€ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ï¼ˆcreateAkatsukiHandler, createSystemHandlerï¼‰ã‚’ä½¿ç”¨ã—ã¦ã„ã‚Œã°è‡ªå‹•å¯¾å¿œæ¸ˆã¿

3. **èªè¨¼ã‚¨ãƒ©ãƒ¼**
   ```typescript
   createAkatsukiHandler(req, {
     requireAuth: true,  // â† ã“ã‚Œã‚’å¿˜ã‚Œãšã«
   })
   ```

4. **å…¥åŠ›ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼**
   ```typescript
   createAkatsukiHandler<Input, Output>(req, {
     inputSchema: InputSchema,  // â† ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³è‡ªå‹•å®Ÿè¡Œ
   })
   ```

---

#### ã‚±ãƒ¼ã‚¹2: RLSã§ãƒ‡ãƒ¼ã‚¿å–å¾—ã§ããªã„

**ç—‡çŠ¶:**
- ãƒ­ã‚°ã‚¤ãƒ³æ¸ˆã¿ãªã®ã«ã€è‡ªåˆ†ã®ãƒ‡ãƒ¼ã‚¿ãŒå–å¾—ã§ããªã„
- `profiles` ãƒ†ãƒ¼ãƒ–ãƒ«ãŒç©ºé…åˆ—ã§è¿”ã£ã¦ãã‚‹

**è¨ºæ–­æ–¹æ³•:**
```sql
SELECT * FROM pg_policies WHERE tablename = 'profiles';
SELECT auth.uid();  -- null ã®å ´åˆã¯æœªãƒ­ã‚°ã‚¤ãƒ³
```

**ã‚ˆãã‚ã‚‹åŸå› ã¨è§£æ±º:**

1. **Policyæœªä½œæˆ**
   ```sql
   CREATE POLICY "Users can read own profile"
     ON profiles FOR SELECT
     USING (auth.uid() = user_id);
   ```

2. **auth.uid() ãŒ null** - ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ç¢ºèªã€èªè¨¼ãƒã‚§ãƒƒã‚¯

3. **adminClient ä½¿ã†ã¹ãç®‡æ‰€ã§ userClient ã‚’ä½¿ç”¨**
   ```typescript
   // âŒ æ‚ªã„ä¾‹: Usageæ›´æ–°ã‚’userClientã§å®Ÿè¡Œï¼ˆRLSã§æ‹’å¦ã•ã‚Œã‚‹ï¼‰
   await userClient.from('user_quotas').update({ usage: usage + 1 })

   // âœ… è‰¯ã„ä¾‹: ReposçµŒç”±ã§adminClientä½¿ç”¨ï¼ˆæ”¹ã–ã‚“é˜²æ­¢ï¼‰
   await repos.userQuota.incrementUsage(quotaId)
   ```

---

#### ã‚±ãƒ¼ã‚¹3: Repository/Model ã§å‹ã‚¨ãƒ©ãƒ¼

**ç—‡çŠ¶:**
- `UserProfile.fromDatabase is not a function`
- `Cannot read property 'toDatabase' of undefined`

**ã‚ˆãã‚ã‚‹åŸå› ã¨è§£æ±º:**

1. **fromDatabase() ã®å®Ÿè£…æ¼ã‚Œ**
   ```javascript
   // âœ… å¿…ãš fromDatabase() ã¨ toDatabase() ã‚’å®Ÿè£…
   class UserProfile {
     static fromDatabase(data) {
       return new UserProfile({
         userId: data.user_id,       // snake_case â†’ camelCase
         username: data.username,
       })
     }

     toDatabase() {
       return {
         user_id: this.userId,       // camelCase â†’ snake_case
         username: this.username,
       }
     }
   }
   ```

2. **Repository ã§ Model ã‚’ä½¿ã‚ãšã«ç›´æ¥è¿”ã™**
   ```javascript
   // âŒ æ‚ªã„ä¾‹: DBãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’ç›´æ¥è¿”ã™
   return data  // snake_case ã®ã¾ã¾

   // âœ… è‰¯ã„ä¾‹: Model çµŒç”±ã§å¤‰æ›
   return UserProfile.fromDatabase(data)
   ```

3. **import æ¼ã‚Œ**
   ```javascript
   import { UserProfile } from '../models/UserProfile'
   ```

---

#### ã‚±ãƒ¼ã‚¹4: Migrationé©ç”¨ã§ããªã„

**ç—‡çŠ¶:**
- `npm run supabase:push` ãŒã‚¨ãƒ©ãƒ¼
- `duplicate key value violates unique constraint`

**è¨ºæ–­æ–¹æ³•:**
```bash
npx supabase migration list
```

**ã‚ˆãã‚ã‚‹åŸå› ã¨è§£æ±º:**

1. **æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã¨ã®ç«¶åˆ**
   ```sql
   -- âŒ æ‚ªã„ä¾‹: æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚‹ã®ã« NOT NULL åˆ¶ç´„è¿½åŠ 
   ALTER TABLE profiles ADD COLUMN role TEXT NOT NULL;

   -- âœ… è‰¯ã„ä¾‹: DEFAULT å€¤ã‚’è¨­å®š
   ALTER TABLE profiles ADD COLUMN role TEXT NOT NULL DEFAULT 'user';
   ```

2. **Migrationé †åºã®å•é¡Œ** - ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ç¢ºèª

3. **æ‰‹å‹•ã§DBã‚’å¤‰æ›´ã—ã¦ã—ã¾ã£ãŸ** - Migration ã«åæ˜ 

---

#### ã‚±ãƒ¼ã‚¹5: EdgeFunctionService ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹å½¢å¼ã‚¨ãƒ©ãƒ¼

**ç—‡çŠ¶:**
- Edge Functionã¯æˆåŠŸã—ã¦ã„ã‚‹ã®ã«ã€ã‚µãƒ¼ãƒ“ã‚¹å±¤ã§ã€Œãƒ‡ãƒ¼ã‚¿ãŒãªã„ã€ã‚¨ãƒ©ãƒ¼
- `No image data returned` ãªã©ã®ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸

**è¨ºæ–­æ–¹æ³•:**
```javascript
const { data, error } = await EdgeFunctionService.invoke('generate-image', {...})
console.log('[Debug] EdgeFunctionService response:', { data, error })
```

**åŸå› :**
`EdgeFunctionService.invoke()` ã¯ **`{ data, error }` å½¢å¼** ã‚’è¿”ã—ã¾ã™ã€‚

**è§£æ±ºæ–¹æ³•:**

```javascript
// âŒ æ‚ªã„ä¾‹: åˆ†å‰²ä»£å…¥ã›ãšã«ä½¿ç”¨
const result = await EdgeFunctionService.invoke('generate-image', {...})
if (!result.image_data) {  // â† result.data.image_data ãŒæ­£ã—ã„
  throw new Error('No data')
}

// âœ… è‰¯ã„ä¾‹: { data, error } å½¢å¼ã§åˆ†å‰²ä»£å…¥
const { data, error } = await EdgeFunctionService.invoke('generate-image', {...})
if (error) {
  return { data: null, error }
}

if (!data || !data.image_data) {
  return { data: null, error: new Error('No image data returned') }
}

console.log(data.image_data)
```

**é‡è¦:**
- ã™ã¹ã¦ã®Serviceã¯ `{ data, error }` å½¢å¼ã‚’è¿”ã™ï¼ˆçµ±ä¸€ä»•æ§˜ï¼‰
- **ã‚¨ãƒ©ãƒ¼æ™‚ã‚‚ throw ã—ãªã„**: `{ data: null, error: Error }` ã‚’è¿”ã™
- å‘¼ã³å‡ºã—å´ã§å¿…ãš `error` ãƒã‚§ãƒƒã‚¯ã‚’è¡Œã†
- React Query ã¨ã®ç›¸æ€§ãŒè‰¯ã„è¨­è¨ˆ

---

#### Akatsukiå›ºæœ‰ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

**çµ±ä¸€ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆæœ€é‡è¦ï¼‰:**
```typescript
import { createAkatsukiHandler } from '../_shared/handler.ts'

Deno.serve(async (req) => {
  return createAkatsukiHandler(req, {
    requireAuth: true,
    inputSchema: InputSchema,
    logic: async ({ userClient, adminClient, repos }) => {
      // userClient: RLSæœ‰åŠ¹
      // adminClient: RLSãƒã‚¤ãƒ‘ã‚¹ï¼ˆUsageç­‰ã®æ”¹ã–ã‚“é˜²æ­¢ï¼‰
      // repos: Repositoryé›†ç´„ï¼ˆadminClientçµŒç”±ï¼‰
      return { result: 'success' }
    }
  })
})
```

**Repository/Model ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆå¿…é ˆï¼‰:**
```javascript
// âœ… å¿…ãš Model çµŒç”±ã§DBå¤‰æ›
const data = await UserProfileRepository.findByUserId(userId)
const profile = UserProfile.fromDatabase(data)  // snake_case â†’ camelCase
await UserProfileRepository.update(userId, profile.toDatabase())
```

**RLSè¨­è¨ˆã‚’æœ€åˆã‹ã‚‰ï¼ˆé‡è¦ï¼‰:**
```sql
CREATE TABLE profiles (...);
ALTER TABLE profiles ENABLE ROW LEVEL SECURITY;
CREATE POLICY "Users can read own profile"
  ON profiles FOR SELECT
  USING (auth.uid() = user_id);
```

**Edge Functions ãƒ­ã‚°ç¢ºèªï¼ˆãƒˆãƒ©ãƒ–ãƒ«æ™‚å¿…é ˆï¼‰:**
```bash
npx supabase functions logs ai-chat --tail
npx supabase secrets list
```

---
## 10. ã•ã‚‰ã«è©³ã—ã

- **ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ:** `README.md`
- **Backend APIè©³ç´°:** `packages/app-backend/README.md`
- **ãƒ‡ãƒ—ãƒ­ã‚¤æ‰‹é †:** `docs/guide/` (ä»Šå¾Œè¿½åŠ äºˆå®š)

---

## 10. Supabase è¨­å®š (Supabase Configuration)

### Edge Functions

ç¾åœ¨ãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚Œã¦ã„ã‚‹Edge Functions:

1. **ai-chat** - ãƒãƒ«ãƒãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼LLM API
   - Providers: OpenAI, Anthropic (Claude), Google (Gemini)
   - Default models: `gpt-4o-mini`, `claude-sonnet-4-5-20250929`, `gemini-2.5-flash`

2. **upload-file** - ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
   - Public/Private ãƒã‚±ãƒƒãƒˆå¯¾å¿œã€æœ€å¤§ã‚µã‚¤ã‚º: 10MB

3. **create-signed-url** - Signed URL ç”Ÿæˆï¼ˆãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ç”¨ï¼‰

### Storage Buckets

1. **uploads** (Public)
   - å…¬é–‹ãƒ•ã‚¡ã‚¤ãƒ«ç”¨ã€RLS: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯è‡ªåˆ†ã®ãƒ•ã‚©ãƒ«ãƒ€ã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å¯èƒ½ã€èª°ã§ã‚‚èª­ã¿å–ã‚Šå¯èƒ½

2. **private_uploads** (Private)
   - ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ç”¨ã€RLS: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯è‡ªåˆ†ã®ãƒ•ã‚¡ã‚¤ãƒ«ã®ã¿ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ã€Signed URLå¿…é ˆ

### Required Secrets

```bash
# LLM Provider API Keys
OPENAI_API_KEY=sk-...
ANTHROPIC_API_KEY=sk-ant-...
GEMINI_API_KEY=AIza...

# Supabase (è‡ªå‹•è¨­å®š)
SUPABASE_URL=https://...supabase.co
SUPABASE_ANON_KEY=eyJh...
SUPABASE_SERVICE_ROLE_KEY=eyJh...
SUPABASE_DB_URL=postgresql://...
```

### Secrets è¨­å®šã‚³ãƒãƒ³ãƒ‰

```bash
# ä¸€æ‹¬è¨­å®š
npx supabase secrets set --env-file .env.secrets

# å€‹åˆ¥è¨­å®š
npx supabase secrets set OPENAI_API_KEY=sk-...
npx supabase secrets set ANTHROPIC_API_KEY=sk-ant-...
npx supabase secrets set GEMINI_API_KEY=AIza...

# WebSearch å‘ã‘ Option
npx supabase secrets set TAVILY_API_KEY=tvly-...

# ComfyUI (RunPod) å‘ã‘ Option
npx supabase secrets set RUNPOD_ENDPOINT=https://your-pod-id.proxy.runpod.net
npx supabase secrets set RUNPOD_API_KEY=your-runpod-auth-token

# ç¢ºèª
npx supabase secrets list
```

### Database Tables

- **llm_call_logs**: LLM APIå‘¼ã³å‡ºã—å±¥æ­´
- **user_quotas**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã”ã¨ã®æœˆé–“ä½¿ç”¨åˆ¶é™
- **profiles**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æƒ…å ±
- **system_events**: ã‚¤ãƒ™ãƒ³ãƒˆã‚­ãƒ¥ãƒ¼ï¼ˆéåŒæœŸã‚¸ãƒ§ãƒ–å‡¦ç†ï¼‰
- **event_handlers**: ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ãƒ¼è¨­å®š

### Event System (ã‚¤ãƒ™ãƒ³ãƒˆé§†å‹•ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£)

è»½é‡ãªã‚¤ãƒ™ãƒ³ãƒˆé§†å‹•ã‚¸ãƒ§ãƒ–ã‚­ãƒ¥ãƒ¼ã‚·ã‚¹ãƒ†ãƒ ã‚’å®Ÿè£…ã—ã¦ã„ã¾ã™ã€‚

**ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£:**
```
EventService.emit() â†’ system_events (DB)
  â†“
  â”œâ”€â†’ Supabase Realtime â†’ Frontend (å³åº§ã«é€šçŸ¥)
  â””â”€â†’ Cron (æ¯åˆ†) â†’ process-events â†’ Handler Edge Functions
```

**ä½¿ç”¨ä¾‹:**
```javascript
// Frontend: ã‚¤ãƒ™ãƒ³ãƒˆç™ºè¡Œ
import { EventService } from './services/EventService'
await EventService.emit('image.generated', {
  imageId: '123',
  imageUrl: 'https://...',
  userId: user.id
})

// Frontend: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒªã‚¹ãƒŠãƒ¼
import { useEventListener } from './hooks/useEventListener'
useEventListener('image.generated', (event) => {
  toast.success('ç”»åƒç”Ÿæˆå®Œäº†ï¼')
  refetchImages()
})
```

**å®Ÿè£…æ¸ˆã¿ã‚¤ãƒ™ãƒ³ãƒˆã‚¿ã‚¤ãƒ—:**
- `image.generated` - ç”»åƒç”Ÿæˆå®Œäº†
- `quota.exceeded` - ã‚¯ã‚©ãƒ¼ã‚¿è¶…é
- `quota.warning` - ã‚¯ã‚©ãƒ¼ã‚¿è­¦å‘Š
- `user.registered` - ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²
- `model.synced` - ãƒ¢ãƒ‡ãƒ«åŒæœŸå®Œäº†

**ç‰¹å¾´:**
- ã‚·ãƒ³ãƒ—ãƒ«ãªç™ºè¡Œ: `EventService.emit(type, payload)`
- Realtimeé€šçŸ¥: åˆ¥ã‚¿ãƒ–ã§ã‚‚å³åº§ã«åæ˜ 
- è‡ªå‹•ãƒªãƒˆãƒ©ã‚¤: æŒ‡æ•°ãƒãƒƒã‚¯ã‚ªãƒ•ï¼ˆ5åˆ† Ã— retry_countï¼‰
- å„ªå…ˆåº¦åˆ¶å¾¡: `priority`ã§å‡¦ç†é †ã‚’åˆ¶å¾¡
- ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«å®Ÿè¡Œ: `scheduledAt`ã§é…å»¶å®Ÿè¡Œ

**Admin UI:** `/admin/events` ã§ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç›£è¦–å¯èƒ½

è©³ç´°ã¯ `workspace/event-system-guide.md` ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

### Async Job System (éåŒæœŸã‚¸ãƒ§ãƒ–å®Ÿè¡Œ)

Event Systemã‚’æ‹¡å¼µã—ãŸã€é•·æ™‚é–“å®Ÿè¡Œã‚¿ã‚¹ã‚¯å‘ã‘ã®éåŒæœŸã‚¸ãƒ§ãƒ–ã‚·ã‚¹ãƒ†ãƒ ã§ã™ã€‚

**ç‰¹å¾´:**
- **CRONé§†å‹•**: Edge Functionã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆï¼ˆ1åˆ†ï¼‰ã‚’å›é¿
- **é€²æ—ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°**: 0-100%ã®é€²æ—ã‚’Realtimeé…ä¿¡
- **æœ€å¤§1åˆ†å¾…æ©Ÿ**: ã‚¸ãƒ§ãƒ–èµ·å‹•ã‹ã‚‰å‡¦ç†é–‹å§‹ã¾ã§æœ€å¤§1åˆ†ã®ãƒ‡ã‚£ãƒ¬ã‚¤ï¼ˆè¨±å®¹ç¯„å›²ï¼‰
- **ã‚·ãƒ³ãƒ—ãƒ«API**: `EventService.emit('job:*')` ã§ã‚¸ãƒ§ãƒ–èµ·å‹•

**ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£:**
```
EventService.emit('job:*') â†’ system_events (pending)
  â†“ (æœ€å¤§1åˆ†å¾…æ©Ÿ)
Cron â†’ process-events â†’ handlers.ts
  â†“ (é€²æ—æ›´æ–°: 0% â†’ 50% â†’ 100%)
Realtime â†’ Frontend (useJob Hook)
  â†“
JobProgress Component (UIè¡¨ç¤º)
```

**ä½¿ç”¨ä¾‹:**
```javascript
// Frontend: ã‚¸ãƒ§ãƒ–èµ·å‹•
const event = await EventService.emit('job:generate-report', {
  reportType: 'sales',
  startDate: '2025-01-01',
  endDate: '2025-01-31'
})

// é€²æ—ç›£è¦–ï¼ˆRealtimeè‡ªå‹•æ›´æ–°ï¼‰
const { progress, isCompleted, result } = useJob(event.id, {
  onComplete: (result) => {
    toast.success('ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆå®Œäº†ï¼')
  }
})

// UIè¡¨ç¤º
<JobProgress jobId={event.id} title="Sales Report" />
```

**å®Ÿè£…æ¸ˆã¿ã‚¸ãƒ§ãƒ–ã‚¿ã‚¤ãƒ—:**
- `job:generate-report` - ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆï¼ˆã‚µãƒ³ãƒ—ãƒ«å®Ÿè£…ï¼‰

**ãƒ‡ãƒ¢:** `/examples` ãƒšãƒ¼ã‚¸ã§å‹•ä½œç¢ºèªå¯èƒ½

è©³ç´°ãªå®Ÿè£…ä¾‹ã¯ `docs/design/async_job_system.md` ãŠã‚ˆã³ `supabase/functions/execute-async-job/handlers.ts` ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

### RLS ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

**âŒ é–“é•ã„: é–¢æ•°ã‚’ç›´æ¥å‘¼ã¶**
```sql
CREATE POLICY "Admin only"
  ON table_name
  FOR ALL
  USING (is_admin());  -- NG
```

**âœ… æ­£ã—ã„: SELECT ã§ãƒ©ãƒƒãƒ—**
```sql
CREATE POLICY "Admin only"
  ON table_name
  FOR ALL
  USING ((SELECT is_admin()) = true);  -- OK
```

**ç†ç”±:**
- RLSãƒãƒªã‚·ãƒ¼å†…ã§é–¢æ•°ã‚’ç›´æ¥å‘¼ã¶ã¨ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹å ´åˆãŒã‚ã‚‹
- `SELECT` ã§ãƒ©ãƒƒãƒ—ã™ã‚‹ã“ã¨ã§å®‰å…¨ã«å®Ÿè¡Œå¯èƒ½
- `= true` ã§æ˜ç¤ºçš„ã«booleanæ¯”è¼ƒ

**is_admin() å®Ÿè£…ä¾‹:**
(è©³ç´°ã¯ Migration ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‚ç…§)

**é‡è¦:**
- `raw_app_meta_data` ã‚’ä½¿ç”¨ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå¤‰æ›´ä¸å¯ï¼‰
- `raw_user_meta_data` ã¯ä½¿ç”¨ã—ãªã„ï¼ˆã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒªã‚¹ã‚¯ï¼‰

### Realtime è¨­å®š

**é‡è¦:** Realtimeã‚’ä½¿ç”¨ã™ã‚‹ãƒ†ãƒ¼ãƒ–ãƒ«ã¯æ‰‹å‹•ã§æœ‰åŠ¹åŒ–ãŒå¿…è¦ã§ã™ã€‚

**è¨­å®šæ–¹æ³•:**
1. Supabase Dashboard â†’ Database â†’ Replication
2. `supabase_realtime_messages_publication` ã‚’é¸æŠ
3. å¯¾è±¡ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆä¾‹: `system_events`ï¼‰ã‚’è¿½åŠ 

**å‹•ä½œç¢ºèª:**
```javascript
// ExamplesPage (/examples) ã§ç¢ºèª
// ã‚¤ãƒ™ãƒ³ãƒˆã‚’ç™ºè¡Œ â†’ ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§å—ä¿¡ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
```

è©³ç´°ã¯ `docs/setup.md` ã®ã€Œ4.6. Supabase Realtime è¨­å®šã€ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

---
## 11. LLM Function Calling System

Akatsukiã¯ã€LLMãŒè‡ªå¾‹çš„ã«ã‚·ã‚¹ãƒ†ãƒ æ©Ÿèƒ½ã‚’å‘¼ã³å‡ºã›ã‚‹**Function Call System**ã‚’æ¨™æº–æ­è¼‰ã—ã¦ã„ã¾ã™ã€‚

### 11.1. ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Frontend Admin UI                        â”‚
â”‚  /admin/function-definitions             â”‚
â”‚  â†’ Functionå®šç¾©ã®CRUD                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“ INSERT/UPDATE
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ function_call_definitions (DB)          â”‚
â”‚  - name, description                    â”‚
â”‚  - parameters_schema (JSON Schema)      â”‚
â”‚  - target_event_type                    â”‚
â”‚  - is_enabled, is_global                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“ SELECT
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ai-chat Edge Function                   â”‚
â”‚  1. DBã‹ã‚‰Functionå®šç¾©èª­ã¿è¾¼ã¿           â”‚
â”‚  2. LLMã«ã‚¹ã‚­ãƒ¼ãƒæ³¨å…¥                    â”‚
â”‚  3. Function Callæ¤œå‡º                   â”‚
â”‚  4. system_events ã«Jobç™»éŒ²             â”‚
â”‚  5. function_call_logs è¨˜éŒ²             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Job System                              â”‚
â”‚  â† å®Ÿè¡Œãƒ­ã‚¸ãƒƒã‚¯ã¯åˆ¥é€”å®Ÿè£…               â”‚
â”‚  ï¼ˆJob Handler / Webhook / ç‹¬è‡ªï¼‰       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 11.2. è¨­è¨ˆæ€æƒ³

**é‡è¦ãªåˆ†é›¢:**
- **Functionå®šç¾© = ã‚¹ã‚­ãƒ¼ãƒã®ã¿ï¼ˆDBç®¡ç†ï¼‰**
- **å®Ÿè¡Œãƒ­ã‚¸ãƒƒã‚¯ = åˆ¥ã®å±¤ã§å®Ÿè£…**

ã“ã®è¨­è¨ˆã«ã‚ˆã‚Šï¼š
- âœ… ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼éä¾å­˜ï¼ˆOpenAI/Anthropic/Geminiå…±é€šï¼‰
- âœ… å®Ÿè¡ŒåŸºç›¤ã¯Job Systemã§çµ±ä¸€
- âœ… ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒç‹¬è‡ªFunctionã‚’ç™»éŒ²å¯èƒ½ï¼ˆLLM Platformå‹ã‚¢ãƒ—ãƒªã‚‚ä½œã‚Œã‚‹ï¼‰
- âœ… VibeCodingã§æŸ”è»Ÿã«ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºå¯èƒ½

### 11.4. ä½¿ã„æ–¹

**1. Functionå®šç¾©ã‚’è¿½åŠ ï¼ˆAdmin UIï¼‰**

`/admin/function-definitions` ã«ã‚¢ã‚¯ã‚»ã‚¹:
- Functionå: `send_webhook`
- èª¬æ˜: `Send HTTP webhook to external service`
- Parameters Schema (JSON Schema):
```json
{
  "type": "object",
  "properties": {
    "url": { "type": "string", "description": "Webhook URL" },
    "method": { "type": "string", "enum": ["GET", "POST"] },
    "body": { "type": "object" }
  },
  "required": ["url"]
}
```
- Target Event Type: `job:send_webhook`
- æœ‰åŠ¹åŒ– + ã‚°ãƒ­ãƒ¼ãƒãƒ«è¨­å®š

**2. LLMãŒFunction Callã‚’ä½¿ç”¨ï¼ˆFrontendï¼‰**

```javascript
import { AIService } from './services/ai/AIService'

const { data } = await AIService.chat({
  provider: 'openai',
  prompt: 'Send a webhook to https://example.com with message "Hello"',
  enableFunctionCalling: true,  // Function Callingæœ‰åŠ¹åŒ–
})

// â†’ LLMãŒ send_webhook ã‚’å‘¼ã³å‡ºã—
// â†’ system_events ã« 'job:send_webhook' ç™»éŒ²
// â†’ Job SystemãŒå‡¦ç†å®Ÿè¡Œï¼ˆJob HandlerãŒå¿…è¦ï¼‰
```

**3. å®Ÿè¡Œãƒ­ã‚¸ãƒƒã‚¯ã‚’å®Ÿè£…ï¼ˆJob Handlerï¼‰**

(å®Ÿè£…ä¾‹ã¯ `supabase/functions/execute-async-job/handlers.ts` ã‚’å‚ç…§)

**4. å®Ÿè¡Œãƒ­ã‚°ã‚’ç¢ºèª**

`/admin/function-calls` ã«ã‚¢ã‚¯ã‚»ã‚¹:
- æˆåŠŸ/å¤±æ•—ã€å¼•æ•°ãƒ»çµæœã€å®Ÿè¡Œæ™‚é–“ã€LLMå‘¼ã³å‡ºã—ã¨ã®ç´ä»˜ã‘

### 11.5. ã‚µãƒ³ãƒ—ãƒ«é–¢æ•°ï¼ˆSeedæ¸ˆã¿ï¼‰

Akatsukiã«ã¯5ã¤ã®ã‚µãƒ³ãƒ—ãƒ«Functionå®šç¾©ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ï¼š

| é–¢æ•°å | èª¬æ˜ | Event Type |
|--------|------|------------|
| `send_webhook` | Webhooké€ä¿¡ | `job:send_webhook` |
| `query_database` | DBã‚¯ã‚¨ãƒªå®Ÿè¡Œ | `job:query_database` |
| `send_notification` | é€šçŸ¥é€ä¿¡ | `job:send_notification` |
| `generate_image` | AIç”»åƒç”Ÿæˆ | `job:generate_image` |
| `aggregate_data` | ãƒ‡ãƒ¼ã‚¿é›†è¨ˆ | `job:aggregate_data` |

ã“ã‚Œã‚‰ã¯å‚è€ƒå®Ÿè£…ã§ã™ã€‚å®Ÿéš›ã®å®Ÿè¡Œãƒ­ã‚¸ãƒƒã‚¯ã¯åˆ¥é€”å®Ÿè£…ã—ã¦ãã ã•ã„ã€‚

### 11.6. VibeCodingã§ã®æ‹¡å¼µ

**æ–°ã—ã„Functionã‚’è¿½åŠ ã™ã‚‹å ´åˆ:**

1. Admin UIã§æ–°ã—ã„Functionå®šç¾©ã‚’ä½œæˆ
2. Job Handlerã«å®Ÿè¡Œãƒ­ã‚¸ãƒƒã‚¯ã‚’å®Ÿè£…
3. ãƒ‡ãƒ—ãƒ­ã‚¤

(è©³ç´°ãªå®Ÿè£…ä¾‹ã¯ `supabase/functions/execute-async-job/handlers.ts` ã‚’å‚ç…§)

### 11.7. ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ä¾‹

**1. ã‚·ãƒ³ãƒ—ãƒ«ãªã‚¢ãƒ—ãƒªï¼ˆé–‹ç™ºè€…ãŒé–¢æ•°å®šç¾©ï¼‰**
- Functionå®šç¾©: Admin UIã§ç®¡ç†
- å®Ÿè¡Œãƒ­ã‚¸ãƒƒã‚¯: Job Handlerã«ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰
- ç”¨é€”: è‡ªç¤¾ã‚¢ãƒ—ãƒªã®AIæ©Ÿèƒ½å¼·åŒ–

**2. LLM Platformï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒé–¢æ•°ç™»éŒ²ï¼‰**
- Functionå®šç¾©: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒUIçµŒç”±ã§ç™»éŒ²
- å®Ÿè¡Œãƒ­ã‚¸ãƒƒã‚¯: Webhook (Out) ã§å¤–éƒ¨é€£æº
- ç”¨é€”: Zapier/Make.comçš„ãªãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ 

**3. ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰**
- ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°: ç®¡ç†è€…ãŒå®šç¾©
- ãƒ¦ãƒ¼ã‚¶ãƒ¼é–¢æ•°: å„ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒç‹¬è‡ªã«è¿½åŠ 
- ç”¨é€”: ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºAIãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ 

### 11.8. ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

**Functionå®šç¾©:**
- âœ… æ˜ç¢ºãªè²¬å‹™ï¼ˆ1 Function = 1æ©Ÿèƒ½ï¼‰
- âœ… JSON Schema ã§ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å³å¯†ã«å®šç¾©
- âœ… `target_event_type` ã¯ `job:` ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ã‚’ä½¿ç”¨

**å®Ÿè¡Œãƒ­ã‚¸ãƒƒã‚¯:**
- âœ… Job Handler ã§ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
- âœ… é€²æ—æ›´æ–°ï¼ˆé•·æ™‚é–“å‡¦ç†ã®å ´åˆï¼‰
- âœ… ç›£æŸ»ãƒ­ã‚°ã‚’æ´»ç”¨

**ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£:**
- âœ… RLSã§Functionå®šç¾©ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹åˆ¶é™
- âœ… å±é™ºãªæ“ä½œã¯Adminå°‚ç”¨ã«ã™ã‚‹
- âœ… function_call_logs ã§å…¨å®Ÿè¡Œã‚’è¨˜éŒ²

### 11.9. ç®¡ç†ç”»é¢

**Functionå®šç¾©ç®¡ç†:** `/admin/function-definitions`
- Functionä¸€è¦§ãƒ»ä½œæˆãƒ»ç·¨é›†ãƒ»å‰Šé™¤ã€JSON Schemaç·¨é›†ã€æœ‰åŠ¹/ç„¡åŠ¹åˆ‡ã‚Šæ›¿ãˆã€Global/Useråˆ‡ã‚Šæ›¿ãˆ

**å®Ÿè¡Œãƒ­ã‚°é–²è¦§:** `/admin/function-calls`
- å®Ÿè¡Œå±¥æ­´ä¸€è¦§ã€ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ï¼ˆFunctionåã€ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ï¼‰ã€è©³ç´°è¡¨ç¤ºï¼ˆå¼•æ•°ã€çµæœã€ã‚¨ãƒ©ãƒ¼ï¼‰ã€çµ±è¨ˆæƒ…å ±

---
## 12. RAG File Search Systemï¼ˆçŸ¥è­˜ãƒ™ãƒ¼ã‚¹çµ±åˆï¼‰

### 12.1. æ¦‚è¦

Akatsukiã¯RAGï¼ˆRetrieval-Augmented Generationï¼‰æ©Ÿèƒ½ã‚’çµ±åˆã—ã€è¤‡æ•°ã®File Search Providerã«å¯¾å¿œã—ãŸå …ç‰¢ãªãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã‚’æä¾›ã—ã¾ã™ã€‚

**ç‰¹å¾´:**
- âœ… **ProvideræŠ½è±¡åŒ–**: Gemini/OpenAI/Pinecone/AnythingLLMç­‰ã«å¯¾å¿œ
- âœ… **ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸**: Supabase Storage + Providerä¸¡æ–¹ã«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¿å­˜
- âœ… **2-step Upload Flow**: ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã¨ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹åŒ–ã‚’åˆ†é›¢
- âœ… **å‹å®‰å…¨æ€§**: å³å¯†ãªå‹å®šç¾©ã§ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒŸã‚¹ã‚’é˜²æ­¢

### 12.2. ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Frontend: FileSearchService.ts              â”‚
â”‚ - çµ±ä¸€ã•ã‚ŒãŸAPI                             â”‚
â”‚ - ProvideræŠ½è±¡åŒ–                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Edge Functions (2-step flow)               â”‚
â”‚                                             â”‚
â”‚ Step 1: file-upload (æ±ç”¨çš„)                â”‚
â”‚   - Supabase Storageã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰          â”‚
â”‚   - filesãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ                       â”‚
â”‚   OUTPUT: file_id                           â”‚
â”‚                                             â”‚
â”‚ Step 2: knowledge-file-index (RAGå°‚ç”¨)      â”‚
â”‚   - file_idã‹ã‚‰ãƒ•ã‚¡ã‚¤ãƒ«å–å¾—                 â”‚
â”‚   - Providerã«ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹åŒ–                â”‚
â”‚   - knowledge_filesãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Provider Client Layer                       â”‚
â”‚                                             â”‚
â”‚ RAGProviderInterface (å…±é€šIF)               â”‚
â”‚  â”œâ”€ GeminiRAGClient      [å®Ÿè£…æ¸ˆã¿]         â”‚
â”‚  â”œâ”€ OpenAIRAGClient      [TODO]            â”‚
â”‚  â”œâ”€ PineconeRAGClient    [TODO]            â”‚
â”‚  â””â”€ AnythingLLMClient    [TODO]            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Database                                    â”‚
â”‚                                             â”‚
â”‚ files (Supabase Storageç®¡ç†)                â”‚
â”‚  â†“ file_id                                  â”‚
â”‚ knowledge_files (é–¢ä¿‚ãƒ†ãƒ¼ãƒ–ãƒ«)               â”‚
â”‚  â†“ store_id                                 â”‚
â”‚ file_search_stores (RAG Storeç®¡ç†)          â”‚
â”‚  â†“ provider                                 â”‚
â”‚ Provider Storage (Gemini/OpenAI/etc.)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 12.3. Frontend Service

#### FileSearchService

**Location:** `packages/app-frontend/src/services/FileSearchService.ts`

çµ±ä¸€ã•ã‚ŒãŸAPIã‚’æä¾›ï¼ˆ2-step flowã‚’å†…éƒ¨ã§å®Ÿè¡Œï¼‰ï¼š

```typescript
import { FileSearchService } from '@/services/FileSearchService'

// 1. Create Store
const { data: storeData } = await FileSearchService.createStore('My Knowledge Base', {
  provider: 'gemini'
})

// 2. Upload File (2-step flow internally)
const { data: uploadData } = await FileSearchService.uploadFile(storeData.store.id, file, {
  provider: 'gemini'
})

// 3. RAG Chat
const { data: chatData } = await FileSearchService.chatWithRAG(
  'ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ã¤ã„ã¦æ•™ãˆã¦',
  [storeData.store.id],
  { provider: 'gemini', model: 'gemini-2.0-flash-exp' }
)

// 4. List Files
const { data: filesData } = await FileSearchService.listFiles(storeData.store.id)

// 5. Delete Store
await FileSearchService.deleteStore(storeData.store.id)
```

**å†…éƒ¨å‹•ä½œï¼ˆ2-step flowï¼‰:**
```typescript
// uploadFile() internally:
// Step 1: file-upload Edge Function â†’ get file_id
// Step 2: knowledge-file-index Edge Function â†’ index to provider
```

### 12.4. RAG Chatçµ±åˆï¼ˆai-chatï¼‰

**Location:** `supabase/functions/ai-chat/index.ts`

File Searchæ©Ÿèƒ½ã¯ai-chatã«çµ±åˆã•ã‚Œã¦ã„ã¾ã™ï¼š

```typescript
// INPUT
{
  provider: 'gemini' | 'openai' | 'anthropic',
  prompt: string,
  model?: string,
  fileSearchStoreIds?: string[], // RAGç”¨ã®Store IDé…åˆ—
  enableFileSearch?: boolean
}

// OUTPUT
{
  response: string,
  grounding_metadata?: {
    search_results: [...],
    citations: [...]
  }
}
```

### 12.5. æ–°ã—ã„Providerã®è¿½åŠ æ–¹æ³•

**Step 1: Provider Clientå®Ÿè£…**

1. `supabase/functions/_shared/providers/new-provider-rag-client.ts` ã‚’ä½œæˆ
2. `RAGProviderInterface` ã‚’å®Ÿè£…

**Step 2: Factoryç™»éŒ²**

`rag-provider-factory.ts` ã«è¿½åŠ ï¼ˆè©³ç´°ã¯å®Ÿè£…ã‚’å‚ç…§ï¼‰

**Step 3: Migrationæ›´æ–°**

`file_search_stores` ã®CHECKåˆ¶ç´„ã‚’æ›´æ–°

**Step 4: Frontendå‹æ›´æ–°**

`FileSearchService.ts` ã®å‹å®šç¾©ã‚’æ›´æ–°

### 12.6. ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

**ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰:**
- âœ… 2-step flowã‚’ä½¿ç”¨ï¼ˆStorage â†’ Indexingï¼‰
- âœ… private_uploadsãƒã‚±ãƒƒãƒˆã‚’ä½¿ç”¨ï¼ˆRAGãƒ•ã‚¡ã‚¤ãƒ«ç”¨ï¼‰
- âœ… metadata ã«purpose: 'rag'ã‚’è¨­å®š
- âœ… ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ï¼ˆStorageå¤±æ•—æ™‚ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ï¼‰

**Providerå®Ÿè£…:**
- âœ… RAGProviderInterfaceã‚’å³å¯†ã«å®Ÿè£…
- âœ… ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯æ˜ç¢ºã«
- âœ… ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«ã¯å¿…ãšå‰Šé™¤

**ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£:**
- âœ… RLSã§å…¨ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ä¿è­·
- âœ… files.owner_id ã§æ‰€æœ‰æ¨©ã‚’æ¤œè¨¼
- âœ… file_search_stores.user_id ã§æ¨©é™ç¢ºèª

**å‹å®‰å…¨æ€§:**
- âœ… file_id/store_id/provider_file_nameã‚’æ˜ç¢ºã«åŒºåˆ¥

### 12.7. è¨­è¨ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

è©³ç´°ãªè¨­è¨ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ä»¥ä¸‹ã‚’å‚ç…§ï¼š
- `docs/design/rag-file-search-architecture.md` - ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å…¨ä½“åƒ
- `docs/design/rag-provider-abstraction.md` - ProvideræŠ½è±¡åŒ–ãƒ‘ã‚¿ãƒ¼ãƒ³
- `docs/design/rag-2step-upload-flow.md` - 2-step Upload Flowè¨­è¨ˆ

---

## 13. WASM Runtime Component

### 13.1. æ¦‚è¦

**WebAssembly (WASM) Runtime Component** ã¯ã€ãƒ–ãƒ©ã‚¦ã‚¶ä¸Šã§å®‰å…¨ã«WASMãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’å®Ÿè¡Œãƒ»ç®¡ç†ã™ã‚‹ãŸã‚ã®çµ±åˆãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã§ã™ã€‚

**æä¾›ä¾¡å€¤:**
- ğŸ”’ **å®‰å…¨æ€§**: ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆåˆ¶å¾¡ã€ãƒ¡ãƒ¢ãƒªç®¡ç†ã€ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
- ğŸ“¦ **ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ç®¡ç†**: ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã€ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ã€å…¬é–‹/éå…¬é–‹è¨­å®š
- âš¡ **é«˜æ€§èƒ½**: ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°ã€CDNé…ä¿¡ï¼ˆPublicï¼‰
- ğŸ¯ **ç°¡å˜**: React Hooksã§å³åº§ã«åˆ©ç”¨å¯èƒ½

**ä½¿ç”¨ä¾‹:**
- ã‚«ã‚¹ã‚¿ãƒ è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯ã®å®Ÿè¡Œ
- ãƒ¦ãƒ¼ã‚¶ãƒ¼æä¾›ã‚³ãƒ¼ãƒ‰ã®ã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹å®Ÿè¡Œ
- é«˜é€Ÿãªæ•°å€¤è¨ˆç®—å‡¦ç†
- å®Ÿè¡Œå¯èƒ½ãªãƒ‡ãƒ¢ãƒ»ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«

### 13.2. ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

**ãƒ¬ã‚¤ãƒ¤ãƒ¼æ§‹æˆ:**
```
UI Layer          â†’ WasmRuntimeCard, WasmModuleUploaderCard
Hook Layer        â†’ useWasmModule (React Query)
Service Layer     â†’ WasmRuntimeService (å®Ÿè¡Œã‚¨ãƒ³ã‚¸ãƒ³)
Repository Layer  â†’ WasmModuleRepository, WasmExecutionRepository
Model Layer       â†’ WasmModule, WasmExecution
Database          â†’ wasm_modules, wasm_executions (PostgreSQL)
Storage           â†’ public_assets / private_uploads (Supabase Storage)
```

**ä¸»è¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ:**

1. **WasmRuntimeService** (`services/WasmRuntimeService.ts`)
   - WASMãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ãƒ»å®Ÿè¡Œ
   - ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆåˆ¶å¾¡ (ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ5ç§’)
   - ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ç›£è¦–
   - ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°
   - é–¢æ•°ä¸€è¦§å–å¾—

2. **WasmModuleRepository** (`repositories/WasmModuleRepository.ts`)
   - ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®CRUDæ“ä½œ
   - å…¬é–‹/éå…¬é–‹ç®¡ç†
   - ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†
   - ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼ãªã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸

3. **useWasmModule Hook** (`hooks/useWasmModule.ts`)
   - React Queryçµ±åˆ
   - ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ä¸€è¦§å–å¾—
   - WASMé–¢æ•°å®Ÿè¡Œ
   - ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å‰Šé™¤

### 13.3. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒ

**wasm_modules ãƒ†ãƒ¼ãƒ–ãƒ«:**

* wasm_modules
* wasm_executions

### 13.4. Storageè¨­å®š

**Public Storage (public_assets):**
- CDNé…ä¿¡å¯èƒ½
- æ°¸ç¶šçš„ãªå…¬é–‹URL
- ãƒ‡ãƒ¢ãƒ»OSSå‘ã‘
- 50MBä¸Šé™
- `allowed_mime_types`: `['application/wasm', ...]`

**Private Storage (private_uploads):**
- ç½²åä»˜ãURLã®ã¿ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½
- RLSã§æ¨©é™ç®¡ç†
- æ©Ÿå¯†ã‚³ãƒ¼ãƒ‰å‘ã‘
- 50MBä¸Šé™
- `allowed_mime_types`: `['application/wasm', ...]`

### 13.5. ä½¿ç”¨æ–¹æ³•

**ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ UI:**
- `ExamplesPage` ã« `WasmModuleUploaderCard` ãŒå®Ÿè£…æ¸ˆã¿
- å…¬é–‹/éå…¬é–‹é¸æŠ
- è‡ªå‹•çš„ãªé–¢æ•°æ¤œå‡º
- ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†
- ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆé‡è¤‡æ¤œå‡ºãªã©ï¼‰

### 13.6. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

**RLS Policies:**
- âœ… ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯è‡ªåˆ†ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ã¿ç®¡ç†å¯èƒ½
- âœ… å…¬é–‹ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¯èª°ã§ã‚‚èª­ã¿å–ã‚Šå¯èƒ½
- âœ… å®Ÿè¡Œå±¥æ­´ã¯æ‰€æœ‰è€…ã®ã¿ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½

**å®Ÿè¡Œæ™‚ä¿è­·:**
- âœ… ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆåˆ¶å¾¡ï¼ˆç„¡é™ãƒ«ãƒ¼ãƒ—é˜²æ­¢ï¼‰
- âœ… ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ç›£è¦–
- âœ… ã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹å®Ÿè¡Œï¼ˆãƒ–ãƒ©ã‚¦ã‚¶WASMç’°å¢ƒï¼‰

### 13.7. ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

**ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ä½œæˆ:**
- âœ… `-C link-arg=-s` ãƒ•ãƒ©ã‚°ã§ãƒã‚¤ãƒŠãƒªã‚µã‚¤ã‚ºå‰Šæ¸›
- âœ… å˜ç´”ãªè¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯ã‹ã‚‰å§‹ã‚ã‚‹
- âœ… é–¢æ•°åã¯æ˜ç¢ºã«ï¼ˆ`add`, `calculate`, etc.ï¼‰

**è¨­è¨ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ:**
- `docs/design/wasm-runtime-design.md`
- `docs/design/wasm-edge-integration.md`

### 13.8. Edge Functionçµ±åˆï¼ˆæ¨å¥¨ï¼‰

**2025-11å®Ÿè£…:** WASM Edge Functionçµ±åˆã«ã‚ˆã‚Šã€ãƒ–ãƒ©ã‚¦ã‚¶å®Ÿè¡Œã¨ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰å®Ÿè¡Œã®ä¸¡æ–¹ã‚’ã‚µãƒãƒ¼ãƒˆã€‚

**ãªãœEdge Functionï¼Ÿ**
- âœ… **ã‚·ãƒ³ãƒ—ãƒ«**: Shuttleã‚ˆã‚Šè¨­å®šãŒç°¡å˜ï¼ˆ`wasm-executor` Edge Function 1ã¤ï¼‰
- âœ… **é«˜é€Ÿãƒ‡ãƒ—ãƒ­ã‚¤**: `akatsuki function deploy` ã§å³åº§ã«ãƒ‡ãƒ—ãƒ­ã‚¤ï¼ˆDockerãƒ¬ã‚¹ï¼‰
- âœ… **ç®¡ç†ãŒæ¥½**: Supabase ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§ä¸€å…ƒç®¡ç†
- âœ… **è‡ªå‹•ã‚¹ã‚±ãƒ¼ãƒ«**: Supabase Edge Runtime ã®æ©æµ
- âœ… **Storageçµ±åˆ**: WASM ãƒã‚¤ãƒŠãƒªã‚’ Storage ã‹ã‚‰å‹•çš„ãƒ­ãƒ¼ãƒ‰ + LRU ã‚­ãƒ£ãƒƒã‚·ãƒ¥

**Shuttleã¨ã®æ¯”è¼ƒ:**
| é …ç›® | Edge Function | Shuttle |
|------|---------------|---------|
| ãƒ‡ãƒ—ãƒ­ã‚¤é€Ÿåº¦ | âš¡ å³åº§ï¼ˆ1-2ç§’ï¼‰ | ğŸ¢ é…ã„ï¼ˆãƒ“ãƒ«ãƒ‰æ•°åˆ†ï¼‰ |
| è¨­å®š | ã‚·ãƒ³ãƒ—ãƒ«ï¼ˆEdge Function 1ã¤ï¼‰ | è¤‡é›‘ï¼ˆCargo.tomlã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹æˆï¼‰ |
| ç®¡ç† | Supabase ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ | åˆ¥ã‚µãƒ¼ãƒ“ã‚¹ |
| WASMå‹•çš„ãƒ­ãƒ¼ãƒ‰ | âœ… Storage + ã‚­ãƒ£ãƒƒã‚·ãƒ¥ | âŒ é™çš„åŸ‹ã‚è¾¼ã¿ |
| ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚° | è‡ªå‹• | æ‰‹å‹•è¨­å®šå¿…è¦ |

**æ¨å¥¨:** ã‚«ã‚¹ã‚¿ãƒ ãƒ­ã‚¸ãƒƒã‚¯å®Ÿè¡Œã«ã¯ WASM Edge Function ã‚’å„ªå…ˆã€‚Shuttleã¯é‡ã„å‡¦ç†ã‚„å¤–éƒ¨APIçµ±åˆãŒå¿…è¦ãªå ´åˆã®ã¿ã€‚

**owner_typeåˆ†é¡:**
```typescript
type OwnerType = 'system' | 'admin' | 'user'

// system: å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå®Ÿè¡Œå¯èƒ½ï¼ˆå…¬å¼ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼‰
// admin:  ç®¡ç†è€…ã®ã¿å®Ÿè¡Œå¯èƒ½ï¼ˆç®¡ç†ãƒ„ãƒ¼ãƒ«ï¼‰
// user:   å€‹äººãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼ˆPublic/Privateé¸æŠå¯ï¼‰
```

**Admin UI:**
- `/admin/wasm` - System/Admin/User ã‚¿ãƒ–ã§ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ç®¡ç†
- ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã€ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã€å‰Šé™¤
- Edge Function å®Ÿè¡Œçµæœè¡¨ç¤ºï¼ˆå®Ÿè¡Œæ™‚é–“ã€ãƒ¡ãƒ¢ãƒªã€ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ’ãƒƒãƒˆï¼‰

**Hookæ‹¡å¼µ:**
```typescript
const {
  systemModules,      // ã‚·ã‚¹ãƒ†ãƒ ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ä¸€è¦§
  adminModules,       // ç®¡ç†è€…ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ä¸€è¦§
  executeOnEdge,      // Edge Function ã§å®Ÿè¡Œ
  executeOnEdgeAsync, // Asyncç‰ˆ
} = useWasmModule()
```

**ã‚µãƒ³ãƒ—ãƒ«ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«:**
`wasm-modules/sample-module` ã«5ã¤ã®ãƒ†ã‚¹ãƒˆé–¢æ•°ã‚’å®Ÿè£…æ¸ˆã¿ï¼ˆ75KBï¼‰ï¼š
- `rgb_to_grayscale`, `sum_array`, `multiply_array`, `process_json`, `memory_test`

---

## HEADLESS API Generatorï¼ˆãƒ•ãƒ«ã‚¹ã‚¿ãƒƒã‚¯CRUDè‡ªå‹•ç”Ÿæˆï¼‰

YAMLã‚¹ã‚­ãƒ¼ãƒã‹ã‚‰ã€Backendï¼ˆMigration + Edge Functionï¼‰ã€œ Frontendï¼ˆModel + Service + Hook + UIï¼‰ã¾ã§ä¸€æ‹¬ç”Ÿæˆã™ã‚‹æœ€é€Ÿé–‹ç™ºãƒ„ãƒ¼ãƒ«ã€‚

**ç”Ÿæˆã•ã‚Œã‚‹ãƒ•ã‚¡ã‚¤ãƒ«:**
```
Backend (Supabase):
â”œâ”€â”€ supabase/migrations/YYYYMMDD_create_{table}_table.sql  # Migration + RLS + Indexes
â”œâ”€â”€ supabase/functions/{table}-crud/index.ts               # Edge Function (createAkatsukiHandler)
â”œâ”€â”€ supabase/functions/{table}-crud/schema.ts              # Zod Validation Schema
â””â”€â”€ supabase/functions/_shared/repositories/{Entity}Repository.ts

Frontend (React):
â”œâ”€â”€ src/models/{Entity}.ts              # Model (fromDatabase/toDatabase)
â”œâ”€â”€ src/services/{Entity}Service.ts     # Service (EdgeFunctionService wrapper)
â”œâ”€â”€ src/hooks/use{Entity}s.ts           # React Query Hook (CRUD + mutations)
â”œâ”€â”€ src/pages/admin/entities/{Entity}AdminPage.tsx    # Adminç®¡ç†ç”»é¢
â””â”€â”€ src/components/features/{table}/{Entity}sDemo.tsx # Demo Card

CLI:
â””â”€â”€ packages/app-cli/clients/{Entity}sClient.js  # Node.js CLIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
```

**ä½¿ç”¨ä¾‹:**
```bash
# 1. ã‚¹ã‚­ãƒ¼ãƒãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ (docs/templates/article-schema-example.yaml å‚ç…§)
# 2. ã‚³ãƒ¼ãƒ‰ç”Ÿæˆ
akatsuki api new Article --schema article-schema.yaml

# 3. ç”Ÿæˆå¾Œã®Next steps:
akatsuki db push                           # Migrationé©ç”¨
akatsuki function deploy articles-crud     # Edge Function ãƒ‡ãƒ—ãƒ­ã‚¤
# App.tsx ã« Route è¿½åŠ ã€ExamplesPage ã« Demo è¿½åŠ 
```

**ã‚¹ã‚­ãƒ¼ãƒä¾‹ (YAML):**
```yaml
name: Article
tableName: articles

fields:
  - name: id
    type: uuid
    primaryKey: true
    default: gen_random_uuid()
  - name: userId
    type: uuid
    references: auth.users(id)
    onDelete: CASCADE
  - name: title
    type: string
    required: true
  - name: status
    type: enum
    enumValues: [draft, published]
    default: draft

operations:
  - type: list
  - type: get
  - type: create
  - type: update
  - type: delete

rls:
  - action: SELECT
    using: "auth.uid() = user_id"
  - action: INSERT
    withCheck: "auth.uid() = user_id"
```

**æ©Ÿèƒ½:**
- âœ… Full CRUD (Create, Read, Update, Delete)
- âœ… RLS Policyè‡ªå‹•ç”Ÿæˆ
- âœ… Enumå‹ã‚µãƒãƒ¼ãƒˆï¼ˆToggleæ“ä½œè‡ªå‹•ç”Ÿæˆï¼‰
- âœ… React Queryçµ±åˆï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ»æ¥½è¦³çš„æ›´æ–°ï¼‰
- âœ… Zod Validation
- âœ… Admin Pageï¼ˆDummy Dataç”Ÿæˆãƒœã‚¿ãƒ³ä»˜ãï¼‰
- âœ… Demo Componentï¼ˆExamplesPageç”¨ã‚«ãƒ¼ãƒ‰ï¼‰

---

## Public API Gatewayï¼ˆå¤–éƒ¨APIå…¬é–‹ï¼‰

HEADLESS APIã‚’å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹ãƒ»ãƒ¢ãƒã‚¤ãƒ«ã‚¢ãƒ—ãƒªå‘ã‘ã«å…¬é–‹ã™ã‚‹ãŸã‚ã®API Keyèªè¨¼Gatewayã€‚

**ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£:**
```
External Client (X-API-Key header)
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  api-gateway (Edge Func)    â”‚
â”‚  â€¢ API Keyæ¤œè¨¼ (SHA-256)    â”‚
â”‚  â€¢ Rate Limit (åˆ†/æ—¥)       â”‚
â”‚  â€¢ Permission Check         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  {entity}-crud (Edge Func)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ä½¿ç”¨ä¾‹:**
```bash
# API Keyç®¡ç†: /admin/api-keys

# List
curl -X GET ".../api-gateway/articles/list" \
  -H "X-API-Key: ak_xxxxxx_..."

# Create
curl -X POST ".../api-gateway/articles/create" \
  -H "X-API-Key: ak_xxxxxx_..." \
  -H "Content-Type: application/json" \
  -d '{"title": "Hello"}'
```

**æ©Ÿèƒ½:**
- âœ… API Keyç™ºè¡Œãƒ»ç®¡ç†ï¼ˆAdminç”»é¢: `/admin/api-keys`ï¼‰
- âœ… SHA-256ãƒãƒƒã‚·ãƒ¥èªè¨¼ï¼ˆãƒ•ãƒ«ã‚­ãƒ¼ã¯ç™ºè¡Œæ™‚ã®ã¿è¡¨ç¤ºï¼‰
- âœ… Rate Limitingï¼ˆåˆ†å˜ä½ãƒ»æ—¥å˜ä½ï¼‰
- âœ… æ“ä½œæ¨©é™è¨­å®šï¼ˆlist/get/create/update/deleteï¼‰
- âœ… å³æ™‚åœæ­¢ï¼ˆisActive toggleï¼‰
- âœ… ä½¿ç”¨çµ±è¨ˆãƒ»æœ€çµ‚ä½¿ç”¨æ—¥æ™‚

---

**å®‰è¼ï¼ˆã‚ãï¼‰ã‚ˆã‚Š:**

ã“ã® `AGENT.md` ãŒã€ç§ãŸã¡ã®ã€ŒAkatsukiã€ã®å®‰å®šæ€§ã¨è¼ãã‚’æ”¯ãˆã‚‹åŸºç›¤ã¨ãªã‚Šã¾ã™ã€‚
ãƒ«ãƒ¼ãƒ«ã‚’å®ˆã‚ŠãªãŒã‚‰ã€æœ€é€Ÿã§ä¾¡å€¤ã‚’å±Šã‘ã¾ã—ã‚‡ã†ï¼ ğŸš€
